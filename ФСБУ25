Учёт аренды по ФСБУ 25: архитектура и реализация

1. Архитектура данных

Регистр сведений «_УчетДолгосрочнойАренды»
Хранит все движения по договорам аренды.
Измерения: Договор, ОбъектППА, Показатель, ПериодГрафика, ПериодДисконтирования и др.
Ресурсы: Обязательство, СтоимостьППА, НДС, АвансОбязательство, АвансНДС, АвансАктив.
Период — дата попадания в учёт.
Каждый документ добавляет слой данных. Старые записи не меняются.
Итог по договору = сумма всех слоёв с учётом периода.

Регистр сведений «_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик»
Детализация по объектам и периодам.
Связан с табличной частью документа через УИД строки.

2. Документ «График договора долгосрочной аренды»

Реквизиты шапки:
Договор, ДатаНачала, ДатаОкончания
СтавкаДисконтирования, Аванс
ВидГрафика (Расчет, Расторжение, ЗаменаСтороны, ИзменениеСтавкиНДС, Сторно)

Табличные части:
Изменения арендной платы — периоды действия ставок, суммы, НДС
Состав ППА — объекты аренды, базы распределения, счета отнесения процентов

3. Движок расчёта графика

Находится в форме документа, процедура РассчитатьИндивидуальныеГрафикиНаСервере().

Что делает:
Принимает готовый помесячный график
График арендных платежей уже сформирован в табличной части документа «ГрафикПоДоговору» — это вводные данные, а не результат расчёта.

Для каждого объекта из «Состав ППА»
создаёт копию общего графика, где арендная плата и НДС распределены пропорционально базе распределения объекта.
Получается индивидуальный график объекта (ТЗИГ).

Для каждого объекта выполняет расчёт:
приведенная стоимость (дисконтирование по дням)
проценты, изменение обязательства
долгосрочная и краткосрочная части
амортизация ППА (линейно, исходя из срока)
авансы и их амортизация
корректировка ОПС (если объект не новый)

Записывает результат:
индивидуальные графики сохраняются в регистр «_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик»
затем они сворачиваются (суммируются по периодам) в общий график
свернутые данные записываются обратно в табличную часть «ГрафикПоДоговору» — теперь уже с расчётными показателями

Вход:
таблица «ГрафикПоДоговору» (вводная, только платежи)
таблица «Состав ППА» (объекты с базами распределения)
реквизиты документа (ставка, даты, аванс)

Выход:
регистр детального графика (индивидуальные графики объектов)
заполненная ТЧ «ГрафикПоДоговору» (с процентами, амортизацией и т.д.)

4. Основные кейсы

Новый договор
Вид графика = Расчет
Движок строит график с нуля

В регистр записываются движения с видом «Поступление» (для новых объектов) или «Начисление»
Изменение условий
Вид графика = Расчет (или ИзменениеСтавкиНДС)

Движок пересчитывает график по новым условиям
В регистре появляется новый слой
Корректировка ОПС выравнивает обязательство и стоимость ППА

Расторжение
Вид графика = Расторжение
Формируются движения со знаком минус, списывающие остатки

Расчёт не выполняется
Замена стороны
Вид графика = ЗаменаСтороныДоговора

Остатки списываются со старого договора и начисляются на новый
Суммы переносятся без изменений

Сторно
Вид графика = Сторно
Копия движений указанного документа с противоположным знаком
Используется для отмены ошибочных документов в закрытых периодах

5. Трансляция в бухгалтерский и налоговый учёт
После записи движений в регистр сведений формируются проводки:

Хозрасчетный — для БУ
Налоговый — для НУ (с разделением НУ и ВР)

Запрос собирает остатки из регистра и превращает их в проводки по счетам:
01.03 / 02.03 / 76.07 и т.д.
Корректировка ОПС даёт проводку Дт 01.03 Кт 76.07.1 на сумму отклонения. 

Ежемесячное начисление арендной платы и процентов осуществляется с помощью внешней обработки "ФСБУ25: Формирование документов начиселния	000000730"
Она создает документы поступление товаров и услуг на основе дданных графиков.
Амортизация начисляется штатным документом "Амортизация ОС", но данные берутся из графиков.

6. Контроль целостности
При проведении (после записи) выполняется проверка сбалансированности:
Группировка по объектам ППА
Суммы обязательств, стоимости ППА, авансов должны быть = 0 в пределах допуска
НДС не проверяется (он учитывается отдельно)

При обнаружении разбаланса выводится сообщение:
сначала итоги по договору (только ненулевые показатели)
затем детализация по объектам
Проведение не блокируется, но ошибка фиксируется.

7. Отчётность

«Сверка остатков» — главный контрольный отчёт
Назначение
Единая точка проверки соответствия между:
плановыми данными графиков аренды
фактическими остатками по счетам бухгалтерского учёта
Что показывает
по каждому контрагенту, договору и объекту ППА:
обязательства (76.07.1)
проценты (76.07.5)
НДС (76.07.9)
стоимость ППА (01.03)
амортизацию (02.03)
авансы и их НДС
разбивку по документам, сформировавшим текущее состояние
отклонения между графиком и учётом

Как устроен
трёхуровневая группировка: контрагент → договор → объект ППА
внутри объекта — расшифровка по документам (слоям)
колонки разделены на два блока:
плановые показатели графика
фактические остатки по счетам

Зачем нужен
аудитору — чтобы видеть, что остатки подтверждены
бухгалтеру — чтобы находить расхождения
разработчику — чтобы понимать, как легли данные

Когда использовать
после каждого проведения
перед закрытием периода
при любых сомнениях в корректности учёта

Главное свойство
Если в отчёте нет отклонений — система сбалансирована.
Если есть — отчёт показывает, где искать причину.

«Анализ графика» — детальный расчётный отчёт

Назначение
Показать внутреннюю структуру графика аренды по каждому объекту ППА: как считались проценты, амортизация, обязательства, и как они распределены по периодам.

Что показывает
по каждому объекту ППА и периоду:
арендные платежи и НДС
приведенную стоимость
проценты
изменение обязательства
долгосрочную и краткосрочную части
стоимость ППА
амортизацию (начисленную и накопленную)
балансовую стоимость
итоги по договору в целом

Как устроен
два уровня группировки: объект ППА → период графика
каждая строка — один месяц (или иной период) аренды
все показатели рассчитаны по формулам дисконтирования и амортизации
видны «слои» изменений, если их несколько

Зачем нужен
бухгалтеру — чтобы понимать, из чего сложились цифры в балансе
аудитору — чтобы видеть корректность расчётов
разработчику — чтобы проверять работу движка

Главное свойство
Этот отчёт делает видимой математику ФСБУ 25:
как распределяется обязательство
как считаются проценты
как амортизация «бежит» по периодам
как меняется балансовая стоимость

Если «Сверка остатков» отвечает на вопрос «что есть», то «Анализ графика» — на вопрос «как получилось».

8. Что нельзя делать
Менять записи старых документов (только сторно)
Править регистры в обход документов

Аудиторы получают отчеты и больше не задают вопросов - полет 3 года.
Тестова база 350 договоров, 800 объектов. Множество изменений в договорах.
Условия реализации - УПП в режиме совместимости 8.3.13
Все отчеты на СКД


// см. ОписаниеКонцепции в макете
Процедура ОбработкаЗаполнения(ДанныеЗаполнения, ТекстЗаполнения, СтандартнаяОбработка)
	
	Если ЭтотОбъект.Ссылка.Пустая() Тогда
		Ответственный = ПараметрыСеанса.ТекущийПользователь;
		ВидГрафика = Перечисления._ВидыГрафиковДолгосрочнойАренды.Расчет;
	КонецЕсли;
	
КонецПроцедуры

Процедура ПриКопировании(ОбъектКопирования)
	
	ЭтотОбъект.ГрафикПоДоговору.Очистить();
	ЭтотОбъект.ДатаНачала = Дата(1,1,1);
	ЭтотОбъект.ДатаПрекращения = Дата(1,1,1); 
	ЭтотОбъект.ОПС = 0;
	ЭтотОбъект.СтоимостьППА = 0; 
	ЭтотОбъект.СПИ = 0;
	ЭтотОбъект.Примечание = "";
	ЭтотОбъект.АмППАНаНачало = 0;
	ЭтотОбъект.ПредОПСНаДатуРедакции = 0;
	ЭтотОбъект.Корректировка = 0;  
	ЭтотОбъект.ПредыдущаяРедакция = ОбъектКопирования.Ссылка;
	ЭтотОбъект.ОтражатьВБухгалтерскомУчете = Истина;
	ЭтотОбъект.ОтражатьВНалоговомУчете = Истина;
	ЭтотОбъект.ОтражатьКорректировкуСПИ = Истина;
	ЭтотОбъект.РетроКорректировки.Очистить();
	ЭтотОбъект.ОтразитьРетроКорректировку  = Ложь;
	ЭтотОбъект.Аванс = 0; 
	ЭтотОбъект.ВидГрафика = Перечисления._ВидыГрафиковДолгосрочнойАренды.Расчет;
	
	ЭтотОбъект.РасторжениеБУ.Очистить();
	ЭтотОбъект.РасторжениеНУ.Очистить();
	ЭтотОбъект.ФинРезультатРасторжениеБУ = 0;	
	
	ТекстПримечания = СтрШаблон("Создан на основе: %1", ОбъектКопирования.Ссылка);
	ЭтотОбъект.Примечание = ТекстПримечания; 
	
	Ответственный = ПараметрыСеанса.ТекущийПользователь;
	
	Для каждого строка Из СоставППА Цикл
		Строка.НакопленнаяАмортизация = 0;
		Строка.АмортизацияВПервомМесяце = Истина;
		Строка.СтоимостьППА = 0; 
		Строка.Аванс = 0;
	КонецЦикла;
	
КонецПроцедуры

Процедура ОбработкаПроведения(Отказ, Режим)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	Движения._УчетДолгосрочнойАренды.Записывать = Ложь;
	Движения._УчетДолгосрочнойАренды.Очистить();  
	Движения._УчетДолгосрочнойАренды.Записать();
	
	ДатаСторно = ?(НачалоМесяца(ДатаНачала) = ДатаНачала, ДатаНачала, ДобавитьМесяц(НачалоМесяца(ДатаНачала), 1));
	
	Если ВидГрафика = Перечисления._ВидыГрафиковДолгосрочнойАренды.ИзменениеСтавкиНДС Тогда
		
		ПересчитатьТолькоАренднуюПлатуВГрафиках2026();
		// Нет возврата - идем в общие процедуры
		
	ИначеЕсли ВидГрафика = Перечисления._ВидыГрафиковДолгосрочнойАренды.Расторжение Тогда
		
		РасторжениеДоговора(Отказ); 
		Движения._УчетДолгосрочнойАренды.Записать();
		РасторжениеБУиНУ();
		Возврат;
		
	ИначеЕсли ВидГрафика = Перечисления._ВидыГрафиковДолгосрочнойАренды.ЗаменаСтороныДоговора Тогда
		
		ПровестиЗаменуСтороныДоговора(Отказ); 
		Движения._УчетДолгосрочнойАренды.Записать();
		Возврат;
		
	ИначеЕсли ВидГрафика = Перечисления._ВидыГрафиковДолгосрочнойАренды.Расчет Тогда
		
		СторноОстатковНаДатуНачала(ДатаСторно);	
		НачислениеПервоначальнойСтоимостиППА();
		КапитализацияАванса();
		ПризнаниеОбязательстваПоАвансу();
		СоздатьЗаписиПоНовомуГрафику();
		ПогашениеАвансаИЕгоАмортизацияВСоставеППА();
		Движения._УчетДолгосрочнойАренды.Записать(); 
		КорректировкаОПС();
		// Нет возврата - идем в общие процедуры
		
	ИначеЕсли ВидГрафика = Перечисления._ВидыГрафиковДолгосрочнойАренды.Сторно Тогда
		
		СторноПредыдущегоДокумента();
		Движения._УчетДолгосрочнойАренды.Записать();
		СторноПроводокБУиНУ();
		Возврат;
		
	КонецЕсли;
	
	Движения._УчетДолгосрочнойАренды.Записать(); 
	ПроведениеПоБухгалтерскомуИНалоговомуУчету();	
	КорректировкаСПИ(); 

	РезультатПроверки = ПроверитьСбалансированностьГрафика(Договор, Дата);
	Если НЕ РезультатПроверки.БалансОк Тогда
	    Сообщить(РезультатПроверки.ТекстСообщения);
	КонецЕсли;	

КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Если ОбменДанными.Загрузка  Тогда
		Возврат;
	КонецЕсли; 
	
КонецПроцедуры

Процедура ПриЗаписи(Отказ)
	
	Если ОбменДанными.Загрузка  Тогда
		Возврат;
	КонецЕсли;
	
	КаскадноеУдалениеСтрокДетализации();
	
КонецПроцедуры  

Процедура КаскадноеУдалениеСтрокДетализации()
	
	//Каскадное удаление детализации в случае удаление строки графика
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ различные
	|	ГР.УИДСтрокиГрафика
	|ИЗ
	|	РегистрСведений._ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик КАК ГР
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ._ГрафикДоговораДолгосрочнойАренды.ГрафикПоДоговору КАК ДокГр
	|		ПО (ДокГр.Ссылка = ГР.График)
	|			И (ДокГр.УИДСтроки = ГР.УИДСтрокиГрафика)
	|ГДЕ
	|	ГР.График = &Ссылка
	|	И ДокГр.УИДСтроки ЕСТЬ NULL
	|";
	
	Запрос.Параметры.Вставить("Ссылка", Ссылка); 
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Выборка = РезультатЗапроса.Выбрать();
	Пока Выборка.Следующий() Цикл
		НаборДвижений = РегистрыСведений._ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.СоздатьНаборЗаписей(); 
		НаборДвижений.Отбор.График.Установить(Ссылка); 
		НаборДвижений.Отбор.УИДСтрокиГрафика.Установить(Выборка.УИДСтрокиГрафика); 
		НаборДвижений.Прочитать();
		НаборДвижений.Очистить();
		НаборДвижений.Записать();
	КонецЦикла;  
	
	//Каскадное удаление детализации в случае удаление объектаППА из договора
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ различные
	|	ГР.ОбъектППА
	|ИЗ
	|	РегистрСведений._ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик КАК ГР
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ._ГрафикДоговораДолгосрочнойАренды.СоставППА КАК ДокСостав
	|		ПО (ДокСостав.Ссылка = ГР.График)
	|			И (ДокСостав.ОбъектППА = ГР.ОбъектППА)
	|ГДЕ
	|	ГР.График = &Ссылка
	|	И ДокСостав.ОбъектППА ЕСТЬ NULL
	|";
	
	Запрос.Параметры.Вставить("Ссылка", Ссылка); 
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Выборка = РезультатЗапроса.Выбрать();
	Пока Выборка.Следующий() Цикл
		НаборДвижений = РегистрыСведений._ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.СоздатьНаборЗаписей(); 
		НаборДвижений.Отбор.График.Установить(Ссылка); 
		НаборДвижений.Отбор.ОбъектППА.Установить(Выборка.ОбъектППА); 
		НаборДвижений.Прочитать();
		НаборДвижений.Очистить();
		НаборДвижений.Записать();
	КонецЦикла; 	
	
КонецПроцедуры

Процедура РасторжениеДоговора(Отказ)
	
	Если ДатаРасторжения = Дата(1,1,1) Тогда
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыОстатки.График,
	|	_УчетДолгосрочнойАрендыОстатки.Договор,
	|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика,
	|	_УчетДолгосрочнойАрендыОстатки.Показатель,
	|	_УчетДолгосрочнойАрендыОстатки.ПериодГрафика,
	|	_УчетДолгосрочнойАрендыОстатки.ПериодДисконтирования,
	|	_УчетДолгосрочнойАрендыОстатки.ВидОС,
	|	СУММА(_УчетДолгосрочнойАрендыОстатки.Обязательство) КАК ОбязательствоОстаток,
	|	СУММА(_УчетДолгосрочнойАрендыОстатки.СтоимостьППА) КАК СтоимостьППАОстаток,
	|	СУММА(_УчетДолгосрочнойАрендыОстатки.НДС) КАК НДСОстаток
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки
	|ГДЕ
	|	_УчетДолгосрочнойАрендыОстатки.Период < &Дата
	|	И _УчетДолгосрочнойАрендыОстатки.Договор = &Договор
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыОстатки.График,
	|	_УчетДолгосрочнойАрендыОстатки.Договор,
	|	_УчетДолгосрочнойАрендыОстатки.Показатель,
	|	_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика,
	|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыОстатки.ПериодДисконтирования,
	|	_УчетДолгосрочнойАрендыОстатки.ВидОС,
	|	_УчетДолгосрочнойАрендыОстатки.ПериодГрафика
	|имеющие СУММА(_УчетДолгосрочнойАрендыОстатки.Обязательство) <> 0 или СУММА(_УчетДолгосрочнойАрендыОстатки.СтоимостьППА) <> 0";
	Запрос.Параметры.Вставить("Дата", Дата); 
	Запрос.Параметры.Вставить("Договор", Договор); 
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		ЗаполнитьЗначенияСвойств(Движение, ВыборкаДетальныеЗаписи);//,,"ВидДвиженияГрафика"); 
		Движение.Обязательство = -ВыборкаДетальныеЗаписи.ОбязательствоОстаток;
		Движение.СтоимостьППА = -ВыборкаДетальныеЗаписи.СтоимостьППАОстаток; 
		Движение.НДС = -ВыборкаДетальныеЗаписи.НДСОстаток; 
		Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Выбытие;
		Движение.Регистратор = ЭтотОбъект.Ссылка;  
		Движение.ИДСтроки = новый УникальныйИдентификатор;
		Движение.Период = Дата; 
		Движение.ДатаСобытия = ДатаРасторжения;
	КонецЦикла;
	
КонецПроцедуры

Процедура ПровестиЗаменуСтороныДоговора(Отказ)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыОстатки.График,
	|	_УчетДолгосрочнойАрендыОстатки.Договор,
	|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика,                                                                     
	|	_УчетДолгосрочнойАрендыОстатки.Показатель,
	|	_УчетДолгосрочнойАрендыОстатки.ПериодГрафика,
	|	_УчетДолгосрочнойАрендыОстатки.ПериодДисконтирования,
	|	_УчетДолгосрочнойАрендыОстатки.ВидОС,
	|	СУММА(_УчетДолгосрочнойАрендыОстатки.Обязательство) КАК ОбязательствоОстаток,
	|	СУММА(_УчетДолгосрочнойАрендыОстатки.СтоимостьППА) КАК СтоимостьППАОстаток,
	|	СУММА(_УчетДолгосрочнойАрендыОстатки.НДС) КАК НДСОстаток
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки
	|ГДЕ
	|	_УчетДолгосрочнойАрендыОстатки.Период < &Дата
	|	И _УчетДолгосрочнойАрендыОстатки.Договор = &Договор
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыОстатки.График,
	|	_УчетДолгосрочнойАрендыОстатки.Договор,
	|	_УчетДолгосрочнойАрендыОстатки.Показатель,
	|	_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика,
	|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыОстатки.ПериодДисконтирования,
	|	_УчетДолгосрочнойАрендыОстатки.ВидОС,
	|	_УчетДолгосрочнойАрендыОстатки.ПериодГрафика 
	| имеющие СУММА(_УчетДолгосрочнойАрендыОстатки.Обязательство) <> 0 или СУММА(_УчетДолгосрочнойАрендыОстатки.СтоимостьППА) <> 0
	|";
	Запрос.Параметры.Вставить("Дата", Дата); 
	Запрос.Параметры.Вставить("Договор", ПредыдущийДоговор); 
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		
		//Списание предыдущего договора
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		ЗаполнитьЗначенияСвойств(Движение, ВыборкаДетальныеЗаписи); 
		Движение.Обязательство = -ВыборкаДетальныеЗаписи.ОбязательствоОстаток;
		Движение.СтоимостьППА = -ВыборкаДетальныеЗаписи.СтоимостьППАОстаток;
		Движение.НДС = -ВыборкаДетальныеЗаписи.НДСОстаток; 
		Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Сторно;
		Движение.Регистратор = ЭтотОбъект.Ссылка;  
		Движение.ИДСтроки = новый УникальныйИдентификатор;
		Движение.Период = Дата;
		Движение.ДатаСобытия = ДатаЗаменыСтороны;
		
		//Начисление по новому договору
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		ЗаполнитьЗначенияСвойств(Движение, ВыборкаДетальныеЗаписи); 
		Движение.Обязательство = ВыборкаДетальныеЗаписи.ОбязательствоОстаток;
		Движение.СтоимостьППА = ВыборкаДетальныеЗаписи.СтоимостьППАОстаток; 
		Движение.НДС = ВыборкаДетальныеЗаписи.НДСОстаток; 
		Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Начисление;
		Движение.Договор = Договор;
		Движение.Регистратор = ЭтотОбъект.Ссылка;  
		Движение.ИДСтроки = новый УникальныйИдентификатор;
		Движение.Период = Дата; 
		Движение.ДатаСобытия = ДатаЗаменыСтороны;
		
	КонецЦикла;
	
КонецПроцедуры

Процедура СторноОстатковНаДатуНачала(ДатаСторно)
	
	ТЗСоставППА = СоставППА.Выгрузить();
	
	//Сторно стоимости ППА (< Даты начала)
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	т.ОбъектППА,
	|	т.ПоказательБазыРаспределения,
	|	т.СтоимостьППА
	|ПОМЕСТИТЬ ВТ_СписокППА
	|ИЗ
	|	&ТЗСоставППА КАК т
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.Показатель,
	|	_УчетДолгосрочнойАрендыостатки.ПериодГрафика,
	|	_УчетДолгосрочнойАрендыостатки.ПериодДисконтирования,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) КАК Обязательство,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА) КАК СтоимостьППА,
	|	ВЫБОР
	|		КОГДА ВТ_СписокППА.ОбъектППА ЕСТЬ NULL
	|				ИЛИ ВТ_СписокППА.ПоказательБазыРаспределения = 0
	|				ИЛИ ВТ_СписокППА.СтоимостьППА = 0
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК Выбытие
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СписокППА КАК ВТ_СписокППА
	|		ПО (ВТ_СписокППА.ОбъектППА = _УчетДолгосрочнойАрендыостатки.ОбъектППА)
	|ГДЕ
	|	_УчетДолгосрочнойАрендыостатки.Период < &ДатаДокумента
	|	И _УчетДолгосрочнойАрендыостатки.Договор = &Договор
	|	И _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
	|
	|СГРУППИРОВАТЬ ПО
	|	ВЫБОР
	|		КОГДА ВТ_СписокППА.ОбъектППА ЕСТЬ NULL
	|				ИЛИ ВТ_СписокППА.ПоказательБазыРаспределения = 0
	|				ИЛИ ВТ_СписокППА.СтоимостьППА = 0
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ,
	|	_УчетДолгосрочнойАрендыостатки.Показатель,
	|	_УчетДолгосрочнойАрендыостатки.ПериодДисконтирования,
	|	_УчетДолгосрочнойАрендыостатки.ПериодГрафика,
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА 
	| имеющие СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) <> 0 или  СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА) <> 0
	|";
	
	Запрос.Параметры.Вставить("ДатаНачала", ДатаНачала); 
	Запрос.Параметры.Вставить("Договор", Договор); 
	Запрос.Параметры.Вставить("ДатаДокумента", Дата);
	Запрос.Параметры.Вставить("ТЗСоставППА", ТЗСоставППА);
	
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	Пока Выборка.Следующий() Цикл
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		Движение.Период = Дата;
		Движение.ДатаСобытия = ДатаНачала;
		Движение.Договор = Выборка.Договор; 
		Движение.График = Ссылка;
		Движение.ОбъектППА = Выборка.ОбъектППА;
		Движение.ИДСтроки = Новый УникальныйИдентификатор;
		
		Если Выборка.Выбытие Тогда
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Выбытие;
		Иначе			
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Корректировка;
		КонецЕсли;
		
		Движение.Показатель = Выборка.Показатель;
		Движение.ПериодГрафика =  Дата(1,1,1);
		Движение.ПериодДисконтирования = ДатаНачала; 
		Движение.Обязательство = -Выборка.Обязательство;
		Движение.СтоимостьППА = -Выборка.СтоимостьППА;
	КонецЦикла;	
	
	//Сторно амортизации, процентов, арендных платежей - это будущая часть графика (т.к. >= датаНачала)
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	т.ОбъектППА,
	|	т.ПоказательБазыРаспределения,
	|	т.СтоимостьППА
	|ПОМЕСТИТЬ ВТ_СписокППА
	|ИЗ
	|	&ТЗСоставППА КАК т
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.Показатель,
	|	_УчетДолгосрочнойАрендыостатки.ПериодГрафика,
	|	_УчетДолгосрочнойАрендыостатки.ПериодДисконтирования,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) КАК Обязательство,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.НДС) КАК НДС,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА) КАК СтоимостьППА,
	|	ВЫБОР
	|		КОГДА ВТ_СписокППА.ОбъектППА ЕСТЬ NULL
	|				ИЛИ ВТ_СписокППА.ПоказательБазыРаспределения = 0
	|				ИЛИ ВТ_СписокППА.СтоимостьППА = 0
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК Выбытие
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СписокППА КАК ВТ_СписокППА
	|		ПО (ВТ_СписокППА.ОбъектППА = _УчетДолгосрочнойАрендыостатки.ОбъектППА)
	|ГДЕ
	|	_УчетДолгосрочнойАрендыостатки.Период < &ДатаДокумента
	|	И _УчетДолгосрочнойАрендыостатки.Договор = &Договор
	|	И _УчетДолгосрочнойАрендыостатки.ПериодГрафика >= &ДатаНачала
	|	И НЕ _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
	|	И НЕ _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.ПериодДисконтирования,
	|	ВЫБОР
	|		КОГДА ВТ_СписокППА.ОбъектППА ЕСТЬ NULL
	|				ИЛИ ВТ_СписокППА.ПоказательБазыРаспределения = 0
	|				ИЛИ ВТ_СписокППА.СтоимостьППА = 0
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ,
	|	_УчетДолгосрочнойАрендыостатки.ПериодГрафика,
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	_УчетДолгосрочнойАрендыостатки.Показатель
	|
	|ИМЕЮЩИЕ
	|	(СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) <> 0
	|		ИЛИ СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА) <> 0)";
	
	Запрос.Параметры.Вставить("ДатаНачала", ДатаСторно); 
	Запрос.Параметры.Вставить("Договор", Договор); 
	Запрос.Параметры.Вставить("ДатаДокумента", Дата); 
	Запрос.Параметры.Вставить("ТЗСоставППА", ТЗСоставППА);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Выборка = РезультатЗапроса.Выбрать();
	
	Пока Выборка.Следующий() Цикл 
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		Движение.График = Ссылка;
		Движение.Период = Дата;
		Движение.Договор = Выборка.Договор;
		Движение.ОбъектППА = Выборка.ОбъектППА; 
		Движение.ИДСтроки = Новый УникальныйИдентификатор;
		
		Если Выборка.Выбытие тогда
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Выбытие;
		Иначе
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Сторно;
		КонецЕсли;
		
		Движение.Показатель = Выборка.Показатель;
		Движение.ПериодГрафика = Выборка.ПериодГрафика;
		Движение.ПериодДисконтирования = Выборка.ПериодДисконтирования;
		Движение.Обязательство = -Выборка.Обязательство;
		Движение.НДС = -Выборка.НДС; 
		Движение.СтоимостьППА = -Выборка.СтоимостьППА;
		Движение.ДатаСобытия = ДатаНачала;
		
	КонецЦикла;  
	
	//СторноПриведеннойСтоимости
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	т.ОбъектППА,
	|	т.ПоказательБазыРаспределения,
	|	т.СтоимостьППА
	|ПОМЕСТИТЬ ВТ_СписокППА
	|ИЗ
	|	&ТЗСоставППА КАК т
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.Показатель,
	|	_УчетДолгосрочнойАрендыостатки.ПериодГрафика,
	|	_УчетДолгосрочнойАрендыостатки.ПериодДисконтирования,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) КАК Обязательство,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА) КАК СтоимостьППА,
	|	ВЫБОР
	|		КОГДА ВТ_СписокППА.ОбъектППА ЕСТЬ NULL
	|				ИЛИ ВТ_СписокППА.ПоказательБазыРаспределения = 0
	|				ИЛИ ВТ_СписокППА.СтоимостьППА = 0
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК Выбытие
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СписокППА КАК ВТ_СписокППА
	|		ПО (ВТ_СписокППА.ОбъектППА = _УчетДолгосрочнойАрендыостатки.ОбъектППА)
	|ГДЕ
	|	_УчетДолгосрочнойАрендыостатки.Период < &ДатаДокумента
	|	И _УчетДолгосрочнойАрендыостатки.Договор = &Договор
	|	И _УчетДолгосрочнойАрендыостатки.ПериодДисконтирования >= &ДатаНачала
	|	И _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыостатки.ПериодДисконтирования,
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	_УчетДолгосрочнойАрендыостатки.ПериодГрафика,
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	ВЫБОР
	|		КОГДА ВТ_СписокППА.ОбъектППА ЕСТЬ NULL
	|				ИЛИ ВТ_СписокППА.ПоказательБазыРаспределения = 0
	|				ИЛИ ВТ_СписокППА.СтоимостьППА = 0
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ,
	|	_УчетДолгосрочнойАрендыостатки.Показатель
	|
	|ИМЕЮЩИЕ
	|	СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) <> 0";
	
	Запрос.Параметры.Вставить("ТЗСоставППА", ТЗСоставППА);
	Запрос.Параметры.Вставить("ДатаНачала", ДатаСторно); 
	Запрос.Параметры.Вставить("Договор", Договор); 
	Запрос.Параметры.Вставить("ДатаДокумента", Дата); 
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Выборка = РезультатЗапроса.Выбрать();
	
	Пока Выборка.Следующий() Цикл 
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		Движение.График = Ссылка;
		Движение.Период = Дата;
		Движение.Договор = Выборка.Договор;
		Движение.ОбъектППА = Выборка.ОбъектППА; 
		Движение.ИДСтроки = Новый УникальныйИдентификатор;
		Если Выборка.Выбытие Тогда
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Выбытие;
		Иначе			
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Корректировка;
		КонецЕсли;
		Движение.Показатель = Выборка.Показатель;
		Движение.ПериодГрафика = Дата(1,1,1);
		Движение.ПериодДисконтирования = Выборка.ПериодДисконтирования;
		Движение.Обязательство = -Выборка.Обязательство;  
		Движение.ДатаСобытия = ДатаНачала;
		
	КонецЦикла;
	
	СписатьОстаткиПриВыбытииОбъектаППА(ТЗСоставППА, ДатаСторно, Дата, Договор);
	
КонецПроцедуры

Процедура КорректировкаОПС()
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыостатки.График,
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.ВидДвиженияГрафика,
	|	_УчетДолгосрочнойАрендыостатки.Показатель,
	|	_УчетДолгосрочнойАрендыостатки.ПериодГрафика,
	|	_УчетДолгосрочнойАрендыостатки.ПериодДисконтирования,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) КАК ОбязательствоОстаток,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА) КАК СтоимостьППАОстаток,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА - _УчетДолгосрочнойАрендыостатки.Обязательство) КАК Отклонение
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
	|ГДЕ
	|	_УчетДолгосрочнойАрендыостатки.График = &График
	|	И _УчетДолгосрочнойАрендыостатки.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Корректировка)
	|	И (_УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
	|			ИЛИ _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА))
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыостатки.ПериодГрафика,
	|	_УчетДолгосрочнойАрендыостатки.ВидДвиженияГрафика,
	|	_УчетДолгосрочнойАрендыостатки.График,
	|	_УчетДолгосрочнойАрендыостатки.ПериодДисконтирования,
	|	_УчетДолгосрочнойАрендыостатки.Показатель,
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.Договор
	|
	|ИМЕЮЩИЕ
	|	(СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) <> 0
	|		ИЛИ СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА) <> 0)";
	
	Запрос.Параметры.Вставить("График", Ссылка);    
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Выборка = РезультатЗапроса.Выбрать();
	
	Пока Выборка.Следующий() Цикл 
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		Движение.Период = Дата;
		Движение.Договор = Выборка.Договор;
		Движение.График = Ссылка;
		Движение.ОбъектППА = Выборка.ОбъектППА;
		Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Корректировка;
		Движение.Показатель = Перечисления._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость;
		Движение.ПериодГрафика = Дата(1,1,1);//ДатаНачала;//Дата(1,1,2);//ДатаНачала;
		Движение.ПериодДисконтирования = ДатаНачала;
		Движение.Обязательство = Выборка.Отклонение;
		Движение.ИДСтроки = Новый УникальныйИдентификатор;
		Движение.ДатаСобытия = ДатаНачала;
	КонецЦикла;	
	
КонецПроцедуры

Процедура СоздатьЗаписиПоНовомуГрафику()
	
	//Новые строки графика
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ДокументГрафикДоговораДолгосрочнойАрендыСоставППА.ОбъектППА,
	|	ДокументГрафикДоговораДолгосрочнойАрендыСоставППА.Ссылка.Договор
	|ПОМЕСТИТЬ ВТ_СписокППА
	|ИЗ
	|	Документ._ГрафикДоговораДолгосрочнойАренды.СоставППА КАК ДокументГрафикДоговораДолгосрочнойАрендыСоставППА
	|ГДЕ
	|	ДокументГрафикДоговораДолгосрочнойАрендыСоставППА.Ссылка = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	МАКСИМУМ(_УчетДолгосрочнойАрендыостатки.График) КАК График,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА) КАК ПервоначальнаяСтоимость
	|ПОМЕСТИТЬ ВТ_СтарыеОбъекты
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
	|ГДЕ
	|	_УчетДолгосрочнойАрендыостатки.Период < &ДатаИтогов
	|	И _УчетДолгосрочнойАрендыостатки.ОбъектППА В
	|			(ВЫБРАТЬ
	|				ВТ_СписокППА.ОбъектППА
	|			ИЗ
	|				ВТ_СписокППА)
	|	И _УчетДолгосрочнойАрендыостатки.Договор В
	|			(ВЫБРАТЬ
	|				ВТ_СписокППА.Договор
	|			ИЗ
	|				ВТ_СписокППА)
	|	И _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.Договор
	|
	|ИМЕЮЩИЕ
	|	ОКР(СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА), 2) <> 0
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.УИДСтрокиГрафика,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбъектППА,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.График,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.АренднаяПлата,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.НДС,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ПриведеннаяСтоимость,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ПроцентныеРасходы,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбязательствоНаНачало,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ИзменениеОбязательства,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбязательствоНаКонец,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ДолгосрочнаяЧасть,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.КраткосрочнаяЧасть,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.СтоимостьППА,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.Амортизация,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.АмортизацияНакопленная,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.БалансоваяСтоимость,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.АктивностьСтроки,
	|	ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.ДатаС,
	|	ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.ДатаПо КАК ДатаПо,
	|	ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.Дней,
	|	ВЫБОР
	|		КОГДА ВТ_СтарыеОбъекты.ОбъектППА ЕСТЬ NULL
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЭтоНовыйОбъект
	|ИЗ
	|	Документ._ГрафикДоговораДолгосрочнойАренды.ГрафикПоДоговору КАК ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений._ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик КАК _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ._ГрафикДоговораДолгосрочнойАренды.СоставППА КАК Состав
	|			ПО (Состав.Ссылка = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.График)
	|				И (Состав.ОбъектППА = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбъектППА)
	|		ПО ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.Ссылка = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.График
	|			И ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.УИДСтроки = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.УИДСтрокиГрафика
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СтарыеОбъекты КАК ВТ_СтарыеОбъекты
	|		ПО (ВТ_СтарыеОбъекты.ОбъектППА = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбъектППА)
	|ГДЕ
	|	ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.Ссылка = &Ссылка"; 
	
	Запрос.Параметры.Вставить("Ссылка", Ссылка); 	
	Запрос.Параметры.Вставить("ДатаИтогов", Дата);
	
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	Пока Выборка.Следующий() Цикл
		
		//Приведенная стоимость Начисление
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		Движение.Период = Дата;
		Движение.Договор = Договор;
		Движение.График = Ссылка;
		Движение.ОбъектППА = Выборка.ОбъектППА;
		Если Выборка.ЭтоНовыйОбъект = Ложь Тогда
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Корректировка;
		Иначе	
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Поступление;
		КонецЕсли;
		Движение.Показатель = перечисления._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость;
		Движение.ПериодГрафика =  Дата(1,1,1);
		Движение.ПериодДисконтирования = выборка.ДатаПо;
		Движение.Обязательство = Выборка.ПриведеннаяСтоимость;
		Движение.СтоимостьППА = 0;
		Движение.ИДСтроки = Новый УникальныйИдентификатор; 
		Движение.ДатаСобытия = ДатаНачала;
		
		//АрендныеПлатежи Начисление
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		Движение.Период = Дата;
		Движение.Договор = Договор;
		Движение.График = Ссылка;
		Движение.ОбъектППА = Выборка.ОбъектППА;
		Движение.ИДСтроки = Новый УникальныйИдентификатор;
		Если Выборка.ЭтоНовыйОбъект = Ложь Тогда
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Начисление;
		Иначе	
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Поступление;
		КонецЕсли;
		
		Движение.Показатель = перечисления._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи;
		Движение.ПериодГрафика = Выборка.ДатаПо;
		Движение.ПериодДисконтирования = Дата(1,1,1);
		Движение.Обязательство = -Выборка.АренднаяПлата;  
		Движение.НДС = -Выборка.НДС;  
		Движение.СтоимостьППА = 0; 
		Движение.ДатаСобытия = ДатаНачала;
		
		//Проценты Начисление
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		Движение.Период = Дата;
		Движение.Договор = Договор;
		Движение.График = Ссылка;
		Движение.ОбъектППА = Выборка.ОбъектППА;  
		Движение.ИДСтроки = Новый УникальныйИдентификатор;
		Если Выборка.ЭтоНовыйОбъект = Ложь Тогда
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Начисление;
		Иначе	
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Поступление;
		КонецЕсли;
		Движение.Показатель = перечисления._ПоказателиГрафиковДолгосрочнойАренды.Проценты;
		Движение.ПериодГрафика = Выборка.ДатаПо;
		Движение.ПериодДисконтирования = Дата(1,1,1);
		Движение.Обязательство = Выборка.ПроцентныеРасходы;
		Движение.СтоимостьППА = 0;  
		Движение.ДатаСобытия = ДатаНачала;
		
		//АмортизацияППА Начисление
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		Движение.Период = Дата;
		Движение.Договор = Договор; 
		Движение.График = Ссылка;
		Движение.ОбъектППА = Выборка.ОбъектППА;
		Движение.ИДСтроки = Новый УникальныйИдентификатор;
		Если Выборка.ЭтоНовыйОбъект = Ложь Тогда
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Начисление;
		Иначе	
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Поступление;
		КонецЕсли;
		Движение.Показатель = перечисления._ПоказателиГрафиковДолгосрочнойАренды.АмортизацияППА;
		Движение.ПериодГрафика = Выборка.ДатаПо;
		Движение.ПериодДисконтирования = Дата(1,1,1);
		Движение.Обязательство = 0;
		Движение.СтоимостьППА = -Выборка.Амортизация; 
		Движение.ДатаСобытия = ДатаНачала;
	КонецЦикла;
	
КонецПроцедуры

Процедура НачислениеПервоначальнойСтоимостиППА()
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ДокументГрафикДоговораДолгосрочнойАрендыСоставППА.ОбъектППА,
	|	ДокументГрафикДоговораДолгосрочнойАрендыСоставППА.Ссылка.Договор
	|ПОМЕСТИТЬ ВТ_СписокППА
	|ИЗ
	|	Документ._ГрафикДоговораДолгосрочнойАренды.СоставППА КАК ДокументГрафикДоговораДолгосрочнойАрендыСоставППА
	|ГДЕ
	|	ДокументГрафикДоговораДолгосрочнойАрендыСоставППА.Ссылка = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	МАКСИМУМ(_УчетДолгосрочнойАрендыостатки.График) КАК График,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА) КАК ПервоначальнаяСтоимость
	|ПОМЕСТИТЬ ВТ_СтарыеОбъекты
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
	|ГДЕ
	|	_УчетДолгосрочнойАрендыостатки.Период < &ДатаИтогов
	|	И _УчетДолгосрочнойАрендыостатки.ОбъектППА В
	|			(ВЫБРАТЬ
	|				ВТ_СписокППА.ОбъектППА
	|			ИЗ
	|				ВТ_СписокППА)
	|	И _УчетДолгосрочнойАрендыостатки.Договор В
	|			(ВЫБРАТЬ
	|				ВТ_СписокППА.Договор
	|			ИЗ
	|				ВТ_СписокППА)
	|	И _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.Договор
	|
	|ИМЕЮЩИЕ
	|	ОКР(СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА), 2) <> 0
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбъектППА,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.СтоимостьППА,
	|	ВЫБОР
	|		КОГДА ВТ_СтарыеОбъекты.ОбъектППА ЕСТЬ NULL
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЭтоНовыйОбъект
	|ИЗ
	|	Документ._ГрафикДоговораДолгосрочнойАренды.ГрафикПоДоговору КАК ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений._ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик КАК _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ._ГрафикДоговораДолгосрочнойАренды.СоставППА КАК Состав
	|			ПО (Состав.Ссылка = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.График)
	|				И (Состав.ОбъектППА = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбъектППА)
	|		ПО ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.Ссылка = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.График
	|			И ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.УИДСтроки = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.УИДСтрокиГрафика
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СтарыеОбъекты КАК ВТ_СтарыеОбъекты
	|		ПО (ВТ_СтарыеОбъекты.ОбъектППА = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбъектППА)
	|ГДЕ
	|	ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.Ссылка = &Ссылка
	|
	|СГРУППИРОВАТЬ ПО
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбъектППА,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.СтоимостьППА,
	|	ВЫБОР
	|		КОГДА ВТ_СтарыеОбъекты.ОбъектППА ЕСТЬ NULL
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ";
	
	Запрос.Параметры.Вставить("Ссылка", Ссылка); 
	
	Запрос.Параметры.Вставить("ДатаИтогов", Дата);
	
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	Пока Выборка.Следующий() Цикл    
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		Движение.ИДСтроки = Новый УникальныйИдентификатор;
		Движение.Период = Дата;
		Движение.Договор = Договор;  
		Движение.График = Ссылка;
		Движение.ОбъектППА = Выборка.ОбъектППА; 
		Если Выборка.ЭтоНовыйОбъект  Тогда
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Поступление;
		Иначе	
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Корректировка;
		КонецЕсли;
		Движение.Показатель = Перечисления._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА;
		Движение.ПериодГрафика = Дата(1,1,1);
		Движение.ПериодДисконтирования = ДатаНачала;
		Движение.СтоимостьППА =  Выборка.СтоимостьППА; 
		Движение.ДатаСобытия = ДатаНачала;
	КонецЦикла;
	
КонецПроцедуры  

Процедура КапитализацияАванса()
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ДокументГрафикДоговораДолгосрочнойАрендыСоставППА.ОбъектППА,
	|	ДокументГрафикДоговораДолгосрочнойАрендыСоставППА.Ссылка.Договор,
	|	ДокументГрафикДоговораДолгосрочнойАрендыСоставППА.Аванс
	|ПОМЕСТИТЬ ВТ_СписокППА
	|ИЗ
	|	Документ._ГрафикДоговораДолгосрочнойАренды.СоставППА КАК ДокументГрафикДоговораДолгосрочнойАрендыСоставППА
	|ГДЕ
	|	ДокументГрафикДоговораДолгосрочнойАрендыСоставППА.Ссылка = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	МАКСИМУМ(_УчетДолгосрочнойАрендыостатки.График) КАК График
	|ПОМЕСТИТЬ ВТ_СтарыеОбъекты
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
	|ГДЕ
	|	_УчетДолгосрочнойАрендыостатки.Период < &ДатаИтогов
	|	И _УчетДолгосрочнойАрендыостатки.ОбъектППА В
	|			(ВЫБРАТЬ
	|				ВТ_СписокППА.ОбъектППА
	|			ИЗ
	|				ВТ_СписокППА)
	|	И _УчетДолгосрочнойАрендыостатки.Договор В
	|			(ВЫБРАТЬ
	|				ВТ_СписокППА.Договор
	|			ИЗ
	|				ВТ_СписокППА)
	|	И _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.Договор
	|
	|ИМЕЮЩИЕ
	|	ОКР(СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА), 2) <> 0
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_СписокППА.ОбъектППА,
	|	ВТ_СписокППА.Аванс,
	|	ВЫБОР
	|		КОГДА ВТ_СтарыеОбъекты.ОбъектППА ЕСТЬ NULL
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЭтоНовыйОбъект
	|ИЗ
	|	ВТ_СписокППА КАК ВТ_СписокППА
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СтарыеОбъекты КАК ВТ_СтарыеОбъекты
	|		ПО (ВТ_СтарыеОбъекты.ОбъектППА = ВТ_СписокППА.ОбъектППА)
	|			И (ВТ_СтарыеОбъекты.Договор = ВТ_СписокППА.Договор)";
	
	Запрос.Параметры.Вставить("Ссылка", Ссылка); 
	
	Запрос.Параметры.Вставить("ДатаИтогов", Дата);
	
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	Пока Выборка.Следующий() Цикл    
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		Движение.ИДСтроки = Новый УникальныйИдентификатор;
		Движение.Период = Дата;
		Движение.Договор = Договор;  
		Движение.График = Ссылка;
		Движение.ОбъектППА = Выборка.ОбъектППА; 
		Если Выборка.ЭтоНовыйОбъект  Тогда
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Поступление;
		Иначе	
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Корректировка;
		КонецЕсли;
		Движение.Показатель = Перечисления._ПоказателиГрафиковДолгосрочнойАренды.КапитализацияАванса;
		Движение.ПериодГрафика = Дата(1,1,1);
		Движение.ПериодДисконтирования = ДатаНачала;
		Движение.АвансАктив =  Выборка.Аванс; 
		Движение.ДатаСобытия = ДатаНачала;
	КонецЦикла;
	
КонецПроцедуры 

Процедура ПризнаниеОбязательстваПоАвансу()
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ДокументГрафикДоговораДолгосрочнойАрендыСоставППА.ОбъектППА,
	|	ДокументГрафикДоговораДолгосрочнойАрендыСоставППА.Ссылка.Договор,
	|	ДокументГрафикДоговораДолгосрочнойАрендыСоставППА.Аванс
	|ПОМЕСТИТЬ ВТ_СписокППА
	|ИЗ
	|	Документ._ГрафикДоговораДолгосрочнойАренды.СоставППА КАК ДокументГрафикДоговораДолгосрочнойАрендыСоставППА
	|ГДЕ
	|	ДокументГрафикДоговораДолгосрочнойАрендыСоставППА.Ссылка = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	МАКСИМУМ(_УчетДолгосрочнойАрендыостатки.График) КАК График
	|ПОМЕСТИТЬ ВТ_СтарыеОбъекты
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
	|ГДЕ
	|	_УчетДолгосрочнойАрендыостатки.Период < &ДатаИтогов
	|	И _УчетДолгосрочнойАрендыостатки.ОбъектППА В
	|			(ВЫБРАТЬ
	|				ВТ_СписокППА.ОбъектППА
	|			ИЗ
	|				ВТ_СписокППА)
	|	И _УчетДолгосрочнойАрендыостатки.Договор В
	|			(ВЫБРАТЬ
	|				ВТ_СписокППА.Договор
	|			ИЗ
	|				ВТ_СписокППА)
	|	И _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.Договор
	|
	|ИМЕЮЩИЕ
	|	ОКР(СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА), 2) <> 0
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбъектППА,
	|	ВЫБОР
	|		КОГДА ВТ_СтарыеОбъекты.ОбъектППА ЕСТЬ NULL
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЭтоНовыйОбъект,
	|	СУММА(_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ЗачетАванса) КАК Аванс,
	|	СУММА(_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.НДСсАванса) КАК НДСсАванса
	|ИЗ
	|	Документ._ГрафикДоговораДолгосрочнойАренды.ГрафикПоДоговору КАК ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений._ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик КАК _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ._ГрафикДоговораДолгосрочнойАренды.СоставППА КАК Состав
	|			ПО (Состав.Ссылка = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.График)
	|				И (Состав.ОбъектППА = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбъектППА)
	|		ПО ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.Ссылка = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.График
	|			И ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.УИДСтроки = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.УИДСтрокиГрафика
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СтарыеОбъекты КАК ВТ_СтарыеОбъекты
	|		ПО (ВТ_СтарыеОбъекты.ОбъектППА = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбъектППА)
	|ГДЕ
	|	ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.Ссылка = &Ссылка
	|
	|СГРУППИРОВАТЬ ПО
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбъектППА,
	|	ВЫБОР
	|		КОГДА ВТ_СтарыеОбъекты.ОбъектППА ЕСТЬ NULL
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ";
	
	Запрос.Параметры.Вставить("Ссылка", Ссылка); 
	
	Запрос.Параметры.Вставить("ДатаИтогов", Дата);
	
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	Пока Выборка.Следующий() Цикл 
		
		//АвансОбязательство Начисление
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		Движение.Период = Дата;
		Движение.Договор = Договор;
		Движение.График = Ссылка;
		Движение.ОбъектППА = Выборка.ОбъектППА;
		Движение.ИДСтроки = Новый УникальныйИдентификатор;
		Если Выборка.ЭтоНовыйОбъект = Ложь Тогда
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Начисление;
		Иначе	
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Поступление;
		КонецЕсли;
		Движение.Показатель = перечисления._ПоказателиГрафиковДолгосрочнойАренды.ВыдачаАванса;
		Движение.ПериодГрафика = ДатаНачала;
		Движение.ПериодДисконтирования = Дата(1,1,1);
		Движение.АвансОбязательство = Выборка.Аванс;  
		Движение.АвансНДС = Выборка.НДСсАванса;  
		Движение.ДатаСобытия = ДатаНачала;
		
	КонецЦикла;
	
КонецПроцедуры 

Процедура ПогашениеАвансаИЕгоАмортизацияВСоставеППА()
	
	//Новые строки графика
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ДокументГрафикДоговораДолгосрочнойАрендыСоставППА.ОбъектППА,
	|	ДокументГрафикДоговораДолгосрочнойАрендыСоставППА.Ссылка.Договор
	|ПОМЕСТИТЬ ВТ_СписокППА
	|ИЗ
	|	Документ._ГрафикДоговораДолгосрочнойАренды.СоставППА КАК ДокументГрафикДоговораДолгосрочнойАрендыСоставППА
	|ГДЕ
	|	ДокументГрафикДоговораДолгосрочнойАрендыСоставППА.Ссылка = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	МАКСИМУМ(_УчетДолгосрочнойАрендыостатки.График) КАК График,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА) КАК ПервоначальнаяСтоимость
	|ПОМЕСТИТЬ ВТ_СтарыеОбъекты
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
	|ГДЕ
	|	_УчетДолгосрочнойАрендыостатки.Период < &ДатаИтогов
	|	И _УчетДолгосрочнойАрендыостатки.ОбъектППА В
	|			(ВЫБРАТЬ
	|				ВТ_СписокППА.ОбъектППА
	|			ИЗ
	|				ВТ_СписокППА)
	|	И _УчетДолгосрочнойАрендыостатки.Договор В
	|			(ВЫБРАТЬ
	|				ВТ_СписокППА.Договор
	|			ИЗ
	|				ВТ_СписокППА)
	|	И _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.Договор
	|
	|ИМЕЮЩИЕ
	|	ОКР(СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА), 2) <> 0
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.УИДСтрокиГрафика,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбъектППА,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.График,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.АктивностьСтроки,
	|	ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.ДатаС,
	|	ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.ДатаПо КАК ДатаПо,
	|	ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.Дней,
	|	ВЫБОР
	|		КОГДА ВТ_СтарыеОбъекты.ОбъектППА ЕСТЬ NULL
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЭтоНовыйОбъект,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ЗачетАванса,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.НДСсАванса,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.АмортизацияАванса
	|ИЗ
	|	Документ._ГрафикДоговораДолгосрочнойАренды.ГрафикПоДоговору КАК ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений._ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик КАК _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ._ГрафикДоговораДолгосрочнойАренды.СоставППА КАК Состав
	|			ПО (Состав.Ссылка = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.График)
	|				И (Состав.ОбъектППА = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбъектППА)
	|		ПО ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.Ссылка = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.График
	|			И ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.УИДСтроки = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.УИДСтрокиГрафика
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СтарыеОбъекты КАК ВТ_СтарыеОбъекты
	|		ПО (ВТ_СтарыеОбъекты.ОбъектППА = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбъектППА)
	|ГДЕ
	|	ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.Ссылка = &Ссылка
	|	И (_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ЗачетАванса <> 0
	|	ИЛИ _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.АмортизацияАванса <> 0)"; 
	
	Запрос.Параметры.Вставить("Ссылка", Ссылка); 	
	Запрос.Параметры.Вставить("ДатаИтогов", Дата);
	
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	Пока Выборка.Следующий() Цикл
		
		Если Выборка.ЗачетАванса <> 0 Тогда
			//АрендныеПлатежи Начисление
			Движение = Движения._УчетДолгосрочнойАренды.Добавить();
			Движение.Период = Дата;
			Движение.Договор = Договор;
			Движение.График = Ссылка;
			Движение.ОбъектППА = Выборка.ОбъектППА;
			Движение.ИДСтроки = Новый УникальныйИдентификатор;
			Если Выборка.ЭтоНовыйОбъект = Ложь Тогда
				Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Начисление;
			Иначе	
				Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Поступление;
			КонецЕсли;
			
			Движение.Показатель = перечисления._ПоказателиГрафиковДолгосрочнойАренды.ЗачетАванса;
			Движение.ПериодГрафика = Выборка.ДатаПо;
			Движение.ПериодДисконтирования = Дата(1,1,1);
			Движение.АвансОбязательство = -Выборка.ЗачетАванса;  
			Движение.АвансНДС = -Выборка.НДСсАванса;  
			Движение.ДатаСобытия = ДатаНачала;
		КонецЕсли;                            
		
		//АмортизацияППА Начисление
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		Движение.Период = Дата;
		Движение.Договор = Договор; 
		Движение.График = Ссылка;
		Движение.ОбъектППА = Выборка.ОбъектППА;
		Движение.ИДСтроки = Новый УникальныйИдентификатор;
		Если Выборка.ЭтоНовыйОбъект = Ложь Тогда
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Начисление;
		Иначе	
			Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Поступление;
		КонецЕсли;
		Движение.Показатель = перечисления._ПоказателиГрафиковДолгосрочнойАренды.АмортизацияАванса;
		Движение.ПериодГрафика = Выборка.ДатаПо;
		Движение.ПериодДисконтирования = Дата(1,1,1);
		
		Движение.АвансАктив = -Выборка.АмортизацияАванса; 
		Движение.ДатаСобытия = ДатаНачала;
	КонецЦикла;
	
КонецПроцедуры

Процедура ПроведениеПоБухгалтерскомуИНалоговомуУчету()
	
	Движения.Хозрасчетный.Записывать = Ложь;
	Движения.Хозрасчетный.Очистить();
	Движения.Налоговый.Записывать = Ложь;
	Движения.Налоговый.Очистить();
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыОстатки.Договор,
	|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
	|	СУММА(_УчетДолгосрочнойАрендыОстатки.Обязательство) КАК ОбязательствоОстаток,
	|	СУММА(_УчетДолгосрочнойАрендыОстатки.СтоимостьППА) КАК СтоимостьППАОстаток,
	|	СУММА(_УчетДолгосрочнойАрендыОстатки.Обязательство - _УчетДолгосрочнойАрендыОстатки.СтоимостьППА) КАК Отклонение
	|ПОМЕСТИТЬ ВТ_КорректировкиПриведеннойСтоимости_И_ППА
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки
	|ГДЕ
	|	_УчетДолгосрочнойАрендыОстатки.Период <= &ДатаДокумента
	|	И _УчетДолгосрочнойАрендыОстатки.График = &График
	|	И _УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Корректировка)
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыОстатки.Договор
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыОстатки.Договор,
	|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
	|	СУММА(_УчетДолгосрочнойАрендыОстатки.Обязательство) КАК АрендныеПлатежи,
	|	СУММА(_УчетДолгосрочнойАрендыОстатки.НДС) КАК НДС,
	|	СУММА(_УчетДолгосрочнойАрендыОстатки.Обязательство + _УчетДолгосрочнойАрендыОстатки.НДС) КАК АрендныеПлатежи_С_НДС
	|ПОМЕСТИТЬ ВТ_КорректировкиАрендныхПлатежей
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки
	|ГДЕ
	|	_УчетДолгосрочнойАрендыОстатки.Период <= &ДатаДокумента
	|	И _УчетДолгосрочнойАрендыОстатки.График = &График
	|	И (_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Начисление)
	|			ИЛИ _УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Сторно))
	|	И _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
	|	И НЕ _УчетДолгосрочнойАрендыОстатки.График.ПредыдущаяРедакция = ЗНАЧЕНИЕ(Документ._ГрафикДоговораДолгосрочнойАренды.ПустаяСсылка)
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыОстатки.Договор,
	|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыОстатки.Договор,
	|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
	|	СУММА(_УчетДолгосрочнойАрендыОстатки.Обязательство) КАК Проценты
	|ПОМЕСТИТЬ ВТ_КорректировкиПроцентов
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки
	|ГДЕ
	|	_УчетДолгосрочнойАрендыОстатки.Период <= &ДатаДокумента
	|	И _УчетДолгосрочнойАрендыОстатки.График = &График
	|	И (_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Начисление)
	|			ИЛИ _УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Сторно))
	|	И _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)
	|	И НЕ _УчетДолгосрочнойАрендыОстатки.График.ПредыдущаяРедакция = ЗНАЧЕНИЕ(Документ._ГрафикДоговораДолгосрочнойАренды.ПустаяСсылка)
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыОстатки.Договор
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_КорректировкиПриведеннойСтоимости_И_ППА.Договор,
	|	ВТ_КорректировкиПриведеннойСтоимости_И_ППА.ОбъектППА,
	|	ВТ_КорректировкиПриведеннойСтоимости_И_ППА.ОбязательствоОстаток,
	|	ВТ_КорректировкиПриведеннойСтоимости_И_ППА.СтоимостьППАОстаток,
	|	ВТ_КорректировкиПриведеннойСтоимости_И_ППА.Отклонение,
	|	0 КАК АрендныеПлатежи,
	|	0 КАК НДС,
	|	0 КАК АрендныеПлатежи_С_НДС,
	|	0 КАК Проценты
	|ПОМЕСТИТЬ ВТ_Общая
	|ИЗ
	|	ВТ_КорректировкиПриведеннойСтоимости_И_ППА КАК ВТ_КорректировкиПриведеннойСтоимости_И_ППА
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВТ_КорректировкиАрендныхПлатежей.Договор,
	|	ВТ_КорректировкиАрендныхПлатежей.ОбъектППА,
	|	0,
	|	0,
	|	0,
	|	ВТ_КорректировкиАрендныхПлатежей.АрендныеПлатежи,
	|	ВТ_КорректировкиАрендныхПлатежей.НДС,
	|	ВТ_КорректировкиАрендныхПлатежей.АрендныеПлатежи_С_НДС,
	|	0
	|ИЗ
	|	ВТ_КорректировкиАрендныхПлатежей КАК ВТ_КорректировкиАрендныхПлатежей
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВТ_КорректировкиПроцентов.Договор,
	|	ВТ_КорректировкиПроцентов.ОбъектППА,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	ВТ_КорректировкиПроцентов.Проценты
	|ИЗ
	|	ВТ_КорректировкиПроцентов КАК ВТ_КорректировкиПроцентов
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_Общая.Договор,
	|	ВТ_Общая.ОбъектППА,
	|	ВТ_Общая.ОбязательствоОстаток,
	|	ВТ_Общая.СтоимостьППАОстаток,
	|	ВТ_Общая.Отклонение,
	|	-ВТ_Общая.АрендныеПлатежи КАК АрендныеПлатежи,
	|	-ВТ_Общая.АрендныеПлатежи_С_НДС КАК АрендныеПлатежи_С_НДС,
	|	-ВТ_Общая.НДС КАК НДС,
	|	ВТ_Общая.Проценты,
	|	ВТ_Общая.ОбязательствоОстаток - ВТ_Общая.НДС + ВТ_Общая.Проценты КАК Счет76071,
	|	ВТ_Общая.ОбязательствоОстаток + ВТ_Общая.Проценты КАК Счет01К
	|ПОМЕСТИТЬ ВТ_Общая1
	|ИЗ
	|	ВТ_Общая КАК ВТ_Общая
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_Общая1.Договор,
	|	ВТ_Общая1.ОбъектППА,
	|	СУММА(ВТ_Общая1.ОбязательствоОстаток) КАК ОбязательствоОборот,
	|	СУММА(ВТ_Общая1.СтоимостьППАОстаток) КАК СтоимостьППАОборот,
	|	СУММА(ВТ_Общая1.Отклонение) КАК Отклонение,
	|	СУММА(ВТ_Общая1.АрендныеПлатежи) КАК АрендныеПлатежи,
	|	СУММА(ВТ_Общая1.АрендныеПлатежи_С_НДС) КАК АрендныеПлатежи_С_НДС,
	|	СУММА(ВТ_Общая1.НДС) КАК НДС,
	|	СУММА(ВТ_Общая1.Проценты) КАК Проценты,
	|	СУММА(ВТ_Общая1.Счет76071) КАК Счет76071,
	|	СУММА(ВТ_Общая1.Счет01К) КАК Счет01К
	|ПОМЕСТИТЬ ВТ_Общая2
	|ИЗ
	|	ВТ_Общая1 КАК ВТ_Общая1
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_Общая1.Договор,
	|	ВТ_Общая1.ОбъектППА
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_Общая2.Договор,
	|	ВТ_Общая2.ОбъектППА,
	|	ВТ_Общая2.ОбязательствоОборот,
	|	ВТ_Общая2.СтоимостьППАОборот,
	|	ВТ_Общая2.Отклонение,
	|	ВТ_Общая2.АрендныеПлатежи,
	|	ВТ_Общая2.АрендныеПлатежи_С_НДС,
	|	ВТ_Общая2.НДС,
	|	ВТ_Общая2.Проценты,
	|	ВТ_Общая2.Счет76071,
	|	ВТ_Общая2.Счет01К,
	|	ВЫБОР
	|		КОГДА ВТ_Общая2.Отклонение МЕЖДУ -1 И 1
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК ЕстьПогрешность
	|ПОМЕСТИТЬ ВТ_Общая3
	|ИЗ
	|	ВТ_Общая2 КАК ВТ_Общая2
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_Общая3.Договор КАК ДоговорКонтрагента,
	|	ВТ_Общая3.Договор.Владелец КАК Контрагент,
	|	ВТ_Общая3.ОбъектППА КАК ОсновноеСредство,
	|	ВТ_Общая3.СтоимостьППАОборот,
	|	ВТ_Общая3.ОбязательствоОборот,
	|	ВТ_Общая3.Отклонение,
	|	ВТ_Общая3.АрендныеПлатежи,
	|	ВТ_Общая3.АрендныеПлатежи_С_НДС,
	|	ВТ_Общая3.НДС,
	|	ВТ_Общая3.Проценты,
	|	ВТ_Общая3.Счет76071,
	|	ВТ_Общая3.Счет01К,
	|	ВТ_Общая3.ЕстьПогрешность
	|ИЗ
	|	ВТ_Общая3 КАК ВТ_Общая3
	|";
	
	Запрос.Параметры.Вставить("ДатаДокумента", Дата+1); 
	Запрос.Параметры.Вставить("График", Ссылка); 
	
	Организация = Справочники.Организации.НайтиПоКоду("000000001");
	
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать(); 
	
	Пока Выборка.Следующий() Цикл 
		
		Если Окр(Выборка.ОбязательствоОборот,2) = 0 и Окр(Выборка.НДС,2) = 0 Тогда
			Продолжить;
		КонецЕсли;
		
		Если ОтражатьВБухгалтерскомУчете Тогда
			
			//01 76.07.1
			Если Окр(Выборка.СтоимостьППАОборот,2) <> 0 тогда
				ЗаписьНЗХ = Движения.Хозрасчетный.Добавить();
				ЗаписьНЗХ.СчетДт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("01.03");
				ЗаписьНЗХ.СчетКт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.1");
				ЗаписьНЗХ.Организация = Организация;
				ЗаписьНЗХ.Содержание = "Корректировка ППА и ОПС";
				ЗаписьНЗХ.Период =  Дата;
				ЗаписьНЗХ.Сумма = Выборка.СтоимостьППАОборот;
				
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, Выборка.ОсновноеСредство); 
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Выборка.Контрагент);
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 2, Выборка.ДоговорКонтрагента);   
			КонецЕсли;
			
			//76.07.5 76.07.1
			Если окр(Выборка.Проценты,2) <> 0 тогда
				ЗаписьНЗХ = Движения.Хозрасчетный.Добавить();
				ЗаписьНЗХ.СчетДт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.5");
				ЗаписьНЗХ.СчетКт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.1");
				ЗаписьНЗХ.Организация = Организация;
				ЗаписьНЗХ.Содержание = "Корректировка ППА и ОПС";
				ЗаписьНЗХ.Период =  Дата;
				ЗаписьНЗХ.Сумма = Выборка.Проценты;
				
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, Выборка.Контрагент); 
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 2, Выборка.ДоговорКонтрагента); 
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Выборка.Контрагент);
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 2, Выборка.ДоговорКонтрагента); 
			КонецЕсли;
			
			//76.07.9 76.07.1
			Если Окр(Выборка.НДС) <> 0 тогда
				ЗаписьНЗХ = Движения.Хозрасчетный.Добавить();
				ЗаписьНЗХ.СчетДт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.9");
				ЗаписьНЗХ.СчетКт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.1");
				ЗаписьНЗХ.Организация = Организация;
				ЗаписьНЗХ.Содержание = "Корректировка ППА и ОПС";
				ЗаписьНЗХ.Период =  Дата;
				ЗаписьНЗХ.Сумма = Выборка.НДС;
				
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, Выборка.Контрагент); 
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 2, Выборка.ДоговорКонтрагента); 
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Выборка.Контрагент);
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 2, Выборка.ДоговорКонтрагента);   
			КонецЕсли;	
		КонецЕсли;	
		Если ОтражатьВНалоговомУчете Тогда
			
			//ВР
			//01.03 
			Если Окр(Выборка.СтоимостьППАОборот,2) <> 0 тогда			
				ЗаписьНЗХ = Движения.Налоговый.Добавить();
				ЗаписьНЗХ.СчетДт = ПланыСчетов.Налоговый.НайтиПоКоду("01.03");
				ЗаписьНЗХ.СчетКт = ПланыСчетов.Налоговый.НайтиПоКоду("ПВ");
				ЗаписьНЗХ.Организация = Организация;
				ЗаписьНЗХ.Содержание = "Корректировка ППА и ОПС";
				ЗаписьНЗХ.Период =  Дата;
				ЗаписьНЗХ.Сумма = Выборка.СтоимостьППАОборот;
				
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, Выборка.ОсновноеСредство);
				
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Перечисления.УсловияПоступленияИВыбытияИмущества.ЗаПлату);
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 2, Выборка.Контрагент);
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 3, Выборка.ДоговорКонтрагента);
				
				ЗаписьНЗХ.ВидУчетаДт = Перечисления.ВидыУчетаПоПБУ18.Вр;
				ЗаписьНЗХ.ВидУчетаКт = Перечисления.ВидыУчетаПоПБУ18.Вр;
			КонецЕсли;
			
			//01.К
			//НУ
			Если Окр(Выборка.Счет01К,2) <> 0 тогда			
				ЗаписьНЗХ = Движения.Налоговый.Добавить();
				ЗаписьНЗХ.СчетДт = ПланыСчетов.Налоговый.НайтиПоКоду("01.К");
				ЗаписьНЗХ.СчетКт = ПланыСчетов.Налоговый.НайтиПоКоду("ПВ");
				ЗаписьНЗХ.Организация = Организация;
				ЗаписьНЗХ.Содержание = "Корректировка ППА и ОПС";
				ЗаписьНЗХ.Период =  Дата;
				ЗаписьНЗХ.Сумма = Выборка.Счет01К;
				
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, Выборка.ОсновноеСредство);
				
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Перечисления.УсловияПоступленияИВыбытияИмущества.Другие);
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 2, Выборка.Контрагент);
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 3, Выборка.ДоговорКонтрагента);
				
				ЗаписьНЗХ.ВидУчетаДт = Перечисления.ВидыУчетаПоПБУ18.НУ;
				ЗаписьНЗХ.ВидУчетаКт = Перечисления.ВидыУчетаПоПБУ18.НУ;
			
			
				//01.К
				//ВР  
				
				ЗаписьНЗХ = Движения.Налоговый.Добавить();
				ЗаписьНЗХ.СчетДт = ПланыСчетов.Налоговый.НайтиПоКоду("01.К");
				ЗаписьНЗХ.СчетКт = ПланыСчетов.Налоговый.НайтиПоКоду("ПВ");
				ЗаписьНЗХ.Организация = Организация;
				ЗаписьНЗХ.Содержание = "Корректировка ППА и ОПС";
				ЗаписьНЗХ.Период =  Дата;
				ЗаписьНЗХ.Сумма = -Выборка.Счет01К;
				
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, Выборка.ОсновноеСредство);
				
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Перечисления.УсловияПоступленияИВыбытияИмущества.Другие);
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 2, Выборка.Контрагент);
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 3, Выборка.ДоговорКонтрагента);
				
				ЗаписьНЗХ.ВидУчетаДт = Перечисления.ВидыУчетаПоПБУ18.ВР;
				ЗаписьНЗХ.ВидУчетаКт = Перечисления.ВидыУчетаПоПБУ18.ВР;
			
			КонецЕсли;
		КонецЕсли;			
		
	КонецЦикла; 
	
	СформироватьЗаписиРетроКорректировок();  
	
	Движения.Хозрасчетный.Записать();
	Движения.Налоговый.Записать();
	
КонецПроцедуры     

Процедура КорректировкаСПИ()  
	
	Если Не ОтражатьКорректировкуСПИ Тогда
		Возврат;
	КонецЕсли;
	
	Движения.ПараметрыАмортизацииОСБухгалтерскийУчет.Записывать = Ложь;
	Движения.ПараметрыАмортизацииОСБухгалтерскийУчет.Очистить(); 
	Движения.ПараметрыАмортизацииОСБухгалтерскийУчет.Записать();
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ГрафикДоговораДолгосрочнойАрендыСоставППА.ОбъектППА КАК ОсновноеСредство,
	|	ГрафикДоговораДолгосрочнойАрендыСоставППА.Ссылка КАК График
	|ПОМЕСТИТЬ ВТ_СписокОС
	|ИЗ
	|	Документ._ГрафикДоговораДолгосрочнойАренды.СоставППА КАК ГрафикДоговораДолгосрочнойАрендыСоставППА
	|ГДЕ
	|	ГрафикДоговораДолгосрочнойАрендыСоставППА.Ссылка = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПараметрыАмортизацииБухгалтерскийУчетСрезПоследних.Период,
	|	ПараметрыАмортизацииБухгалтерскийУчетСрезПоследних.Регистратор,
	|	ПараметрыАмортизацииБухгалтерскийУчетСрезПоследних.НомерСтроки,
	|	ПараметрыАмортизацииБухгалтерскийУчетСрезПоследних.Активность,
	|	ПараметрыАмортизацииБухгалтерскийУчетСрезПоследних.ОсновноеСредство,
	|	ПараметрыАмортизацииБухгалтерскийУчетСрезПоследних.Организация,
	|	ПараметрыАмортизацииБухгалтерскийУчетСрезПоследних.СрокПолезногоИспользования,
	|	ПараметрыАмортизацииБухгалтерскийУчетСрезПоследних.ОбъемПродукцииРабот,
	|	ПараметрыАмортизацииБухгалтерскийУчетСрезПоследних.СрокИспользованияДляВычисленияАмортизации,
	|	ПараметрыАмортизацииБухгалтерскийУчетСрезПоследних.СтоимостьДляВычисленияАмортизации,
	|	ПараметрыАмортизацииБухгалтерскийУчетСрезПоследних.ОбъемПродукцииРаботДляВычисленияАмортизации,
	|	ПараметрыАмортизацииБухгалтерскийУчетСрезПоследних.КоэффициентАмортизации,
	|	ПараметрыАмортизацииБухгалтерскийУчетСрезПоследних.КоэффициентУскорения,
	|	ПараметрыАмортизацииБухгалтерскийУчетСрезПоследних.ЛиквидационнаяСтоимость,
	|	ПараметрыАмортизацииБухгалтерскийУчетСрезПоследних.СпособНачисленияАмортизации
	|ПОМЕСТИТЬ ВТ_ПараметрыАмортизацииБухгалтерскийУчет
	|ИЗ
	|	РегистрСведений.ПараметрыАмортизацииОСБухгалтерскийУчет.СрезПоследних(
	|			КОНЕЦПЕРИОДА(&ДатаРасчета, МЕСЯЦ),
	|			Организация = &Организация
	|				И ОсновноеСредство В
	|					(ВЫБРАТЬ
	|						ВТ_СписокОС.ОсновноеСредство
	|					ИЗ
	|						ВТ_СписокОС)) КАК ПараметрыАмортизацииБухгалтерскийУчетСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СостоянияОСОрганизаций.ОсновноеСредство,
	|	МАКСИМУМ(СостоянияОСОрганизаций.ДатаСостояния) КАК ДатаВводаВЭксплуатацию
	|ПОМЕСТИТЬ ВТ_ДатыВвода
	|ИЗ
	|	РегистрСведений.СостоянияОСОрганизаций КАК СостоянияОСОрганизаций
	|ГДЕ
	|	СостоянияОСОрганизаций.Организация = &Организация
	|	И СостоянияОСОрганизаций.ОсновноеСредство В
	|			(ВЫБРАТЬ
	|				ВТ_СписокОС.ОсновноеСредство
	|			ИЗ
	|				ВТ_СписокОС)
	|	И СостоянияОСОрганизаций.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОС.ПринятоКУчету)
	|
	|СГРУППИРОВАТЬ ПО
	|	СостоянияОСОрганизаций.ОсновноеСредство
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА КАК ОсновноеСредство,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА) КАК ПервоначальнаяСтоимостьППАПоГрафикуНаОтчетнуюДату
	|ПОМЕСТИТЬ ВТ_ПервоначальнаяСтоимостьППАПоГрафикуНаОтчетнуюДату
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
	|ГДЕ
	|	_УчетДолгосрочнойАрендыостатки.Период <= КОНЕЦПЕРИОДА(&ДатаРасчета, ДЕНЬ)
	|	И _УчетДолгосрочнойАрендыостатки.ПериодГрафика < КОНЕЦПЕРИОДА(&ДатаРасчета, ДЕНЬ)
	|	И _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
	|	И _УчетДолгосрочнойАрендыостатки.ОбъектППА В
	|			(ВЫБРАТЬ
	|				ВТ_СписокОС.ОсновноеСредство
	|			ИЗ
	|				ВТ_СписокОС)
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА КАК ОсновноеСредство,
	|	МАКСИМУМ(_УчетДолгосрочнойАрендыостатки.ПериодГрафика) КАК ПоследнийМесяцАмортизацииПоГрафику
	|ПОМЕСТИТЬ ВТ_ПоследнийМесяцАмортизацииПоГрафику
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
	|ГДЕ
	|	_УчетДолгосрочнойАрендыостатки.Период <= КОНЕЦПЕРИОДА(&ДатаРасчета, ДЕНЬ)
	|	И _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.АмортизацияППА)
	|	И _УчетДолгосрочнойАрендыостатки.ОбъектППА В
	|			(ВЫБРАТЬ
	|				ВТ_СписокОС.ОсновноеСредство
	|			ИЗ
	|				ВТ_СписокОС)
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_СписокОС.ОсновноеСредство,
	|	ВТ_ПоследнийМесяцАмортизацииПоГрафику.ПоследнийМесяцАмортизацииПоГрафику,
	|	ВТ_ДатыВвода.ДатаВводаВЭксплуатацию,
	|	ВТ_ПервоначальнаяСтоимостьППАПоГрафикуНаОтчетнуюДату.ПервоначальнаяСтоимостьППАПоГрафикуНаОтчетнуюДату
	|ПОМЕСТИТЬ ВТ_ОстаткиИПараметры
	|ИЗ
	|	ВТ_СписокОС КАК ВТ_СписокОС
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ДатыВвода КАК ВТ_ДатыВвода
	|		ПО (ВТ_ДатыВвода.ОсновноеСредство = ВТ_СписокОС.ОсновноеСредство)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПервоначальнаяСтоимостьППАПоГрафикуНаОтчетнуюДату КАК ВТ_ПервоначальнаяСтоимостьППАПоГрафикуНаОтчетнуюДату
	|		ПО (ВТ_ПервоначальнаяСтоимостьППАПоГрафикуНаОтчетнуюДату.ОсновноеСредство = ВТ_СписокОС.ОсновноеСредство)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПоследнийМесяцАмортизацииПоГрафику КАК ВТ_ПоследнийМесяцАмортизацииПоГрафику
	|		ПО (ВТ_ПоследнийМесяцАмортизацииПоГрафику.ОсновноеСредство = ВТ_СписокОС.ОсновноеСредство)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_ОстаткиИПараметры.ОсновноеСредство,
	|	ВТ_ОстаткиИПараметры.ДатаВводаВЭксплуатацию,
	|	РАЗНОСТЬДАТ(ВТ_ОстаткиИПараметры.ДатаВводаВЭксплуатацию, ВТ_ОстаткиИПараметры.ПоследнийМесяцАмортизацииПоГрафику, МЕСЯЦ) КАК РасчетныйСрокПолезногоИспользования,
	|	ВТ_ОстаткиИПараметры.ПервоначальнаяСтоимостьППАПоГрафикуНаОтчетнуюДату
	|ИЗ
	|	ВТ_ОстаткиИПараметры КАК ВТ_ОстаткиИПараметры"; 
	
	мОрганизация = Справочники.Организации.НайтиПоКоду("000000001");
	Запрос.Параметры.Вставить("Организация", мОрганизация );
	Запрос.Параметры.Вставить("ДатаРасчета", Дата); 
	Запрос.Параметры.Вставить("Ссылка", Ссылка);
	
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	
	Пока Выборка.Следующий() Цикл
		Запись = Движения.ПараметрыАмортизацииОСБухгалтерскийУчет.Добавить();
		Запись.Период = Дата;
		Запись.ОсновноеСредство = Выборка.ОсновноеСредство;
		Запись.Организация = мОрганизация;
		Запись.СрокПолезногоИспользования = Выборка.РасчетныйСрокПолезногоИспользования;
		Запись.СрокИспользованияДляВычисленияАмортизации = Выборка.РасчетныйСрокПолезногоИспользования;
		Запись.СтоимостьДляВычисленияАмортизации = Выборка.ПервоначальнаяСтоимостьППАПоГрафикуНаОтчетнуюДату;
		Запись.СпособНачисленияАмортизации = Перечисления.СпособыНачисленияАмортизацииОС.Линейный;
	КонецЦикла;
	
	Движения.ПараметрыАмортизацииОСБухгалтерскийУчет.Записать();
	
КонецПроцедуры

Процедура СформироватьЗаписиРетроКорректировок()
	
	Если НЕ ОтразитьРетроКорректировку Тогда
		Возврат;
	КонецЕсли;
	
	Организация = Справочники.Организации.НайтиПоКоду("000000001");
	
	Для каждого Строка Из РетроКорректировки Цикл  
		
		СпособОтраженияРасходов = ПолучитьСпособОтраженияРасходовПоОС(Строка.ОбъектППА, Дата);
		Если НЕ СпособОтраженияРасходов = Неопределено  Тогда
			ПодразделениеОрганизации91 = СпособОтраженияРасходов.ПодразделениеОрганизации91;
		Иначе
			ПодразделениеОрганизации91 = Справочники.ПодразделенияОрганизаций.НайтиПоКоду("000001478"); //Санкт-Петербург
		КонецЕсли;
		
		//Бухгалтерский учет
		//Амортизация		
		Если Строка.Амортизация <> 0 тогда  
			ЗаписьНЗХ = Движения.Хозрасчетный.Добавить();
			ЗаписьНЗХ.СчетДт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("91.02.1");
			ЗаписьНЗХ.СчетКт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("02.03");
			ЗаписьНЗХ.Организация = Организация;
			ЗаписьНЗХ.Содержание = "Корректировка амортизации ППА за прошлые периоды";
			ЗаписьНЗХ.Период =  Дата;
			ЗаписьНЗХ.Сумма = Строка.Амортизация;  
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, СтатьяПДР_Амортизация); 
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 2, ПодразделениеОрганизации91); 
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Строка.ОбъектППА);
		КонецЕсли;
		
		//Проценты
		Если Строка.ПроцентныеРасходы <> 0 тогда
			ЗаписьНЗХ = Движения.Хозрасчетный.Добавить();
			ЗаписьНЗХ.СчетДт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("91.02.1");
			ЗаписьНЗХ.СчетКт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.5");
			ЗаписьНЗХ.Организация = Организация;
			ЗаписьНЗХ.Содержание = "Корректировка процентов по долгосрочной аренде за прошлые периоды";
			ЗаписьНЗХ.Период =  Дата;
			ЗаписьНЗХ.Сумма = Строка.ПроцентныеРасходы;  
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, СтатьяПДР_Проценты); 
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 2, ПодразделениеОрганизации91); 
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Договор.Владелец);
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 2, Договор);
		КонецЕсли;
		
		//АренднаяПлата
		Если Строка.АренднаяПлата <> 0 тогда
			ЗаписьНЗХ = Движения.Хозрасчетный.Добавить();
			ЗаписьНЗХ.СчетДт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.1");
			ЗаписьНЗХ.СчетКт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.2");
			ЗаписьНЗХ.Организация = Организация;
			ЗаписьНЗХ.Содержание = "Корректировка начисления арендной платы по долгосрочной аренде за прошлые периоды";
			ЗаписьНЗХ.Период =  Дата;
			ЗаписьНЗХ.Сумма = Строка.АренднаяПлата + Строка.НДС;  
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Договор.Владелец); 
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 2, Договор); 
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, Договор.Владелец);
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 2, Договор);
		КонецЕсли;
		
		//НДС
		Если Строка.НДС <> 0 тогда
			ЗаписьНЗХ = Движения.Хозрасчетный.Добавить();
			ЗаписьНЗХ.СчетДт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.1");
			ЗаписьНЗХ.СчетКт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.9");
			ЗаписьНЗХ.Организация = Организация;
			ЗаписьНЗХ.Содержание = "Корректировка НДС по долгосрочной аренде за прошлые периоды";
			ЗаписьНЗХ.Период =  Дата;
			ЗаписьНЗХ.Сумма = Строка.НДС;  
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, Договор.Владелец);
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 2, Договор);
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Договор.Владелец);
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 2, Договор);
		КонецЕсли;	
		
		//Налоговый учет
		//Амортизация		
		Если Строка.Амортизация <> 0 тогда  
			ЗаписьНЗХ = Движения.Налоговый.Добавить();
			ЗаписьНЗХ.СчетДт = ПланыСчетов.Налоговый.НайтиПоКоду("91.02.7");
			ЗаписьНЗХ.СчетКт = ПланыСчетов.Налоговый.НайтиПоКоду("02.03");
			ЗаписьНЗХ.Организация = Организация;
			ЗаписьНЗХ.Содержание = "Корректировка амортизации ППА за прошлые периоды";
			ЗаписьНЗХ.Период =  Дата;
			ЗаписьНЗХ.Сумма = Строка.Амортизация;  
			ЗаписьНЗХ.ВидУчетаДт = Перечисления.ВидыУчетаПоПБУ18.ВР;
			ЗаписьНЗХ.ВидУчетаКт = Перечисления.ВидыУчетаПоПБУ18.ВР;
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, СтатьяПДР_Амортизация); 
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Строка.ОбъектППА);
		КонецЕсли;
		
		//Проценты
		Если Строка.ПроцентныеРасходы <> 0 тогда
			
			//1
			ЗаписьНЗХ = Движения.Налоговый.Добавить();
			ЗаписьНЗХ.СчетДт = ПланыСчетов.Налоговый.НайтиПоКоду("91.02.7");
			ЗаписьНЗХ.СчетКт = ПланыСчетов.Налоговый.НайтиПоКоду("ПВ");
			ЗаписьНЗХ.Организация = Организация;
			ЗаписьНЗХ.Содержание = "Корректировка процентов по долгосрочной аренде за прошлые периоды";
			ЗаписьНЗХ.Период =  Дата;
			ЗаписьНЗХ.Сумма = Строка.ПроцентныеРасходы;  
			ЗаписьНЗХ.ВидУчетаДт = Перечисления.ВидыУчетаПоПБУ18.ВР;
			ЗаписьНЗХ.ВидУчетаКт = Перечисления.ВидыУчетаПоПБУ18.ВР;
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, СтатьяПДР_Проценты); 
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Перечисления.УсловияПоступленияИВыбытияИмущества.ЗаПлату);
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 2, Договор.Владелец);
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 3, Договор);
			
			////2
			//ЗаписьНЗХ = Движения.Налоговый.Добавить();
			//ЗаписьНЗХ.СчетДт = ПланыСчетов.Налоговый.НайтиПоКоду("НЕ.03");
			//ЗаписьНЗХ.Организация = Организация;
			//ЗаписьНЗХ.Содержание = "Корректировка процентов по долгосрочной аренде за прошлые периоды";
			//ЗаписьНЗХ.Период =  Дата;
			//ЗаписьНЗХ.Сумма = Строка.ПроцентныеРасходы;  
			//ЗаписьНЗХ.ВидУчетаДт = Перечисления.ВидыУчетаПоПБУ18.НУ;
		КонецЕсли;
		
		//АренднаяПлата
		Если Строка.АренднаяПлата <> 0 тогда 
			
			Если Строка.АренднаяПлата > 0 Тогда
				//1
				ЗаписьНЗХ = Движения.Налоговый.Добавить();
				ЗаписьНЗХ.СчетДт = ПланыСчетов.Налоговый.НайтиПоКоду("91.02.7");
				ЗаписьНЗХ.СчетКт = ПланыСчетов.Налоговый.НайтиПоКоду("01.К");
				ЗаписьНЗХ.Организация = Организация;
				ЗаписьНЗХ.Содержание = "Корректировка начисления арендной платы по долгосрочной аренде за прошлые периоды";
				ЗаписьНЗХ.Период =  Дата;
				ЗаписьНЗХ.Сумма = Строка.АренднаяПлата; 
				ЗаписьНЗХ.ВидУчетаДт = Перечисления.ВидыУчетаПоПБУ18.НУ;
				ЗаписьНЗХ.ВидУчетаКт = Перечисления.ВидыУчетаПоПБУ18.НУ;
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, СтатьяПДР_Проценты); 
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Строка.ОбъектППА);
				
				//2
				ЗаписьНЗХ = Движения.Налоговый.Добавить();
				ЗаписьНЗХ.СчетДт = ПланыСчетов.Налоговый.НайтиПоКоду("91.02.7");
				ЗаписьНЗХ.СчетКт = ПланыСчетов.Налоговый.НайтиПоКоду("01.К");
				ЗаписьНЗХ.Организация = Организация;
				ЗаписьНЗХ.Содержание = "Корректировка начисления арендной платы по долгосрочной аренде за прошлые периоды";
				ЗаписьНЗХ.Период =  Дата;
				ЗаписьНЗХ.Сумма = -Строка.АренднаяПлата; 
				ЗаписьНЗХ.ВидУчетаДт = Перечисления.ВидыУчетаПоПБУ18.ВР;
				ЗаписьНЗХ.ВидУчетаКт = Перечисления.ВидыУчетаПоПБУ18.ВР;
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, СтатьяПДР_Проценты); 
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Строка.ОбъектППА);
			КонецЕсли;                
			
			Если Строка.АренднаяПлата < 0 Тогда
				//1
				ЗаписьНЗХ = Движения.Налоговый.Добавить();
				ЗаписьНЗХ.СчетКт = ПланыСчетов.Налоговый.НайтиПоКоду("91.01.7");
				ЗаписьНЗХ.СчетДт = ПланыСчетов.Налоговый.НайтиПоКоду("01.К");
				ЗаписьНЗХ.Организация = Организация;
				ЗаписьНЗХ.Содержание = "Корректировка начисления арендной платы по долгосрочной аренде за прошлые периоды";
				ЗаписьНЗХ.Период =  Дата;
				ЗаписьНЗХ.Сумма = -Строка.АренднаяПлата; 
				ЗаписьНЗХ.ВидУчетаДт = Перечисления.ВидыУчетаПоПБУ18.НУ;
				ЗаписьНЗХ.ВидУчетаКт = Перечисления.ВидыУчетаПоПБУ18.НУ;
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, СтатьяПДР_Проценты); 
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, Строка.ОбъектППА);
				
				//2
				ЗаписьНЗХ = Движения.Налоговый.Добавить();
				ЗаписьНЗХ.СчетКт = ПланыСчетов.Налоговый.НайтиПоКоду("91.01.7");
				ЗаписьНЗХ.СчетДт = ПланыСчетов.Налоговый.НайтиПоКоду("01.К");
				ЗаписьНЗХ.Организация = Организация;
				ЗаписьНЗХ.Содержание = "Корректировка начисления арендной платы по долгосрочной аренде за прошлые периоды";
				ЗаписьНЗХ.Период =  Дата;
				ЗаписьНЗХ.Сумма = Строка.АренднаяПлата; 
				ЗаписьНЗХ.ВидУчетаДт = Перечисления.ВидыУчетаПоПБУ18.ВР;
				ЗаписьНЗХ.ВидУчетаКт = Перечисления.ВидыУчетаПоПБУ18.ВР;
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, СтатьяПДР_Проценты); 
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, Строка.ОбъектППА);
			КонецЕсли;                
			
			
			
			//// Смолина сказала, что корректировок 01К не должно быть на счете 91
			////1
			//ЗаписьНЗХ = Движения.Налоговый.Добавить();
			//ЗаписьНЗХ.СчетДт = ПланыСчетов.Налоговый.НайтиПоКоду("01.К");
			//ЗаписьНЗХ.СчетКт = ПланыСчетов.Налоговый.НайтиПоКоду("ПВ");
			//ЗаписьНЗХ.Организация = Организация;
			//ЗаписьНЗХ.Содержание = "Корректировка начисления арендной платы по долгосрочной аренде за прошлые периоды";
			//ЗаписьНЗХ.Период =  Дата;
			//ЗаписьНЗХ.Сумма = -Строка.АренднаяПлата; 
			//ЗаписьНЗХ.ВидУчетаДт = Перечисления.ВидыУчетаПоПБУ18.НУ;
			//ЗаписьНЗХ.ВидУчетаКт = Перечисления.ВидыУчетаПоПБУ18.НУ;
			//БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, Строка.ОбъектППА);
			//БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Перечисления.УсловияПоступленияИВыбытияИмущества.ЗаПлату);  
			//БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 2, Договор.Владелец);  
			//БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 3, Договор);  	
			//
			////2
			//ЗаписьНЗХ = Движения.Налоговый.Добавить();
			//ЗаписьНЗХ.СчетДт = ПланыСчетов.Налоговый.НайтиПоКоду("01.К");
			//ЗаписьНЗХ.СчетКт = ПланыСчетов.Налоговый.НайтиПоКоду("ПВ");
			//ЗаписьНЗХ.Организация = Организация;
			//ЗаписьНЗХ.Содержание = "Корректировка начисления арендной платы по долгосрочной аренде за прошлые периоды";
			//ЗаписьНЗХ.Период =  Дата;
			//ЗаписьНЗХ.Сумма = Строка.АренднаяПлата; 
			//ЗаписьНЗХ.ВидУчетаДт = Перечисления.ВидыУчетаПоПБУ18.ВР;
			//ЗаписьНЗХ.ВидУчетаКт = Перечисления.ВидыУчетаПоПБУ18.ВР;
			//БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, Строка.ОбъектППА);
			//БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Перечисления.УсловияПоступленияИВыбытияИмущества.ЗаПлату);  
			//БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 2, Договор.Владелец);  
			//БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 3, Договор);  	
			
		КонецЕсли;
		
	КонецЦикла;	
	
КонецПроцедуры

Процедура СписатьОстаткиПриВыбытииОбъектаППА(ТЗСоставППА, ДатаСторно, Дата, Договор)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	т.ОбъектППА,
	|	т.ПоказательБазыРаспределения,
	|	т.СтоимостьППА
	|ПОМЕСТИТЬ ВТ_СписокППА
	|ИЗ
	|	&ТЗСоставППА КАК т
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.Показатель,
	|	_УчетДолгосрочнойАрендыостатки.ПериодГрафика,
	|	_УчетДолгосрочнойАрендыостатки.ПериодДисконтирования,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) КАК Обязательство,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.НДС) КАК НДС,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА) КАК СтоимостьППА,
	|	ВЫБОР
	|		КОГДА ВТ_СписокППА.ОбъектППА ЕСТЬ NULL
	|				ИЛИ ВТ_СписокППА.ПоказательБазыРаспределения = 0
	|				ИЛИ ВТ_СписокППА.СтоимостьППА = 0
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК Выбытие
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СписокППА КАК ВТ_СписокППА
	|		ПО (ВТ_СписокППА.ОбъектППА = _УчетДолгосрочнойАрендыостатки.ОбъектППА)
	|ГДЕ
	|	_УчетДолгосрочнойАрендыостатки.Период < &ДатаДокумента
	|	И _УчетДолгосрочнойАрендыостатки.Договор = &Договор
	|	И _УчетДолгосрочнойАрендыостатки.ПериодГрафика < &ДатаНачала
	|	И НЕ _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
	|	И НЕ _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
	|	И ВЫБОР
	|			КОГДА ВТ_СписокППА.ОбъектППА ЕСТЬ NULL
	|					ИЛИ ВТ_СписокППА.ПоказательБазыРаспределения = 0
	|					ИЛИ ВТ_СписокППА.СтоимостьППА = 0
	|				ТОГДА ИСТИНА
	|			ИНАЧЕ ЛОЖЬ
	|		КОНЕЦ = ИСТИНА
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.ПериодДисконтирования,
	|	ВЫБОР
	|		КОГДА ВТ_СписокППА.ОбъектППА ЕСТЬ NULL
	|				ИЛИ ВТ_СписокППА.ПоказательБазыРаспределения = 0
	|				ИЛИ ВТ_СписокППА.СтоимостьППА = 0
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ,
	|	_УчетДолгосрочнойАрендыостатки.ПериодГрафика,
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	_УчетДолгосрочнойАрендыостатки.Показатель
	|
	|ИМЕЮЩИЕ
	|	(СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА) <> 0
	|		ИЛИ СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) <> 0)";
	
	Запрос.Параметры.Вставить("ДатаНачала", ДатаСторно); 
	Запрос.Параметры.Вставить("Договор", Договор); 
	Запрос.Параметры.Вставить("ДатаДокумента", Дата); 
	Запрос.Параметры.Вставить("ТЗСоставППА", ТЗСоставППА);
	
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	
	Пока Выборка.Следующий() Цикл 
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		Движение.График = Ссылка;
		Движение.Период = Дата;
		Движение.Договор = Выборка.Договор;
		Движение.ОбъектППА = Выборка.ОбъектППА; 
		Движение.ИДСтроки = Новый УникальныйИдентификатор;
		Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Выбытие;
		Движение.Показатель = Выборка.Показатель;
		Движение.ПериодГрафика = Выборка.ПериодГрафика;
		Движение.ПериодДисконтирования = Выборка.ПериодДисконтирования;
		Движение.Обязательство = -Выборка.Обязательство;
		Движение.НДС = -Выборка.НДС; 
		Движение.СтоимостьППА = -Выборка.СтоимостьППА; 
		Движение.ДатаСобытия = ДатаНачала;
	КонецЦикла; 
	
	
	//СторноПриведеннойСтоимости
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	т.ОбъектППА,
	|	т.ПоказательБазыРаспределения,
	|	т.СтоимостьППА
	|ПОМЕСТИТЬ ВТ_СписокППА
	|ИЗ
	|	&ТЗСоставППА КАК т
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.Показатель,
	|	_УчетДолгосрочнойАрендыостатки.ПериодГрафика,
	|	_УчетДолгосрочнойАрендыостатки.ПериодДисконтирования,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) КАК Обязательство,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА) КАК СтоимостьППА,
	|	ВЫБОР
	|		КОГДА ВТ_СписокППА.ОбъектППА ЕСТЬ NULL
	|				ИЛИ ВТ_СписокППА.ПоказательБазыРаспределения = 0
	|				ИЛИ ВТ_СписокППА.СтоимостьППА = 0
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК Выбытие
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СписокППА КАК ВТ_СписокППА
	|		ПО (ВТ_СписокППА.ОбъектППА = _УчетДолгосрочнойАрендыостатки.ОбъектППА)
	|ГДЕ
	|	_УчетДолгосрочнойАрендыостатки.Период < &ДатаДокумента
	|	И _УчетДолгосрочнойАрендыостатки.Договор = &Договор
	|	И _УчетДолгосрочнойАрендыостатки.ПериодДисконтирования < &ДатаНачала
	|	И _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
	|	И ВЫБОР
	|			КОГДА ВТ_СписокППА.ОбъектППА ЕСТЬ NULL
	|					ИЛИ ВТ_СписокППА.ПоказательБазыРаспределения = 0
	|					ИЛИ ВТ_СписокППА.СтоимостьППА = 0
	|				ТОГДА ИСТИНА
	|			ИНАЧЕ ЛОЖЬ
	|		КОНЕЦ = ИСТИНА
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыостатки.ПериодДисконтирования,
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	_УчетДолгосрочнойАрендыостатки.ПериодГрафика,
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	ВЫБОР
	|		КОГДА ВТ_СписокППА.ОбъектППА ЕСТЬ NULL
	|				ИЛИ ВТ_СписокППА.ПоказательБазыРаспределения = 0
	|				ИЛИ ВТ_СписокППА.СтоимостьППА = 0
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ,
	|	_УчетДолгосрочнойАрендыостатки.Показатель
	|
	|ИМЕЮЩИЕ
	|	(СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) <> 0
	|		ИЛИ СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА) <> 0)";
	
	Запрос.Параметры.Вставить("ТЗСоставППА", ТЗСоставППА);
	Запрос.Параметры.Вставить("ДатаНачала", ДатаСторно); 
	Запрос.Параметры.Вставить("Договор", Договор); 
	Запрос.Параметры.Вставить("ДатаДокумента", Дата); 
	
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	
	Пока Выборка.Следующий() Цикл 
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		Движение.График = Ссылка;
		Движение.Период = Дата;
		Движение.Договор = Выборка.Договор;
		Движение.ОбъектППА = Выборка.ОбъектППА; 
		Движение.ИДСтроки = Новый УникальныйИдентификатор;
		Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Выбытие;
		Движение.Показатель = Выборка.Показатель;
		Движение.ПериодГрафика = Дата(1,1,1);
		Движение.ПериодДисконтирования = Выборка.ПериодДисконтирования;
		Движение.Обязательство = -Выборка.Обязательство;
		Движение.ДатаСобытия = ДатаНачала;
	КонецЦикла;
	
КонецПроцедуры

Функция ПолучитьСпособОтраженияРасходовПоОС(ОсновноеСредство, Период)
	
	Результат = Неопределено;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ОсновныеСредства.Ссылка КАК ОсновноеСредство,
	|	ОсновныеСредства.ГруппаОС.Ссылка КАК ГруппаОС,
	|	ОсновныеСредства.ТипОС,
	|	МестонахождениеОСБухгалтерскийУчетСрезПоследних._АдресМестонахождения КАК Адрес,
	|	СпособыОтраженияРасходовПоАмортизацииСпособы.СтатьяЗатрат,
	|	СпособыОтраженияРасходовПоАмортизацииСпособы.НоменклатурнаяГруппа,
	|	СпособыОтраженияРасходовПоАмортизацииСпособы.Подразделение,
	|	СпособыОтраженияРасходовПоАмортизацииСпособы.ПодразделениеОрганизации,
	|	СпособыОтраженияРасходовПоАмортизацииСпособы.СчетЗатрат,
	|	Проекты.Ссылка КАК Проект
	|ИЗ
	|	Справочник.ОсновныеСредства КАК ОсновныеСредства
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.МестонахождениеОСБухгалтерскийУчет.СрезПоследних(&Период, ) КАК МестонахождениеОСБухгалтерскийУчетСрезПоследних
	|		ПО (МестонахождениеОСБухгалтерскийУчетСрезПоследних.ОсновноеСредство = ОсновныеСредства.Ссылка)
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СпособыОтраженияРасходовПоАмортизацииОСБухгалтерскийУчет.СрезПоследних(&Период, ) КАК СпособыОтраженияРасходовПоАмортизацииОСБухгалтерскийУчетСрезПоследних
	|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.СпособыОтраженияРасходовПоАмортизации.Способы КАК СпособыОтраженияРасходовПоАмортизацииСпособы
	|			ПО СпособыОтраженияРасходовПоАмортизацииОСБухгалтерскийУчетСрезПоследних.СпособыОтраженияРасходовПоАмортизации = СпособыОтраженияРасходовПоАмортизацииСпособы.Ссылка
	|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Проекты КАК Проекты
	|			ПО (СпособыОтраженияРасходовПоАмортизацииСпособы.ПодразделениеОрганизации.КодПоОКТМО = Проекты.Код)
	|		ПО (СпособыОтраженияРасходовПоАмортизацииОСБухгалтерскийУчетСрезПоследних.ОсновноеСредство = ОсновныеСредства.Ссылка)
	|ГДЕ
	|	ОсновныеСредства.Ссылка = &ОсновноеСредство";
	
	Запрос.УстановитьПараметр ("ОсновноеСредство", ОсновноеСредство);
	Запрос.УстановитьПараметр ("Период", Период);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	БитПроекты = Справочники.ПодразделенияОрганизаций.НайтиПоКоду("000001332");
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		Структура = Новый Структура;
		Структура.Вставить("ОсновноеСредство", ВыборкаДетальныеЗаписи.ОсновноеСредство);
		Структура.Вставить("ГруппаОС", ВыборкаДетальныеЗаписи.ГруппаОС);
		Структура.Вставить("ТипОС", ВыборкаДетальныеЗаписи.ТипОС);
		Структура.Вставить("Адрес", ВыборкаДетальныеЗаписи.Адрес);
		Структура.Вставить("СтатьяЗатрат", ВыборкаДетальныеЗаписи.СтатьяЗатрат);
		Структура.Вставить("НоменклатурнаяГруппа", ВыборкаДетальныеЗаписи.НоменклатурнаяГруппа);
		Структура.Вставить("Подразделение", ВыборкаДетальныеЗаписи.Подразделение);
		Структура.Вставить("ПодразделениеОрганизации", ВыборкаДетальныеЗаписи.ПодразделениеОрганизации);
		Структура.Вставить("Проект", ВыборкаДетальныеЗаписи.Проект);
		Структура.Вставить("СчетЗатрат", ВыборкаДетальныеЗаписи.СчетЗатрат);
		
		Если ВыборкаДетальныеЗаписи.ПодразделениеОрганизации.Родитель = БитПроекты Тогда
			ПодразделениеОрганизации91 = ВыборкаДетальныеЗаписи.ПодразделениеОрганизации;
		ИначеЕсли ВыборкаДетальныеЗаписи.ПодразделениеОрганизации.Родитель.Родитель = БитПроекты Тогда
			ПодразделениеОрганизации91 = ВыборкаДетальныеЗаписи.ПодразделениеОрганизации.Родитель;
		ИначеЕсли ВыборкаДетальныеЗаписи.ПодразделениеОрганизации.Родитель.Родитель.Родитель = БитПроекты Тогда
			ПодразделениеОрганизации91 = ВыборкаДетальныеЗаписи.ПодразделениеОрганизации.Родитель.Родитель;
		ИначеЕсли ВыборкаДетальныеЗаписи.ПодразделениеОрганизации.Родитель.Родитель.Родитель.Родитель = БитПроекты Тогда
			ПодразделениеОрганизации91 = ВыборкаДетальныеЗаписи.ПодразделениеОрганизации.Родитель.Родитель.Родитель;
		ИначеЕсли ВыборкаДетальныеЗаписи.ПодразделениеОрганизации.Родитель.Родитель.Родитель.Родитель.Родитель = БитПроекты Тогда
			ПодразделениеОрганизации91 = ВыборкаДетальныеЗаписи.ПодразделениеОрганизации.Родитель.Родитель.Родитель.Родитель;
		Иначе 
			ПодразделениеОрганизации91 = Справочники.ПодразделенияОрганизаций.НайтиПоКоду("000001478"); //Санкт-Петербург
		КонецЕсли;
		Структура.Вставить("ПодразделениеОрганизации91", ПодразделениеОрганизации91);
		
		Результат = Структура;
		
	КонецЦикла;
	
	Возврат Результат;
	
КонецФункции // ПолучитьСпособОтраженияРасходовПоОС()

Процедура РасторжениеБУиНУ()
	
	Если НЕ ВидГрафика = Перечисления._ВидыГрафиковДолгосрочнойАренды.Расторжение Тогда
		Возврат;
	КонецЕсли; 
	
	Движения.Хозрасчетный.Записывать = Ложь;
	Движения.Хозрасчетный.Очистить();
	Движения.Налоговый.Записывать = Ложь;
	Движения.Налоговый.Очистить();
	
	ФинРезОтРасторженияБУ = 0;
	
	Организация = Справочники.Организации.НайтиПоКоду("000000001");
	ТЗ_БУ = РасторжениеБУ.Выгрузить();
	ТЗ_НУ = РасторжениеНУ.Выгрузить();
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление._Учет.Бухгалтерский) КАК Учет,
	|	ТЗ.Счет,
	|	ТЗ.ОбъектППА,
	|	ТЗ.СуммаДт,
	|	ТЗ.СуммаКт
	|ПОМЕСТИТЬ ВТ
	|ИЗ
	|	&ТЗ_БУ КАК ТЗ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление._Учет.Налоговый) КАК Учет,
	|	ТЗ_НУ.Счет,
	|	ТЗ_НУ.ВидУчета,
	|	ТЗ_НУ.ОбъектППА,
	|	ТЗ_НУ.СуммаДт,
	|	ТЗ_НУ.СуммаКт
	|ПОМЕСТИТЬ ВТ_НУ
	|ИЗ
	|	&ТЗ_НУ КАК ТЗ_НУ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ.Учет,
	|	NULL КАК ВидУчета,
	|	ВТ.Счет,
	|	ВЫБОР
	|		КОГДА ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.АрендованноеИмущество)
	|				ИЛИ ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.АмортизацияАрендованногоИмущества)
	|				ИЛИ ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ОбесценениеОсновныхСредств)
	|			ТОГДА ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ОсновныеСредства)
	|		КОГДА ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.АрендныеОбязательства)
	|				ИЛИ ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПроцентыПоАренде)
	|				ИЛИ ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.НДСпоАренднымОбязательствам)
	|			ТОГДА ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыПоАренде)
	|		ИНАЧЕ NULL
	|	КОНЕЦ КАК СчетСинтетический,
	|	ВТ.ОбъектППА,
	|	ВТ.СуммаДт,
	|	ВТ.СуммаКт,
	|	ВЫБОР
	|		КОГДА ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.АрендованноеИмущество)
	|			ТОГДА -(ВТ.СуммаДт - ВТ.СуммаКт)
	|		КОГДА ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.АмортизацияАрендованногоИмущества)
	|			ТОГДА ВТ.СуммаКт - ВТ.СуммаДт
	|		КОГДА ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ОбесценениеОсновныхСредств)
	|			ТОГДА ВТ.СуммаКт - ВТ.СуммаДт
	|		КОГДА ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.АрендныеОбязательства)
	|			ТОГДА ВТ.СуммаКт - ВТ.СуммаДт
	|		КОГДА ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПроцентыПоАренде)
	|			ТОГДА -(ВТ.СуммаДт - ВТ.СуммаКт)
	|		КОГДА ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.НДСпоАренднымОбязательствам)
	|			ТОГДА -(ВТ.СуммаДт - ВТ.СуммаКт)
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК Сумма
	|ПОМЕСТИТЬ ВТ_РасчетБУ
	|ИЗ
	|	ВТ КАК ВТ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ.Учет,
	|	ВТ.ВидУчета,
	|	ВТ.Счет,
	|	ВЫБОР
	|		КОГДА ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Налоговый.АрендованноеИмущество)
	|				ИЛИ ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Налоговый.АмортизацияАрендованногоИмущества)
	|				ИЛИ ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Налоговый.Обесценение_ОС)
	|			ТОГДА ЗНАЧЕНИЕ(ПланСчетов.Налоговый.ОсновныеСредства)
	|		КОГДА ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Налоговый.КорректировкаСтоимостиАрендованногоИмущества)
	|			ТОГДА ВТ.Счет
	|		ИНАЧЕ NULL
	|	КОНЕЦ КАК СчетСинтетический,
	|	ВТ.ОбъектППА,
	|	ВТ.СуммаДт,
	|	ВТ.СуммаКт,
	|	ВЫБОР
	|		КОГДА ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Налоговый.АрендованноеИмущество)
	|			ТОГДА -(ВТ.СуммаДт - ВТ.СуммаКт)
	|		КОГДА ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Налоговый.АмортизацияАрендованногоИмущества)
	|			ТОГДА ВТ.СуммаКт - ВТ.СуммаДт
	|		КОГДА ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Налоговый.Обесценение_ОС)
	|			ТОГДА ВТ.СуммаКт - ВТ.СуммаДт
	|		КОГДА ВТ.Счет = ЗНАЧЕНИЕ(ПланСчетов.Налоговый.КорректировкаСтоимостиАрендованногоИмущества)
	|			ТОГДА 0
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК Сумма
	|ПОМЕСТИТЬ ВТ_РасчетНУ
	|ИЗ
	|	ВТ_НУ КАК ВТ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_РасчетБУ.Учет,
	|	ВТ_РасчетБУ.ВидУчета,
	|	ВТ_РасчетБУ.Счет,
	|	ВТ_РасчетБУ.СчетСинтетический,
	|	ВТ_РасчетБУ.ОбъектППА,
	|	ВТ_РасчетБУ.СуммаДт,
	|	ВТ_РасчетБУ.СуммаКт,
	|	ВТ_РасчетБУ.Сумма
	|ПОМЕСТИТЬ ВТ_Общая
	|ИЗ
	|	ВТ_РасчетБУ КАК ВТ_РасчетБУ
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВТ_РасчетНУ.Учет,
	|	ВТ_РасчетНУ.ВидУчета,
	|	ВТ_РасчетНУ.Счет,
	|	ВТ_РасчетНУ.СчетСинтетический,
	|	ВТ_РасчетНУ.ОбъектППА,
	|	ВТ_РасчетНУ.СуммаДт,
	|	ВТ_РасчетНУ.СуммаКт,
	|	ВТ_РасчетНУ.Сумма
	|ИЗ
	|	ВТ_РасчетНУ КАК ВТ_РасчетНУ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_Общая.Учет КАК Учет,
	|	ВТ_Общая.ВидУчета КАК ВидУчета,
	|	ВТ_Общая.Счет,
	|	ВТ_Общая.СчетСинтетический КАК СчетСинтетический,
	|	ВТ_Общая.ОбъектППА КАК ОбъектППА,
	|	ВТ_Общая.СуммаДт,
	|	ВТ_Общая.СуммаКт,
	|	ВТ_Общая.Сумма КАК Сумма
	|ИЗ
	|	ВТ_Общая КАК ВТ_Общая
	|
	|УПОРЯДОЧИТЬ ПО
	|	ВТ_Общая.Учет.Порядок
	|ИТОГИ
	|	СУММА(Сумма)
	|ПО
	|	Учет,
	|	СчетСинтетический,
	|	ОбъектППА,
	|	ВидУчета";
	
	//Сортировка по виду учета, т.к. сначала требуется получить и отразить ФинРез по БУ, а потом он используется и в НУ
	//Хотя, как вариант, можно взять ту же цифру из реквизита ФинРезультатРасторжениеБУ 
	
	Запрос.Параметры.Вставить("ТЗ_БУ", ТЗ_БУ);
	Запрос.Параметры.Вставить("ТЗ_НУ", ТЗ_НУ);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаВыше = РезультатЗапроса;
	ВыборкаУчет = ВыборкаВыше.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, "Учет");
	
	Пока ВыборкаУчет.Следующий() Цикл
		ВыборкаВыше = ВыборкаУчет;
		ВыборкаСчетСинтетический = ВыборкаВыше.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, "СчетСинтетический");
		Пока ВыборкаСчетСинтетический.Следующий() Цикл
			ВыборкаВыше = ВыборкаСчетСинтетический;
			ВыборкаОбъектППА = ВыборкаВыше.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, "ОбъектППА");
			Пока ВыборкаОбъектППА.Следующий() Цикл
				ВыборкаВыше = ВыборкаОбъектППА;
				ВыборкаВидУчета = ВыборкаВыше.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, "ВидУчета");
				Пока ВыборкаВидУчета.Следующий() Цикл
					ВыборкаВыше = ВыборкаВидУчета;
					ВыборкаДетальныеЗаписи = ВыборкаВыше.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам, );
					Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
						
						//Хозрасчетный
						Если 
							ВыборкаУчет.Учет = Перечисления._Учет.Бухгалтерский 
							и ОтражатьВБухгалтерскомУчете
							Тогда
							
							// Списание ППА	на 01.09					
							Если ВыборкаСчетСинтетический.СчетСинтетический.Код = "01"  Тогда
								
								Если ВыборкаДетальныеЗаписи.Счет.Код = "01.03" Тогда
									ЗаписьНЗХ = Движения.Хозрасчетный.Добавить();
									ЗаписьНЗХ.СчетДт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("01.09");
									ЗаписьНЗХ.СчетКт = ВыборкаДетальныеЗаписи.Счет;
									ЗаписьНЗХ.Организация = Организация;
									ЗаписьНЗХ.Содержание = "Списание ППА в связи с расторжением договора";
									ЗаписьНЗХ.Период =  Дата;
									ЗаписьНЗХ.Сумма = ВыборкаДетальныеЗаписи.СуммаДт;  
									БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, ВыборкаДетальныеЗаписи.ОбъектППА); 
									БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, ВыборкаДетальныеЗаписи.ОбъектППА);
								КонецЕсли;
								
								Если ВыборкаДетальныеЗаписи.Счет.Код = "02.03" Тогда
									ЗаписьНЗХ = Движения.Хозрасчетный.Добавить();
									ЗаписьНЗХ.СчетКт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("01.09");
									ЗаписьНЗХ.СчетДт = ВыборкаДетальныеЗаписи.Счет;
									ЗаписьНЗХ.Организация = Организация;
									ЗаписьНЗХ.Содержание = "Списание ППА в связи с расторжением договора";
									ЗаписьНЗХ.Период =  Дата;
									ЗаписьНЗХ.Сумма = ВыборкаДетальныеЗаписи.СуммаКт;  
									БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, ВыборкаДетальныеЗаписи.ОбъектППА); 
									БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, ВыборкаДетальныеЗаписи.ОбъектППА);
								КонецЕсли;
								
								Если ВыборкаДетальныеЗаписи.Счет.Код = "02.54" Тогда
									ЗаписьНЗХ = Движения.Хозрасчетный.Добавить();
									ЗаписьНЗХ.СчетКт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("01.09");
									ЗаписьНЗХ.СчетДт = ВыборкаДетальныеЗаписи.Счет;
									ЗаписьНЗХ.Организация = Организация;
									ЗаписьНЗХ.Содержание = "Списание ППА в связи с расторжением договора";
									ЗаписьНЗХ.Период =  Дата;
									ЗаписьНЗХ.Сумма = ВыборкаДетальныеЗаписи.СуммаКт;  
									БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, ВыборкаДетальныеЗаписи.ОбъектППА); 
									БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, ВыборкаДетальныеЗаписи.ОбъектППА);
								КонецЕсли;
								
							КонецЕсли;
							
							//Сворачиваем 76.07
							Если ВыборкаСчетСинтетический.СчетСинтетический.Код = "76.07" Тогда
								
								Если ВыборкаДетальныеЗаписи.Счет.Код = "76.07.5" или ВыборкаДетальныеЗаписи.Счет.Код = "76.07.9" Тогда
									ЗаписьНЗХ = Движения.Хозрасчетный.Добавить();
									ЗаписьНЗХ.СчетДт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.1");
									ЗаписьНЗХ.СчетКт = ВыборкаДетальныеЗаписи.Счет;
									ЗаписьНЗХ.Организация = Организация;
									ЗаписьНЗХ.Содержание = "Списание приведенной стоимости в связи с расторжением договора";
									ЗаписьНЗХ.Период =  Дата;
									ЗаписьНЗХ.Сумма = ВыборкаДетальныеЗаписи.СуммаДт;  
									БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, Договор.Владелец); 
									БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 2, Договор); 
									БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Договор.Владелец);
									БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 2, Договор);
								КонецЕсли;
							КонецЕсли;							
						КонецЕсли; 
						
						//Налоговый
						Если 
							ВыборкаУчет.Учет = Перечисления._Учет.Налоговый
							и ОтражатьВНалоговомУчете
							Тогда  
							
							// Списание ППА	на 01.09					
							Если ВыборкаСчетСинтетический.СчетСинтетический.Код = "01"  Тогда
								Если ВыборкаДетальныеЗаписи.Счет.Код = "01.03" Тогда
									ЗаписьНЗХ = Движения.Налоговый.Добавить();
									ЗаписьНЗХ.СчетДт = ПланыСчетов.Налоговый.НайтиПоКоду("01.09");
									ЗаписьНЗХ.СчетКт = ВыборкаДетальныеЗаписи.Счет;
									ЗаписьНЗХ.ВидУчетаДт = ВыборкаДетальныеЗаписи.ВидУчета; 
									ЗаписьНЗХ.ВидУчетаКт = ВыборкаДетальныеЗаписи.ВидУчета; 
									ЗаписьНЗХ.Организация = Организация;
									ЗаписьНЗХ.Содержание = "Списание ППА в связи с расторжением договора";
									ЗаписьНЗХ.Период =  Дата;
									ЗаписьНЗХ.Сумма = ВыборкаДетальныеЗаписи.СуммаДт;  
									БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, ВыборкаДетальныеЗаписи.ОбъектППА); 
									БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, ВыборкаДетальныеЗаписи.ОбъектППА);
								КонецЕсли;
								
								Если ВыборкаДетальныеЗаписи.Счет.Код = "02.03" Тогда
									ЗаписьНЗХ = Движения.Налоговый.Добавить();
									ЗаписьНЗХ.СчетКт = ПланыСчетов.Налоговый.НайтиПоКоду("01.09");
									ЗаписьНЗХ.СчетДт = ВыборкаДетальныеЗаписи.Счет;
									ЗаписьНЗХ.ВидУчетаДт = ВыборкаДетальныеЗаписи.ВидУчета; 
									ЗаписьНЗХ.ВидУчетаКт = ВыборкаДетальныеЗаписи.ВидУчета; 
									ЗаписьНЗХ.Организация = Организация;
									ЗаписьНЗХ.Содержание = "Списание ППА в связи с расторжением договора";
									ЗаписьНЗХ.Период =  Дата;
									ЗаписьНЗХ.Сумма = ВыборкаДетальныеЗаписи.СуммаКт;  
									БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, ВыборкаДетальныеЗаписи.ОбъектППА); 
									БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, ВыборкаДетальныеЗаписи.ОбъектППА);
								КонецЕсли;
								
								Если ВыборкаДетальныеЗаписи.Счет.Код = "02.54" Тогда
									ЗаписьНЗХ = Движения.Налоговый.Добавить();
									ЗаписьНЗХ.СчетКт = ПланыСчетов.Налоговый.НайтиПоКоду("01.09");
									ЗаписьНЗХ.СчетДт = ВыборкаДетальныеЗаписи.Счет;
									ЗаписьНЗХ.ВидУчетаДт = ВыборкаДетальныеЗаписи.ВидУчета; 
									ЗаписьНЗХ.ВидУчетаКт = ВыборкаДетальныеЗаписи.ВидУчета; 
									ЗаписьНЗХ.Организация = Организация;
									ЗаписьНЗХ.Содержание = "Списание ППА в связи с расторжением договора";
									ЗаписьНЗХ.Период =  Дата;
									ЗаписьНЗХ.Сумма = ВыборкаДетальныеЗаписи.СуммаКт;  
									БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, ВыборкаДетальныеЗаписи.ОбъектППА); 
									БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, ВыборкаДетальныеЗаписи.ОбъектППА);
								КонецЕсли;
							КонецЕсли;
							
							// Списание 01К					
							Если ВыборкаСчетСинтетический.СчетСинтетический.Код = "01.К"  Тогда
								ЗаписьНЗХ = Движения.Налоговый.Добавить();
								ЗаписьНЗХ.СчетКт = ПланыСчетов.Налоговый.НайтиПоКоду("ПВ");
								ЗаписьНЗХ.СчетДт = ВыборкаДетальныеЗаписи.Счет;
								ЗаписьНЗХ.ВидУчетаДт = ВыборкаДетальныеЗаписи.ВидУчета; 
								ЗаписьНЗХ.ВидУчетаКт = ВыборкаДетальныеЗаписи.ВидУчета; 
								ЗаписьНЗХ.Организация = Организация;
								ЗаписьНЗХ.Содержание = "Списание 01.К в связи с расторжением договора";
								ЗаписьНЗХ.Период =  Дата;
								ЗаписьНЗХ.Сумма = -ВыборкаДетальныеЗаписи.СуммаДт;  
								БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Перечисления.УсловияПоступленияИВыбытияИмущества.Другие);  
								БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 2, Договор.Владелец);  
								БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 3, Договор);  	
								БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, ВыборкаДетальныеЗаписи.ОбъектППА);
							КонецЕсли;
							
							
						КонецЕсли;
						
						//ВыборкаДетальныеЗаписи
					КонецЦикла;
					
					//Налоговый 
					Если ВыборкаУчет.Учет = Перечисления._Учет.Налоговый 
						и ОтражатьВНалоговомУчете	
						Тогда
						// Списание счета 01.09 на 76.07.1 по ППА
						Если ВыборкаСчетСинтетический.СчетСинтетический.Код = "01" Тогда
							ЗаписьНЗХ = Движения.Налоговый.Добавить();
							ЗаписьНЗХ.СчетДт = ПланыСчетов.Налоговый.НайтиПоКоду("ПВ");
							ЗаписьНЗХ.СчетКт = ПланыСчетов.Налоговый.НайтиПоКоду("01.09"); 
							ЗаписьНЗХ.ВидУчетаДт = ВыборкаВидУчета.ВидУчета; 
							ЗаписьНЗХ.ВидУчетаКт = ВыборкаВидУчета.ВидУчета; 
							ЗаписьНЗХ.Организация = Организация;
							ЗаписьНЗХ.Содержание = "Списание ППА в связи с расторжением договора";
							ЗаписьНЗХ.Период =  Дата;
							ЗаписьНЗХ.Сумма = -ВыборкаВидУчета.Сумма;  
							БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, Перечисления.УсловияПоступленияИВыбытияИмущества.ЗаПлату);  
							БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 2, Договор.Владелец);  
							БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 3, Договор);  	
							БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, ВыборкаОбъектППА.ОбъектППА); 
						КонецЕсли;
					КонецЕсли;	
					
					
					//ВыборкаВидУчета
				КонецЦикла;
				
				//Хозрасчетный 
				Если ВыборкаУчет.Учет = Перечисления._Учет.Бухгалтерский 
					и ОтражатьВБухгалтерскомУчете
					Тогда
					// Списание счета 01.09 на 76.07.1 по ППА
					Если ВыборкаСчетСинтетический.СчетСинтетический.Код = "01" Тогда
						ЗаписьНЗХ = Движения.Хозрасчетный.Добавить();
						ЗаписьНЗХ.СчетДт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.1");
						ЗаписьНЗХ.СчетКт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("01.09");
						ЗаписьНЗХ.Организация = Организация;
						ЗаписьНЗХ.Содержание = "Списание ППА в связи с расторжением договора";
						ЗаписьНЗХ.Период =  Дата;
						ЗаписьНЗХ.Сумма = -ВыборкаОбъектППА.Сумма;  
						БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, Договор.Владелец);  
						БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 2, Договор);  	
						БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, ВыборкаОбъектППА.ОбъектППА); 
					КонецЕсли;
				КонецЕсли;	
				
				//ВыборкаОбъектППА
			КонецЦикла;
			
			//ВыборкаСчетСинтетический
		КонецЦикла; 
		
		//ВыборкаУчет
		
		//Хозрасчетный Финрез
		Если 
			ВыборкаУчет.Учет = Перечисления._Учет.Бухгалтерский
			и ОтражатьВБухгалтерскомУчете
			Тогда
			
			ФинРезОтРасторженияБУ = ВыборкаУчет.Сумма;
			
			Если ФинРезОтРасторженияБУ > 0 Тогда
				ЗаписьНЗХ = Движения.Хозрасчетный.Добавить();
				ЗаписьНЗХ.СчетДт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.1");
				ЗаписьНЗХ.СчетКт = ПланыСчетов.Хозрасчетный.ПрочиеДоходы;
				ЗаписьНЗХ.Организация = Организация;
				ЗаписьНЗХ.Содержание = "Финансовый результат в связи с расторжением договора";
				ЗаписьНЗХ.Период =  Дата;
				ЗаписьНЗХ.Сумма = ФинРезОтРасторженияБУ;  
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, Договор.Владелец);  
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 2, Договор);  	
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, СтатьяПДР_Расторжение); 
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 2, ПодразделениеОрганизации_Расторжение); 
			КонецЕсли;
			
			Если ФинРезОтРасторженияБУ < 0 Тогда
				ЗаписьНЗХ = Движения.Хозрасчетный.Добавить();
				ЗаписьНЗХ.СчетДт = ПланыСчетов.Хозрасчетный.ПрочиеРасходыНеОблагаемыеЕНВД;
				ЗаписьНЗХ.СчетКт = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.1");
				ЗаписьНЗХ.Организация = Организация;
				ЗаписьНЗХ.Содержание = "Финансовый результат в связи с расторжением договора";
				ЗаписьНЗХ.Период =  Дата;
				ЗаписьНЗХ.Сумма = -ФинРезОтРасторженияБУ;  
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, СтатьяПДР_Расторжение); 
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 2, ПодразделениеОрганизации_Расторжение); 
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Договор.Владелец);  
				БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 2, Договор);  	
			КонецЕсли;
			
		КонецЕсли;
		
		//ВыборкаУчет	
	КонецЦикла;
	
	//ФинРез в НУ  
	Если ОтражатьВНалоговомУчете Тогда 
		
		Если ФинРезОтРасторженияБУ > 0 Тогда
			ЗаписьНЗХ = Движения.Налоговый.Добавить();
			ЗаписьНЗХ.СчетДт = ПланыСчетов.Налоговый.НайтиПоКоду("ПВ");
			ЗаписьНЗХ.СчетКт = ПланыСчетов.Налоговый.НайтиПоКоду("91.01.7"); 
			ЗаписьНЗХ.ВидУчетаДт = Перечисления.ВидыУчетаПоПБУ18.ВР; 
			ЗаписьНЗХ.ВидУчетаКт = Перечисления.ВидыУчетаПоПБУ18.ВР; 
			ЗаписьНЗХ.Организация = Организация;
			ЗаписьНЗХ.Содержание = "Финансовый результат в связи с расторжением договора";
			ЗаписьНЗХ.Период =  Дата;
			ЗаписьНЗХ.Сумма = ФинРезОтРасторженияБУ;  
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, Перечисления.УсловияПоступленияИВыбытияИмущества.Другие); 		
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 2, Договор.Владелец); 
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 3, Договор);  	
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, СтатьяПДР_Расторжение); 
		КонецЕсли;
		
		Если ФинРезОтРасторженияБУ < 0 Тогда
			ЗаписьНЗХ = Движения.Налоговый.Добавить();
			ЗаписьНЗХ.СчетДт = ПланыСчетов.Налоговый.НайтиПоКоду("91.02.7");
			ЗаписьНЗХ.СчетКт = ПланыСчетов.Налоговый.НайтиПоКоду("ПВ");
			ЗаписьНЗХ.ВидУчетаДт = Перечисления.ВидыУчетаПоПБУ18.ВР; 
			ЗаписьНЗХ.ВидУчетаКт = Перечисления.ВидыУчетаПоПБУ18.ВР; 
			ЗаписьНЗХ.Организация = Организация;
			ЗаписьНЗХ.Содержание = "Финансовый результат в связи с расторжением договора";
			ЗаписьНЗХ.Период =  Дата;
			ЗаписьНЗХ.Сумма = -ФинРезОтРасторженияБУ;  
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетДт, ЗаписьНЗХ.СубконтоДт, 1, СтатьяПДР_Расторжение); 
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 1, Перечисления.УсловияПоступленияИВыбытияИмущества.Другие);  
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 2, Договор.Владелец);  
			БухгалтерскийУчет.УстановитьСубконто(ЗаписьНЗХ.СчетКт, ЗаписьНЗХ.СубконтоКт, 3, Договор);  	
		КонецЕсли;
		
	КонецЕсли; 
	
	Движения.Хозрасчетный.Записать();
	Движения.Налоговый.Записать();
	
КонецПроцедуры

Процедура ПересчитатьТолькоАренднуюПлатуВГрафиках2026()

	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.Показатель,
	|	_УчетДолгосрочнойАрендыостатки.ПериодГрафика,
	|	_УчетДолгосрочнойАрендыостатки.ПериодДисконтирования,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) КАК Обязательство,
	|	СУММА(_УчетДолгосрочнойАрендыостатки.НДС) КАК НДС
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
	|ГДЕ
	|	_УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
	|	И _УчетДолгосрочнойАрендыостатки.Регистратор = &Регистратор
	|	И _УчетДолгосрочнойАрендыостатки.ВидДвиженияГрафика в (&ВидыДвижения)
	|
	|СГРУППИРОВАТЬ ПО
	|	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	|	_УчетДолгосрочнойАрендыостатки.ПериодДисконтирования,
	|	_УчетДолгосрочнойАрендыостатки.ПериодГрафика,
	|	_УчетДолгосрочнойАрендыостатки.Договор,
	|	_УчетДолгосрочнойАрендыостатки.Показатель
	|
	|ИМЕЮЩИЕ
	|	СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) <> 0";
	
	ВидыДвижения = Новый СписокЗначений;
	ВидыДвижения.Добавить(Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Поступление);
	ВидыДвижения.Добавить(Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Начисление);
	
	Запрос.Параметры.Вставить("ВидыДвижения", ВидыДвижения); 
	Запрос.Параметры.Вставить("Регистратор", Ссылка.ПредыдущаяРедакция);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Выборка = РезультатЗапроса.Выбрать();
	
	Пока Выборка.Следующий() Цикл 
		
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		Движение.График = Ссылка;
		Движение.Период = Дата;
		Движение.Договор = Выборка.Договор;
		Движение.ОбъектППА = Выборка.ОбъектППА; 
		Движение.ИДСтроки = Новый УникальныйИдентификатор;
		
		Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Сторно;
		
		Движение.Показатель = Выборка.Показатель;
		Движение.ПериодГрафика = Выборка.ПериодГрафика;
		Движение.ПериодДисконтирования = Выборка.ПериодДисконтирования;
		Движение.Обязательство = -Выборка.Обязательство;
		Движение.НДС = -Выборка.НДС; 
		Движение.СтоимостьППА = 0;
		Движение.ДатаСобытия = ДатаНачала;
		
	КонецЦикла; 	

	//Новые строки графика
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.УИДСтрокиГрафика,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбъектППА,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.График,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.АренднаяПлата,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.НДС,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ПриведеннаяСтоимость,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ПроцентныеРасходы,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбязательствоНаНачало,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ИзменениеОбязательства,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ОбязательствоНаКонец,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.ДолгосрочнаяЧасть,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.КраткосрочнаяЧасть,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.СтоимостьППА,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.Амортизация,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.АмортизацияНакопленная,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.БалансоваяСтоимость,
	|	_ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.АктивностьСтроки,
	|	ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.ДатаС,
	|	ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.ДатаПо КАК ДатаПо,
	|	ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.Дней
	|ИЗ
	|	Документ._ГрафикДоговораДолгосрочнойАренды.ГрафикПоДоговору КАК ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений._ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик КАК _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик
	|		ПО ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.Ссылка = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.График
	|			И ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.УИДСтроки = _ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.УИДСтрокиГрафика
	|ГДЕ
	|	ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.Ссылка = &Ссылка"; 
	
	Запрос.Параметры.Вставить("Ссылка", Ссылка); 	
	Запрос.Параметры.Вставить("ДатаИтогов", Дата);
	
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	Пока Выборка.Следующий() Цикл
		
		//АрендныеПлатежи Начисление
		Движение = Движения._УчетДолгосрочнойАренды.Добавить();
		Движение.Период = Дата;
		Движение.Договор = Договор;
		Движение.График = Ссылка;
		Движение.ОбъектППА = Выборка.ОбъектППА;
		Движение.ИДСтроки = Новый УникальныйИдентификатор;
		
		Движение.ВидДвиженияГрафика = Перечисления._ВидыДвиженийГрафиковДолгосрочнойАренды.Начисление;
		
		Движение.Показатель = перечисления._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи;
		Движение.ПериодГрафика = Выборка.ДатаПо;
		Движение.ПериодДисконтирования = Дата(1,1,1);
		Движение.Обязательство = -Выборка.АренднаяПлата;  
		Движение.НДС = -Выборка.НДС;  
		Движение.СтоимостьППА = 0; 
		Движение.ДатаСобытия = ДатаНачала;
		
	КонецЦикла;
	
КонецПроцедуры

Процедура СторноПредыдущегоДокумента()

	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	*
	|ИЗ
	|	РегистрСведений._УчетДолгосрочнойАренды КАК Движения
	|ГДЕ
	|	Движения.Регистратор = &ДокументИсточник";

	Запрос.Параметры.Вставить("ДокументИсточник", ПредыдущаяРедакция);

	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();

	Пока Выборка.Следующий() Цикл

		Движение = Движения._УчетДолгосрочнойАренды.Добавить();

		ЗаполнитьЗначенияСвойств(Движение, Выборка);

		Движение.Период       = Дата;                 // дата сторно
		Движение.Регистратор   = Ссылка;               // текущий документ
		Движение.ИДСтроки      = Новый УникальныйИдентификатор;

		Движение.Обязательство          = -Выборка.Обязательство;
		Движение.СтоимостьППА           = -Выборка.СтоимостьППА;
		Движение.НДС                    = -Выборка.НДС;
		Движение.АвансОбязательство     = -Выборка.АвансОбязательство;
		Движение.АвансАктив             = -Выборка.АвансАктив;
		Движение.АвансНДС               = -Выборка.АвансНДС;

	КонецЦикла;

КонецПроцедуры

Процедура СторноПроводокБУиНУ()

	// Очищаем
	Движения.Хозрасчетный.Записывать = Ложь;
	Движения.Хозрасчетный.Очистить();
	Движения.Налоговый.Записывать = Ложь;
	Движения.Налоговый.Очистить();

	// Сторно Хозрасчетного (только если отражается в БУ)
	Если ОтражатьВБухгалтерскомУчете Тогда
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ * ИЗ РегистрБухгалтерии.Хозрасчетный ГДЕ Регистратор = &ПредыдущаяРедакция";
		Запрос.Параметры.Вставить("ПредыдущаяРедакция", ПредыдущаяРедакция);
		
		Выборка = Запрос.Выполнить().Выбрать();
		Пока Выборка.Следующий() Цикл
			Движение = Движения.Хозрасчетный.Добавить();
			ЗаполнитьЗначенияСвойств(Движение, Выборка);
			Движение.Период = Дата;
			Движение.Регистратор = Ссылка;
			Движение.Сумма = -Выборка.Сумма;
		КонецЦикла;
	КонецЕсли;

	// Сторно Налогового (только если отражается в НУ)
	Если ОтражатьВНалоговомУчете Тогда
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ * ИЗ РегистрБухгалтерии.Налоговый ГДЕ Регистратор = &ПредыдущаяРедакция";
		Запрос.Параметры.Вставить("ПредыдущаяРедакция", ПредыдущаяРедакция);
		
		Выборка = Запрос.Выполнить().Выбрать();
		Пока Выборка.Следующий() Цикл
			Движение = Движения.Налоговый.Добавить();
			ЗаполнитьЗначенияСвойств(Движение, Выборка);
			Движение.Период = Дата;
			Движение.Регистратор = Ссылка;
			Движение.Сумма = -Выборка.Сумма;
		КонецЦикла;
	КонецЕсли;

	// Записываем
	Движения.Хозрасчетный.Записать();
	Движения.Налоговый.Записать();

КонецПроцедуры

Функция ПроверитьСбалансированностьГрафика(Договор, Дата) Экспорт

    Результат = Новый Структура;
    Результат.Вставить("БалансОк", Истина);
    Результат.Вставить("ТекстСообщения", "");

    Запрос = Новый Запрос;
    Запрос.Текст = 
    "ВЫБРАТЬ
    |    Остатки.ОбъектППА,
    |    СУММА(Остатки.Обязательство) КАК Обязательство,
    |    СУММА(Остатки.СтоимостьППА) КАК СтоимостьППА,
    |    СУММА(Остатки.АвансОбязательство) КАК АвансОбязательство,
    |    СУММА(Остатки.АвансНДС) КАК АвансНДС,
    |    СУММА(Остатки.АвансАктив) КАК АвансАктив
    |ИЗ
    |    РегистрСведений._УчетДолгосрочнойАренды КАК Остатки
    |ГДЕ
    |    Остатки.Договор = &Договор
    |    И Остатки.Период <= &Период
    |
    |СГРУППИРОВАТЬ ПО
    |    Остатки.ОбъектППА";

    Запрос.Параметры.Вставить("Договор", Договор);
    Запрос.Параметры.Вставить("Период", Дата);

    ИтогОбязательство      = 0;
    ИтогСтоимостьППА       = 0;
    ИтогАвансОбязательство = 0;
    ИтогАвансНДС           = 0;
    ИтогАвансАктив         = 0;

    ТекстДетали = "";

	Выборка = Запрос.Выполнить().Выбрать();
    Пока Выборка.Следующий() Цикл

        ИтогОбязательство      = ИтогОбязательство      + Выборка.Обязательство;
        ИтогСтоимостьППА       = ИтогСтоимостьППА       + Выборка.СтоимостьППА;
        ИтогАвансОбязательство = ИтогАвансОбязательство + Выборка.АвансОбязательство;
        ИтогАвансНДС           = ИтогАвансНДС           + Выборка.АвансНДС;
        ИтогАвансАктив         = ИтогАвансАктив         + Выборка.АвансАктив;

        Если Выборка.Обязательство > 0.01 ИЛИ Выборка.Обязательство < -0.01
            ИЛИ Выборка.СтоимостьППА > 0.01 ИЛИ Выборка.СтоимостьППА < -0.01
            ИЛИ Выборка.АвансОбязательство > 0.01 ИЛИ Выборка.АвансОбязательство < -0.01
            ИЛИ Выборка.АвансНДС > 0.01 ИЛИ Выборка.АвансНДС < -0.01
            ИЛИ Выборка.АвансАктив > 0.01 ИЛИ Выборка.АвансАктив < -0.01
        Тогда
            Результат.БалансОк = Ложь;

            ТекстОбъекта = СтрШаблон("Разбаланс по объекту: %1", Выборка.ОбъектППА);

            Если Выборка.Обязательство > 0.01 ИЛИ Выборка.Обязательство < -0.01 Тогда
                ТекстОбъекта = ТекстОбъекта + СтрШаблон(
                    Символы.ПС + "  Обязательство: %1",
                    Формат(Выборка.Обязательство, "ЧДЦ=2")
                );
            КонецЕсли;

            Если Выборка.СтоимостьППА > 0.01 ИЛИ Выборка.СтоимостьППА < -0.01 Тогда
                ТекстОбъекта = ТекстОбъекта + СтрШаблон(
                    Символы.ПС + "  Стоимость ППА: %1",
                    Формат(Выборка.СтоимостьППА, "ЧДЦ=2")
                );
            КонецЕсли;

            Если Выборка.АвансОбязательство > 0.01 ИЛИ Выборка.АвансОбязательство < -0.01 Тогда
                ТекстОбъекта = ТекстОбъекта + СтрШаблон(
                    Символы.ПС + "  Аванс обязательство: %1",
                    Формат(Выборка.АвансОбязательство, "ЧДЦ=2")
                );
            КонецЕсли;

            Если Выборка.АвансНДС > 0.01 ИЛИ Выборка.АвансНДС < -0.01 Тогда
                ТекстОбъекта = ТекстОбъекта + СтрШаблон(
                    Символы.ПС + "  Аванс НДС: %1",
                    Формат(Выборка.АвансНДС, "ЧДЦ=2")
                );
            КонецЕсли;

            Если Выборка.АвансАктив > 0.01 ИЛИ Выборка.АвансАктив < -0.01 Тогда
                ТекстОбъекта = ТекстОбъекта + СтрШаблон(
                    Символы.ПС + "  Аванс актив: %1",
                    Формат(Выборка.АвансАктив, "ЧДЦ=2")
                );
            КонецЕсли;

            ТекстДетали = ТекстДетали + ТекстОбъекта + Символы.ПС;
        КонецЕсли;

    КонецЦикла;

    Если НЕ Результат.БалансОк Тогда

        ТекстСообщения = "Разбаланс по договору в целом:";

        Если ИтогОбязательство > 0.01 ИЛИ ИтогОбязательство < -0.01 Тогда
            ТекстСообщения = ТекстСообщения + СтрШаблон(
                Символы.ПС + "  Обязательство: %1",
                Формат(ИтогОбязательство, "ЧДЦ=2")
            );
        КонецЕсли;

        Если ИтогСтоимостьППА > 0.01 ИЛИ ИтогСтоимостьППА < -0.01 Тогда
            ТекстСообщения = ТекстСообщения + СтрШаблон(
                Символы.ПС + "  Стоимость ППА: %1",
                Формат(ИтогСтоимостьППА, "ЧДЦ=2")
            );
        КонецЕсли;

        Если ИтогАвансОбязательство > 0.01 ИЛИ ИтогАвансОбязательство < -0.01 Тогда
            ТекстСообщения = ТекстСообщения + СтрШаблон(
                Символы.ПС + "  Аванс обязательство: %1",
                Формат(ИтогАвансОбязательство, "ЧДЦ=2")
            );
        КонецЕсли;

        Если ИтогАвансНДС > 0.01 ИЛИ ИтогАвансНДС < -0.01 Тогда
            ТекстСообщения = ТекстСообщения + СтрШаблон(
                Символы.ПС + "  Аванс НДС: %1",
                Формат(ИтогАвансНДС, "ЧДЦ=2")
            );
        КонецЕсли;

        Если ИтогАвансАктив > 0.01 ИЛИ ИтогАвансАктив < -0.01 Тогда
            ТекстСообщения = ТекстСообщения + СтрШаблон(
                Символы.ПС + "  Аванс актив: %1",
                Формат(ИтогАвансАктив, "ЧДЦ=2")
            );
        КонецЕсли;

        Результат.ТекстСообщения = ТекстСообщения + Символы.ПС + "----------------------" + Символы.ПС + ТекстДетали;

    КонецЕсли;

    Возврат Результат;

КонецФункции



&НаСервере
Процедура РассчитатьИндивидуальныеГрафикиНаСервере()
	
	
	РазбивкаПоСоставу = РегистрыСведений._ГрафикДоговораДолгосрочнойАрендыДетальныйГрафик.СоздатьНаборЗаписей();
	РазбивкаПоСоставу.Отбор.График.Установить(Объект.Ссылка);
	РазбивкаПоСоставу.Прочитать();
	РазбивкаПоСоставу.Очистить();
	
	ГрафикНачинаетсяПервогоЧисла = НачалоМесяца(Объект.ДатаНачала) = Объект.ДатаНачала;
	
	//ТЗОГ это ТЗОбщийГрафик
	//Здесь будет сводный график по договору
	ТЗОГСДатами = Объект.ГрафикПоДоговору.Выгрузить(); 
	
	СписокПолейДляОчистки =	ОбщегоНазначения.РазложитьСтрокуВМассивПодстрок("ПриведеннаяСтоимость,ПроцентныеРасходы,ОбязательствоНаНачало,ОбязательствоНаКонец,ИзменениеОбязательства,ДолгосрочнаяЧасть,КраткосрочнаяЧасть,СтоимостьППА,Амортизация,АмортизацияНакопленная,БалансоваяСтоимость",",");
	Для каждого Строка Из ТЗОГСДатами Цикл
		Для каждого Элемент Из СписокПолейДляОчистки Цикл
			Строка[Элемент] = 0;
		КонецЦикла;
	КонецЦикла;
	
	//ТЗИГ это ТЗИндивидуальныеГрафики
	//Подготовим ТЗ без лишних колонок
	ТЗИГДляКопирования = ТЗОГСДатами.Скопировать();
	ТЗИГДляКопирования.Колонки.Добавить("ОбъектППА", Новый ОписаниеТипов("СправочникСсылка.ОсновныеСредства"));
	ТЗИГДляКопирования.Сортировать("ДатаПо");
	
	МассивСтрокДляУдаления = ОбщегоНазначения.РазложитьСтрокуВМассивПодстрок("Активность,Реквизит1,ИсходныйНомерСтроки",","); 
	Для каждого Элемент Из МассивСтрокДляУдаления Цикл
		Колонка = ТЗИГДляКопирования.Колонки.Найти(Элемент);
		Если Не Колонка = Неопределено Тогда
			ТЗИГДляКопирования.Колонки.Удалить(Колонка);
		КонецЕсли;
	КонецЦикла;
	
	ТЗОГДляВсехОбъектов = ТЗИГДляКопирования.Скопировать();
	ТЗОГДляВсехОбъектов.Очистить();
	
	//Подготовим ТЗ со списком арендованных объектов
	ТЗСостав = Объект.СоставППА.Выгрузить();
	МассивСтрокДляУдаления = ОбщегоНазначения.РазложитьСтрокуВМассивПодстрок("НомерСтроки,СтатьяПрочихДоходовИРасходов,ПодразделениеОрганизации91,Примечание,ИсходныйНомерСтроки",",");
	Для каждого Элемент Из МассивСтрокДляУдаления Цикл
		Колонка = ТЗСостав.Колонки.Найти(Элемент);
		Если Не Колонка = Неопределено Тогда
			ТЗСостав.Колонки.Удалить(Колонка);
		КонецЕсли;
	КонецЦикла;  
	
	ИтогБазыРаспределения = ТЗСостав.Итог("ПоказательБазыРаспределения");
	
	ГлОбщаяСтоимостьППА = 0;
	ГлОбщаяПриведеннаяСтоимость = 0;
	ГлОбщаяАмортизацияНаНачало = 0;
	ГлОстатокОПСНАНачало = 0;
	ГлКорректировка = 0;
	
	Для каждого СтрокаСостав Из ТзСостав Цикл 
		
		ТЗИГ =  ТЗИГДляКопирования.Скопировать();
		
		ДатаНачала 						= Объект.ДатаНачала;
		ДатаОкончания 					= Объект.ДатаОкончания;
		СтавкаДисконтирования 			= Объект.СтавкаДисконтирования;
		ДатаС 							= ДатаНачала;
		ОбщаяПриведеннаяСтоимость 		= 0; 
		АвансПоОбъекту					= 0;
		
		//Приведенная стоимость		
		Для каждого СтрокаИГ Из ТЗИГ Цикл
			СтрокаИГ.АренднаяПлата = СтрокаИГ.АренднаяПлата	/ ИтогБазыРаспределения * СтрокаСостав.ПоказательБазыРаспределения;
			
			СтрокаИГ.НДС 		= СтрокаИГ.НДС			/ ИтогБазыРаспределения * СтрокаСостав.ПоказательБазыРаспределения;
			СтрокаИГ.НДСсАванса = СтрокаИГ.НДСсАванса	/ ИтогБазыРаспределения * СтрокаСостав.ПоказательБазыРаспределения;
			СтрокаИГ.НДС_Всего 	= СтрокаИГ.НДС_Всего	/ ИтогБазыРаспределения * СтрокаСостав.ПоказательБазыРаспределения;
			
			ДнейСНачала = (НачалоДня(СтрокаИГ.ДатаПо) - НачалоДня(ДатаНачала)) / (60 * 60 * 24) + 1;
			СтрокаИГ.ПриведеннаяСтоимость = СтрокаИГ.АренднаяПлата / pow((1 + СтавкаДисконтирования / 100) , (ДнейСНачала / 365));
			ОбщаяПриведеннаяСтоимость = ОбщаяПриведеннаяСтоимость + СтрокаИГ.ПриведеннаяСтоимость; 
			СтрокаИГ.ОбъектППА = СтрокаСостав.ОбъектППА;
		КонецЦикла;	
		ОбязательствоНаНачало = ОбщаяПриведеннаяСтоимость;  
		ГлОбщаяПриведеннаяСтоимость = ГлОбщаяПриведеннаяСтоимость + ОбщаяПриведеннаяСтоимость;
		
		//Процентные расходы 76.05 
		Для каждого СтрокаИГ Из ТЗИГ Цикл
			СтрокаИГ.ОбязательствоНаНачало = ОбязательствоНаНачало;
			СтрокаИГ.ПроцентныеРасходы = СтрокаИГ.ОбязательствоНаНачало * (
			pow( 
			((100 + СтавкаДисконтирования) / 100) 
			, 
			(СтрокаИГ.Дней / 365)
			) 
			- 1);
			СтрокаИГ.ОбязательствоНаКонец = СтрокаИГ.ОбязательствоНаНачало + СтрокаИГ.ПроцентныеРасходы - СтрокаИГ.АренднаяПлата; 
			//Если окр(СтрокаИГ.ОбязательствоНаКонец,2) = 0 Тогда
			//	СтрокаИГ.ОбязательствоНаКонец = 0 ;
			//КонецЕсли;
			СтрокаИГ.ИзменениеОбязательства = СтрокаИГ.ОбязательствоНаКонец - СтрокаИГ.ОбязательствоНаНачало;                  
			ОбязательствоНаНачало = СтрокаИГ.ОбязательствоНаКонец;		
		КонецЦикла;	
		
		//Долгосрочная и краткосрочная части обязательства
		Для каждого СтрокаИГ Из ТЗИГ Цикл           
			ТЗИГ_ДЧ = ТЗИГ.Скопировать(,"ДатаПо, ИзменениеОбязательства");
			СтрокиДляУдаления = новый Массив;
			ДатаНаГодБольше = ДобавитьМесяц(СтрокаИГ.ДатаПо, 12);
			Для каждого СтрокаТЗИГ_ДЧ Из ТЗИГ_ДЧ Цикл
				Если СтрокаТЗИГ_ДЧ.ДатаПо <= ДатаНаГодБольше Тогда
					СтрокиДляУдаления.Добавить(СтрокаТЗИГ_ДЧ);
				КонецЕсли;
			КонецЦикла;
			Для каждого СтрокаДляУдаления Из СтрокиДляУдаления Цикл
				ТЗИГ_ДЧ.Удалить(СтрокаДляУдаления);	
			КонецЦикла; 
			СтрокаИГ.ДолгосрочнаяЧасть = -ТЗИГ_ДЧ.Итог("ИзменениеОбязательства");
			СтрокаИГ.КраткосрочнаяЧасть = СтрокаИГ.ОбязательствоНаКонец - СтрокаИГ.ДолгосрочнаяЧасть;
		КонецЦикла;
		
		//Расчет корректировки Д01.03 К76.07
		
		ПараметрыПолученияОстатков = Новый Структура;
		ПараметрыПолученияОстатков.Вставить("Договор", 							Объект.Договор);
		ПараметрыПолученияОстатков.Вставить("ОбъектППА", 						СтрокаСостав.ОбъектППА);
		ПараметрыПолученияОстатков.Вставить("ДатаНачалаГрафика", 				Объект.ДатаНачала);
		ПараметрыПолученияОстатков.Вставить("ДатаДокумента", 					Объект.Дата);
		ПараметрыПолученияОстатков.Вставить("График", 							Объект.Ссылка);
		ПараметрыПолученияОстатков.Вставить("ГрафикНачинаетсяПервогоЧисла", 	ГрафикНачинаетсяПервогоЧисла);
		
		ОстаткиНаНачало = ПолучитьОстаткиПоОбъектуППАНаДату(ПараметрыПолученияОстатков); 
		ЭтоНовыйОбъектППА = ОстаткиНаНачало.ЭтоНовыйОбъектППА;
		
		ОПСПоНовомуГрафику = ТЗИГ.Итог("ПриведеннаяСтоимость");
		
		Если ЭтоНовыйОбъектППА Тогда
			Корректировка = 0;
		Иначе
			Если ГрафикНачинаетсяПервогоЧисла Тогда
				Корректировка = ?(ОстаткиНаНачало.ОбязательствоОстаток <> 0, ОПСПоНовомуГрафику - ОстаткиНаНачало.ОбязательствоОстаток , 0);
			Иначе
				//Корректировка = ?(ОстаткиНаНачало.ОбязательствоОстаток <> 0, ОПСПоНовомуГрафику - ОстаткиНаНачало.ОбязательствоОстаток + ТЗИГ[0].ИзменениеОбязательства , 0);
				Корректировка = ?(ОстаткиНаНачало.ОбязательствоОстаток <> 0, ОПСПоНовомуГрафику - ОстаткиНаНачало.ОбязательствоОстаток, 0);
			КонецЕсли;
		КонецЕсли;
		
		//Корректировка = ?(Объект.ПредыдущаяРедакция <> документы.ГрафикДоговораДолгосрочнойАренды.ПустаяСсылка(), ОПСПоНовомуГрафику - ОстаткиНаНачало.ОбязательствоОстаток, 0);
		
		//Расчет стоимости ППА 01.03
		//Если это новый график, нужно брать ОПС + ОбеспечительныйПлатеж,
		//если изменения в договор, нужно увеличивать стоимость ППА на корректировку
		Если ЭтоНовыйОбъектППА Тогда
			СтоимостьППА = ОПСПоНовомуГрафику + Объект.Аванс / ИтогБазыРаспределения * СтрокаСостав.ПоказательБазыРаспределения;
		Иначе			
			СтоимостьППА = ОстаткиНаНачало.ПервоначальнаяСтоимость + Корректировка;
		КонецЕсли;
		
		АвансПоОбъекту = Объект.Аванс / ИтогБазыРаспределения * СтрокаСостав.ПоказательБазыРаспределения;
		
		//Расчет амортизации ППА
		АмортизацияНакопленная = ОстаткиНаНачало.НакопленнаяАмортизация;
		БалансоваяСтоимость = СтоимостьППА - АмортизацияНакопленная;
		ГлОбщаяСтоимостьППА = ГлОбщаяСтоимостьППА + СтоимостьППА;
		
		АмортизацияАвансаНакопленная = 0;
		
		ТЗИГ_РасчетСПИ = ТЗИГ.Скопировать(,"ДатаПо");
		Для каждого СтрокаТЗИГ_РасчетСПИ  Из ТЗИГ_РасчетСПИ Цикл
			СтрокаТЗИГ_РасчетСПИ.ДатаПо = НачалоМесяца(СтрокаТЗИГ_РасчетСПИ.ДатаПо);
		КонецЦикла;
		ТЗИГ_РасчетСПИ.Свернуть("ДатаПо");
		
		
		Если ЭтоНовыйОбъектППА Тогда
			СПИ = ТЗИГ_РасчетСПИ.Количество() - 1; 
		Иначе 
			Если ГрафикНачинаетсяПервогоЧисла Тогда
				СПИ = ТЗИГ_РасчетСПИ.Количество(); 
			Иначе
				СПИ = ТЗИГ_РасчетСПИ.Количество() - 1; 
			КонецЕсли;
		КонецЕсли;       
		
		ОстатокСПИ = СПИ; 
		Амортизация = 0;
		
		АмортизацияАванса = 0;
		
		Для каждого СтрокаИГ Из ТЗИГ Цикл 
			СтрокаИГ.СтоимостьППА = СтоимостьППА; 
			Если СтрокаИГ.НомерСтроки = 1 Тогда
				Если ЭтоНовыйОбъектППА Тогда
					Амортизация = 0;
					АмортизацияАванса = 0;
				Иначе 
					Если ГрафикНачинаетсяПервогоЧисла Тогда
						Амортизация = БалансоваяСтоимость / ОстатокСПИ;
						АмортизацияАванса = (АвансПоОбъекту - АмортизацияАвансаНакопленная) / ОстатокСПИ;
						ОстатокСПИ = ОстатокСПИ - 1;
					Иначе
						Амортизация = 0;
						АмортизацияАванса = 0;
					КонецЕсли;
				КонецЕсли;
			Иначе     
				Амортизация = БалансоваяСтоимость / ОстатокСПИ;
				АмортизацияАванса = (АвансПоОбъекту - АмортизацияАвансаНакопленная) / ОстатокСПИ;
				ОстатокСПИ = ОстатокСПИ - 1;
			КонецЕсли;
			
			АмортизацияНакопленная = АмортизацияНакопленная + Амортизация;
			АмортизацияАвансаНакопленная = АмортизацияАвансаНакопленная + АмортизацияАванса;
			
			БалансоваяСтоимость =  СтоимостьППА - АмортизацияНакопленная;
			СтрокаИГ.Амортизация = Амортизация;			
			СтрокаИГ.АмортизацияНакопленная = АмортизацияНакопленная; 
			СтрокаИГ.АмортизацияАванса 				= АмортизацияАванса;			
			СтрокаИГ.АмортизацияАвансаНакопленная 	= АмортизацияАвансаНакопленная; 
			СтрокаИГ.БалансоваяСтоимость 			= БалансоваяСтоимость;
			
		КонецЦикла;
		
		ГлОбщаяАмортизацияНаНачало = ГлОбщаяАмортизацияНаНачало + ОстаткиНаНачало.НакопленнаяАмортизация;
		ГлОстатокОПСНАНачало = ГлОстатокОПСНАНачало + ОстаткиНаНачало.ОбязательствоОстаток;
		ГлКорректировка = ГлКорректировка + Корректировка;
		
		//Создание записей детального графика в регистре сведений
		//и перенос индивидуального графика в общую таблицу
		Для каждого СтрокаИГ Из ТЗИГ Цикл 
			ЗаписьРазбивкиПоСоставу = РазбивкаПоСоставу.Добавить(); 
			ЗаполнитьЗначенияСвойств(ЗаписьРазбивкиПоСоставу,СтрокаИГ); 
			ЗаписьРазбивкиПоСоставу.Регистратор = Объект.Ссылка;
			ЗаписьРазбивкиПоСоставу.График = Объект.Ссылка;
			ЗаписьРазбивкиПоСоставу.УИДСтрокиГрафика = СтрокаИГ.УИДСтроки;
			
			СтрокаТЗДляВсехОбъектов =  ТЗОГДляВсехОбъектов.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаТЗДляВсехОбъектов,СтрокаИГ); 
		КонецЦикла;	
		
		//Заполнение ТЧ СоставППА
		ПараметрыОтбора = Новый Структура;
		ПараметрыОтбора.Вставить("ОбъектППА", СтрокаСостав.ОбъектППА);
		Строки = Объект.СоставППА.НайтиСтроки(ПараметрыОтбора);
		Строки[0].СтоимостьППА = СтоимостьППА;
		Строки[0].НакопленнаяАмортизация = ОстаткиНаНачало.НакопленнаяАмортизация;
		Строки[0].Аванс = АвансПоОбъекту;
		
	КонецЦикла; 
	
	//Свертка общей таблица
	МассивСтрокДляУдаления = ОбщегоНазначения.РазложитьСтрокуВМассивПодстрок("ДатаС,ДатаПо,Дней,ОбъектППА,НомерСтроки",",");
	Для каждого Элемент Из МассивСтрокДляУдаления Цикл
		Колонка = ТЗОГДляВсехОбъектов.Колонки.Найти(Элемент);
		Если Не Колонка = Неопределено Тогда
			ТЗОГДляВсехОбъектов.Колонки.Удалить(Колонка);
		КонецЕсли;
	КонецЦикла;
	
	ТЗОГДляВсехОбъектов.Свернуть("УИДСтроки","АренднаяПлата,ЗачетАванса,ПриведеннаяСтоимость,ПроцентныеРасходы,ОбязательствоНаНачало,ОбязательствоНаКонец,ИзменениеОбязательства,ДолгосрочнаяЧасть,КраткосрочнаяЧасть,СтоимостьППА,Амортизация,АмортизацияАванса,АмортизацияНакопленная,АмортизацияАвансаНакопленная,БалансоваяСтоимость");
	
	//Заполнение ТЧ_ГрафикПоДоговору свернутыми данными общего графика
	Для каждого СтрокаСвернутогоИГ Из ТЗОГДляВсехОбъектов Цикл
		ПараметрыОтбора = Новый Структура;
		ПараметрыОтбора.Вставить("УИДСтроки", СтрокаСвернутогоИГ.УИДСтроки);
		Строки = Объект.ГрафикПоДоговору.НайтиСтроки(ПараметрыОтбора);
		ЗаполнитьЗначенияСвойств(Строки[0],СтрокаСвернутогоИГ,"АренднаяПлата,ЗачетАванса,ПриведеннаяСтоимость,ПроцентныеРасходы,ОбязательствоНаНачало,ОбязательствоНаКонец,ИзменениеОбязательства,ДолгосрочнаяЧасть,КраткосрочнаяЧасть,СтоимостьППА,Амортизация,АмортизацияАванса,АмортизацияНакопленная,АмортизацияАвансаНакопленная,БалансоваяСтоимость");
	КонецЦикла; 
	
	//Заполнение справочных итоговых реквизитов
	объект.СтоимостьППА 			= ГлОбщаяСтоимостьППА;
	объект.ОПС 						= ГлОбщаяПриведеннаяСтоимость;
	объект.АмППАНаНачало 			= ГлОбщаяАмортизацияНаНачало;
	объект.ПредОПСНаДатуРедакции 	= ГлОстатокОПСНАНачало;
	объект.Корректировка 			= ГлКорректировка;
	
	Записать();
	РазбивкаПоСоставу.Записать();
	
КонецПроцедуры

Формирование документов по текучке
[
Процедура КнопкаВыполнитьНажатие(Кнопка)
	
	КоличествоДокументов = СписокДокументов.Строки.Количество();
	
	Если КоличествоДокументов = 0 Тогда
		Предупреждение("Не отобраны данные для создания документов");
		Возврат;
	КонецЕсли;	
	
	СуммаПоДокументам = СписокДокументов.Строки.Итог("Всего");
	
	ТекстВопроса = СтрШаблон("Будет создано %1 документов на сумму %2 руб." + Символы.ПС + "Продолжить?", КоличествоДокументов, СуммаПоДокументам);  
	Если Вопрос(ТекстВопроса, РежимДиалогаВопрос.ДаНет) = КодВозвратаДиалога.Нет Тогда
		Возврат;
	КонецЕсли;
	
	
	Для каждого Строка Из СписокДокументов.Строки Цикл
		
		НовыйДок = Документы.ПоступлениеТоваровУслуг.ПустаяСсылка();
		ЭлементыФормы.СписокДокументов.ТекущаяСтрока = Строка;
		
		Попытка
			Если ВидНачисления = "Арендная плата" Тогда
				НовыйДок = СоздатьДокументПТУПоАренднойПлате(Строка);
			ИначеЕсли ВидНачисления = "Проценты" Тогда
				НовыйДок = СоздатьДокументПТУПоПроцентам(Строка);
			КонецЕсли;
			Строка.Сообщение = "Создан";
		Исключение
			ТекстСообщения = СтрШаблон("Ошибка создания документа: строка №%1 от %2, %3, %4." + ОписаниеОшибки(), 
			Строка.Номер, 
			Строка.ДатаДокумента, 
			Строка.Контрагент, 
			Строка.Договор);
			Строка.Сообщение = ТекстСообщения;												
			Сообщить(ТекстСообщения);
		КонецПопытки;		
		Строка.НовыйДокумент = НовыйДок.Ссылка;
		ЭтаФорма.Обновить();
	КонецЦикла;
	
	Предупреждение("Завершено");
	
КонецПроцедуры

Процедура ОтобратьНажатие()
	
	СписокДокументов.Строки.Очистить();
	ВидНачисления = "Арендная плата";
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	_УчетДолгосрочнойАрендыОстатки.Договор,
		|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
		|	_УчетДолгосрочнойАрендыОстатки.Регистратор КАК График,
		|	_УчетДолгосрочнойАрендыОстатки.Регистратор.Дата КАК Дата
		|ПОМЕСТИТЬ ВТ_СписокППА
		|ИЗ
		|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки
		|ГДЕ
		|	_УчетДолгосрочнойАрендыОстатки.Период <= КОНЕЦПЕРИОДА(&СостояниеГрафиковНаДату, ДЕНЬ)
		|	И НЕ(_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Выбытие)
		|				И _УчетДолгосрочнойАрендыОстатки.ДатаСобытия > _УчетДолгосрочнойАрендыОстатки.ПериодГрафика)
		|	И _УчетДолгосрочнойАрендыОстатки.Регистратор.ВидГрафика <> Значение(Перечисление._ВидыГрафиковДолгосрочнойАренды.ЗаменаСтороныДоговора)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	_УчетДолгосрочнойАрендыОстатки.Договор,
		|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
		|	_УчетДолгосрочнойАрендыОстатки.ПериодГрафика КАК Период,
		|	СУММА(ВЫБОР
		|			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
		|				ТОГДА -_УчетДолгосрочнойАрендыОстатки.Обязательство
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК АренднаяПлата,
		|	СУММА(ВЫБОР
		|			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)
		|				ТОГДА _УчетДолгосрочнойАрендыОстатки.Обязательство
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК Проценты,
		|	СУММА(ВЫБОР
		|			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
		|				ТОГДА -_УчетДолгосрочнойАрендыОстатки.НДС
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК НДС
		|ПОМЕСТИТЬ ВТ_Данные
		|ИЗ
		|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки
		|ГДЕ
		|	_УчетДолгосрочнойАрендыОстатки.Период <= КОНЕЦПЕРИОДА(&СостояниеГрафиковНаДату, ДЕНЬ)
		|	И _УчетДолгосрочнойАрендыОстатки.ПериодГрафика МЕЖДУ НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ) И КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
		|	И НЕ(_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Выбытие)
		|				И _УчетДолгосрочнойАрендыОстатки.ДатаСобытия > _УчетДолгосрочнойАрендыОстатки.ПериодГрафика)
		|	И ВЫБОР
		|			КОГДА &Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ВЫБОР
		|					КОГДА &КонтрагентИсключить = ИСТИНА
		|						ТОГДА НЕ _УчетДолгосрочнойАрендыОстатки.Договор.Владелец = &Контрагент
		|					ИНАЧЕ _УчетДолгосрочнойАрендыОстатки.Договор.Владелец = &Контрагент
		|				КОНЕЦ
		|		КОНЕЦ
		|	И ВЫБОР
		|			КОГДА &Договор = ЗНАЧЕНИЕ(справочник.ДоговорыКонтрагентов.ПустаяСсылка)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ВЫБОР
		|					КОГДА &ДоговорИсключить = ИСТИНА
		|						ТОГДА НЕ _УчетДолгосрочнойАрендыОстатки.Договор = &Договор
		|					ИНАЧЕ _УчетДолгосрочнойАрендыОстатки.Договор = &Договор
		|				КОНЕЦ
		|		КОНЕЦ
		|	И ВЫБОР
		|			КОГДА &ОбъектППА = ЗНАЧЕНИЕ(справочник.ОсновныеСредства.ПустаяСсылка)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ВЫБОР
		|					КОГДА &ОбъектППАИсключить = ИСТИНА
		|						ТОГДА НЕ _УчетДолгосрочнойАрендыОстатки.ОбъектППА = &ОбъектППА
		|					ИНАЧЕ _УчетДолгосрочнойАрендыОстатки.ОбъектППА = &ОбъектППА
		|				КОНЕЦ
		|		КОНЕЦ
		|
		|СГРУППИРОВАТЬ ПО
		|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
		|	_УчетДолгосрочнойАрендыОстатки.ПериодГрафика,
		|	_УчетДолгосрочнойАрендыОстатки.Договор
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТ_Данные.Договор,
		|	ВТ_Данные.ОбъектППА,
		|	ВТ_Данные.Период,
		//|	ОКР(ВТ_Данные.АренднаяПлата, 2) КАК АренднаяПлата,
		//|	ОКР(ВТ_Данные.НДС, 2) КАК НДС,
		//|	ОКР(ВТ_Данные.Проценты, 2) КАК Проценты
		|	ВТ_Данные.АренднаяПлата КАК АренднаяПлата,
		|	ВТ_Данные.НДС КАК НДС,
		|	ВТ_Данные.Проценты КАК Проценты		
		|ПОМЕСТИТЬ ВТ_Начисления
		|ИЗ
		|	ВТ_Данные КАК ВТ_Данные
		|ГДЕ
		|	Выбор когда &ВидНачисления = ""Арендная плата"" тогда ОКР(ВТ_Данные.АренднаяПлата, 2) <> 0 
		|			когда &ВидНачисления = ""Проценты"" тогда ОКР(ВТ_Данные.Проценты, 2) <> 0 Конец
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Начисления.Договор,
		|	Начисления.Договор.Владелец КАК Контрагент,
		|	Начисления.ОбъектППА,
		|	Начисления.АренднаяПлата КАК Сумма,
		|	Начисления.НДС,
		|	СписокППА.График,
		|	СписокППА.График.ОтдельныеАктыПоАдресам КАК ОтдельныеАктыПоАдресам,
		|	СписокППА.Дата
		|ПОМЕСТИТЬ ВТ_Начисления2
		|ИЗ
		|	ВТ_Начисления КАК Начисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СписокППА КАК СписокППА
		|		ПО ((СписокППА.Дата, СписокППА.ОбъектППА) В
		|				(ВЫБРАТЬ
		|					МАКСИМУМ(СписокППА.Дата),
		|					СписокППА.ОбъектППА
		|				ИЗ
		|					ВТ_СписокППА КАК СписокППА
		|				ГДЕ
		|					СписокППА.ОбъектППА = Начисления.ОбъектППА
		|				СГРУППИРОВАТЬ ПО
		|					СписокППА.ОбъектППА))
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТ_Начисления2.Договор,
		|	ВТ_Начисления2.Контрагент,
		|	ВТ_Начисления2.ОбъектППА,
		|	ВТ_Начисления2.Сумма,
		|	ВТ_Начисления2.НДС,
		|	ВТ_Начисления2.График,
		|	ВТ_Начисления2.ОтдельныеАктыПоАдресам,
		|	_ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.СтавкаНДС
		|ПОМЕСТИТЬ ВТ_Начисления3
		|ИЗ
		|	ВТ_Начисления2 КАК ВТ_Начисления2
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ._ГрафикДоговораДолгосрочнойАренды.ГрафикПоДоговору КАК _ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору
		|		ПО ВТ_Начисления2.График = _ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.Ссылка
		|			И (_ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.ДатаПо В
		|				(ВЫБРАТЬ
		|					МАКСИМУМ(_ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.ДатаПо)
		|				ИЗ
		|					Документ._ГрафикДоговораДолгосрочнойАренды.ГрафикПоДоговору КАК _ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору
		|				ГДЕ
		|					_ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.Ссылка = ВТ_Начисления2.График
		|					И _ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.ДатаПо <= &КонецПериода))
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТ_Начисления3.Договор,
		|	ВТ_Начисления3.Контрагент,
		|	ВТ_Начисления3.ОбъектППА,
		|	ВТ_Начисления3.Сумма,
		|	ВТ_Начисления3.НДС,
		|	ВТ_Начисления3.График,
		|	ВТ_Начисления3.ОтдельныеАктыПоАдресам,
		|	Выбор 
		|		когда ВТ_Начисления3.СтавкаНДС = Значение(Перечисление.СтавкиНДС.ПустаяСсылка) Тогда График.СтавкаНДС
		|		Иначе ВТ_Начисления3.СтавкаНДС
		|	Конец как СтавкаНДС
		|ИЗ
		|	ВТ_Начисления3 КАК ВТ_Начисления3
		|";   
		
	Если СостояниеГрафиковНаДату = Дата(1,1,1) Тогда
		мСостояниеГрафиковНаДату = Дата(2999,1,1)
	Иначе 
		мСостояниеГрафиковНаДату = СостояниеГрафиковНаДату 
	КонецЕсли;
		
	Запрос.Параметры.Вставить("СостояниеГрафиковНаДату", мСостояниеГрафиковНаДату); 
	Запрос.Параметры.Вставить("НачалоПериода", НачалоПериода); // <Дата>[01.12.2024 0:00:00]
	Запрос.Параметры.Вставить("КонецПериода", КонецПериода); // <Дата>[01.01.2025 0:00:00]
	Запрос.Параметры.Вставить("Договор", Договор); // <Договор контрагента>[], Справочники.ДоговорыКонтрагентов.ПустаяСсылка();
	Запрос.Параметры.Вставить("Контрагент", Контрагент); // <Контрагент>[КИО (бывший КУГИ)], Справочники.Контрагенты.НайтиПоНаименованию("КИО (бывший КУГИ)");
	Запрос.Параметры.Вставить("ОбъектППА", ОбъектППА); // <Основные средства>[], Справочники.ОсновныеСредства.ПустаяСсылка();
	Запрос.Параметры.Вставить("ДоговорИсключить", ДоговорИсключить); // <Булево>[Нет]
	Запрос.Параметры.Вставить("КонтрагентИсключить", КонтрагентИсключить); // <Булево>[Да]
	Запрос.Параметры.Вставить("ОбъектППАИсключить", ОбъектППАИсключить); // <Булево>[Нет]
	Запрос.Параметры.Вставить("ВидНачисления", ВидНачисления); 
	
	Список = Запрос.Выполнить().Выгрузить();
	
	Сгруппировать(Список);
	
	
КонецПроцедуры

Процедура ОбновлениеОтображения()
	
	Попытка
		ЭлементыФормы.СписокДокументов.Колонки["Номер"].ТекстПодвала = СписокДокументов.Строки.Количество();
		ЭлементыФормы.СписокДокументов.Колонки["Номер"].ГоризонтальноеПоложениеВПодвале = ГоризонтальноеПоложение.Право; 
	Исключение
		
	КонецПопытки;
	
	
КонецПроцедуры

Процедура ПроцентыНажатие(Элемент) 
	
	СписокДокументов.Строки.Очистить();
	ВидНачисления = "Проценты";
	
	Запрос = Новый Запрос;
		Запрос.Текст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	_УчетДолгосрочнойАрендыОстатки.Договор,
		|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
		|	_УчетДолгосрочнойАрендыОстатки.Регистратор КАК График,
		|	_УчетДолгосрочнойАрендыОстатки.Регистратор.Дата КАК Дата
		|ПОМЕСТИТЬ ВТ_СписокППА
		|ИЗ
		|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки
		|ГДЕ
		|	_УчетДолгосрочнойАрендыОстатки.Период <= КОНЕЦПЕРИОДА(&СостояниеГрафиковНаДату, ДЕНЬ)
		|	И НЕ(_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Выбытие)
		|				И _УчетДолгосрочнойАрендыОстатки.ДатаСобытия > _УчетДолгосрочнойАрендыОстатки.ПериодГрафика)
		|	И _УчетДолгосрочнойАрендыОстатки.Регистратор.ВидГрафика <> Значение(Перечисление._ВидыГрафиковДолгосрочнойАренды.ЗаменаСтороныДоговора)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	_УчетДолгосрочнойАрендыОстатки.Договор,
		|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
		|	_УчетДолгосрочнойАрендыОстатки.ПериодГрафика КАК Период,
		|	СУММА(ВЫБОР
		|			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
		|				ТОГДА -_УчетДолгосрочнойАрендыОстатки.Обязательство
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК АренднаяПлата,
		|	СУММА(ВЫБОР
		|			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)
		|				ТОГДА _УчетДолгосрочнойАрендыОстатки.Обязательство
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК Проценты,
		|	СУММА(ВЫБОР
		|			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
		|				ТОГДА -_УчетДолгосрочнойАрендыОстатки.НДС
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК НДС
		|ПОМЕСТИТЬ ВТ_Данные
		|ИЗ
		|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки
		|ГДЕ
		|	_УчетДолгосрочнойАрендыОстатки.Период <= КОНЕЦПЕРИОДА(&СостояниеГрафиковНаДату, ДЕНЬ)
		|	И _УчетДолгосрочнойАрендыОстатки.ПериодГрафика МЕЖДУ НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ) И КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
		|	И НЕ(_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Выбытие)
		|				И _УчетДолгосрочнойАрендыОстатки.ДатаСобытия > _УчетДолгосрочнойАрендыОстатки.ПериодГрафика)
		|	И ВЫБОР
		|			КОГДА &Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ВЫБОР
		|					КОГДА &КонтрагентИсключить = ИСТИНА
		|						ТОГДА НЕ _УчетДолгосрочнойАрендыОстатки.Договор.Владелец = &Контрагент
		|					ИНАЧЕ _УчетДолгосрочнойАрендыОстатки.Договор.Владелец = &Контрагент
		|				КОНЕЦ
		|		КОНЕЦ
		|	И ВЫБОР
		|			КОГДА &Договор = ЗНАЧЕНИЕ(справочник.ДоговорыКонтрагентов.ПустаяСсылка)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ВЫБОР
		|					КОГДА &ДоговорИсключить = ИСТИНА
		|						ТОГДА НЕ _УчетДолгосрочнойАрендыОстатки.Договор = &Договор
		|					ИНАЧЕ _УчетДолгосрочнойАрендыОстатки.Договор = &Договор
		|				КОНЕЦ
		|		КОНЕЦ
		|	И ВЫБОР
		|			КОГДА &ОбъектППА = ЗНАЧЕНИЕ(справочник.ОсновныеСредства.ПустаяСсылка)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ВЫБОР
		|					КОГДА &ОбъектППАИсключить = ИСТИНА
		|						ТОГДА НЕ _УчетДолгосрочнойАрендыОстатки.ОбъектППА = &ОбъектППА
		|					ИНАЧЕ _УчетДолгосрочнойАрендыОстатки.ОбъектППА = &ОбъектППА
		|				КОНЕЦ
		|		КОНЕЦ
		|
		|СГРУППИРОВАТЬ ПО
		|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
		|	_УчетДолгосрочнойАрендыОстатки.ПериодГрафика,
		|	_УчетДолгосрочнойАрендыОстатки.Договор
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТ_Данные.Договор,
		|	ВТ_Данные.ОбъектППА,
		|	ВТ_Данные.Период,
		|	ОКР(ВТ_Данные.АренднаяПлата, 2) КАК АренднаяПлата,
		|	0 КАК НДС,
		|	ОКР(ВТ_Данные.Проценты, 2) КАК Проценты
		|ПОМЕСТИТЬ ВТ_Начисления
		|ИЗ
		|	ВТ_Данные КАК ВТ_Данные
		|ГДЕ
		|	(ОКР(ВТ_Данные.АренднаяПлата, 2) <> 0
		|			ИЛИ ОКР(ВТ_Данные.Проценты, 2) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Начисления.Договор,
		|	Начисления.Договор.Владелец КАК Контрагент,
		|	Начисления.ОбъектППА,
		//|	Начисления.АренднаяПлата КАК Сумма,
		|	Начисления.НДС,
		|	Начисления.Проценты КАК Сумма,
		|	СписокППА.График,
		|	СписокППА.График.ОтдельныеАктыПоАдресам  как ОтдельныеАктыПоАдресам,
		| 	Значение(Перечисление.СтавкиНДС.БезНДС) как СтавкаНДС
		|ИЗ
		|	ВТ_Начисления КАК Начисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СписокППА КАК СписокППА
		|		ПО ((СписокППА.Дата, СписокППА.ОбъектППА) В
		|				(ВЫБРАТЬ
		|					МАКСИМУМ(СписокППА.Дата),
		|					СписокППА.ОбъектППА
		|				ИЗ
		|					ВТ_СписокППА КАК СписокППА
		|				ГДЕ
		|					СписокППА.ОбъектППА = Начисления.ОбъектППА
		|				СГРУППИРОВАТЬ ПО
		|					СписокППА.ОбъектППА))
		|"; 

	Если СостояниеГрафиковНаДату = Дата(1,1,1) Тогда
		мСостояниеГрафиковНаДату = Дата(2999,1,1)
	Иначе 
		мСостояниеГрафиковНаДату = СостояниеГрафиковНаДату 
	КонецЕсли;
 
	Запрос.Параметры.Вставить("СостояниеГрафиковНаДату", мСостояниеГрафиковНаДату); 
	
	Запрос.Параметры.Вставить("НачалоПериода", НачалоПериода); // <Дата>[01.12.2024 0:00:00]
	Запрос.Параметры.Вставить("КонецПериода", КонецПериода); // <Дата>[01.01.2025 0:00:00]
	Запрос.Параметры.Вставить("Договор", Договор); // <Договор контрагента>[], Справочники.ДоговорыКонтрагентов.ПустаяСсылка();
	Запрос.Параметры.Вставить("Контрагент", Контрагент); // <Контрагент>[КИО (бывший КУГИ)], Справочники.Контрагенты.НайтиПоНаименованию("КИО (бывший КУГИ)");
	Запрос.Параметры.Вставить("ОбъектППА", ОбъектППА); // <Основные средства>[], Справочники.ОсновныеСредства.ПустаяСсылка();
	Запрос.Параметры.Вставить("ДоговорИсключить", ДоговорИсключить); // <Булево>[Нет]
	Запрос.Параметры.Вставить("КонтрагентИсключить", КонтрагентИсключить); // <Булево>[Да]
	Запрос.Параметры.Вставить("ОбъектППАИсключить", ОбъектППАИсключить); // <Булево>[Нет]
	
	Список = Запрос.Выполнить().Выгрузить();
	Сгруппировать(Список);
	
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(НачалоПериода, ?(КонецПериода='0001-01-01', КонецПериода, КонецДня(КонецПериода)));
	Если НастройкаПериода.Редактировать() Тогда
		НачалоПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонецПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли; 
	
КонецПроцедуры

Процедура Сгруппировать(Тз)
	
	СписокДокументов.Строки.Очистить(); 
	
	Если тз.Количество()=0 Тогда
		Возврат;
	КонецЕсли;
	
	Запрос = Новый Запрос; 
	Запрос.Текст = 
	"ВЫБРАТЬ 
	|	* 
	|	Поместить ВТ 
	|	из &ТЗ как ТЗ;
	|ВЫБРАТЬ
	//|	"""" + ВТ.Контрагент.Код + ""; "" + ВТ.Договор.Код + ""; "" + ВТ.График.Номер " 
	|	"""" + ВТ.Контрагент.Код + ""; "" + ВТ.Договор.Код " 
	+ ?(ВидНачисления = "Арендная плата", 
	"+ Выбор когда ВТ.ОтдельныеАктыПоАдресам = истина тогда ""; "" + вт.ОбъектППА.Код иначе """" Конец", 
	"") 
	+ "	как Номер,
	|	ВТ.Контрагент,
	|	ВТ.Договор,
	|	ВТ.ОбъектППА,
	//|	"" как ДатаС,
	//|	"" как ДатаПо,
	|	ВТ.сумма Как Всего, 
	|	ВТ.сумма Как Сумма,
	|	Вт.НДС как ВсегоНДС,
	|	Вт.НДС как НДС,
	|	ВТ.СтавкаНДС,
	|	ВТ.График как График, 
	//|	"" как НомерСтрокиГрафика,
	//|	ВТ.НомерСтрокиРазбивки, 
	
	|	ДатаВремя(1,1,1,0,0,0) как ДатаДокумента, 
	|	ЗНАЧЕНИЕ(Документ.ПоступлениеТоваровУслуг.пустаяссылка) как НовыйДокумент, 
	|	Выразить("""" как Строка(255))как Сообщение
	|ИЗ
	|	ВТ КАК ВТ
	//| УПОРЯДОЧИТЬ ПО Контрагент, Договор, ОбъектППА
	|Итоги сумма(сумма), сумма(Всего), сумма(НДС), Сумма(ВсегоНДС), количество(ОбъектППА) по Номер";
	
	Запрос.Параметры.Вставить("ТЗ", ТЗ); 
	РезультатЗапроса = Запрос.Выполнить().Выгрузить(ОбходРезультатаЗапроса.ПоГруппировкамСИерархией);
	ОбработатьДерево(РезультатЗапроса);
	СписокДокументов = РезультатЗапроса;
	ЭлементыФормы.СписокДокументов.СоздатьКолонки();  
	
	ЭлементыФормы.СписокДокументов.Колонки["Сумма"].отображатьитогивподвале = истина;
	ЭлементыФормы.СписокДокументов.Колонки["Сумма"].ГоризонтальноеПоложениеВПодвале = ГоризонтальноеПоложение.Право;
	ЭлементыФормы.СписокДокументов.Колонки["Всего"].отображатьитогивподвале = истина;
	ЭлементыФормы.СписокДокументов.Колонки["Всего"].ГоризонтальноеПоложениеВПодвале = ГоризонтальноеПоложение.Право;
	ЭлементыФормы.СписокДокументов.Колонки["НДС"].отображатьитогивподвале = истина;
	ЭлементыФормы.СписокДокументов.Колонки["НДС"].ГоризонтальноеПоложениеВПодвале = ГоризонтальноеПоложение.Право;
	ЭлементыФормы.СписокДокументов.Колонки["ВсегоНДС"].отображатьитогивподвале = истина;
	ЭлементыФормы.СписокДокументов.Колонки["ВсегоНДС"].ГоризонтальноеПоложениеВПодвале = ГоризонтальноеПоложение.Право;
	ЭлементыФормы.СписокДокументов.Колонки["ОбъектППА"].отображатьитогивподвале = истина;
	ЭлементыФормы.СписокДокументов.Колонки["ОбъектППА"].ГоризонтальноеПоложениеВПодвале = ГоризонтальноеПоложение.Право;
	
	Для каждого Колонка Из ЭлементыФормы.СписокДокументов.Колонки Цикл  
		Если Колонка.Имя = "Номер" Тогда
			Колонка.Ширина = 15;
		ИначеЕсли Колонка.Имя = "Контрагент" Тогда 
			Колонка.Ширина = 40;
		ИначеЕсли Колонка.Имя = "Договор" Тогда 
			Колонка.Ширина = 40;
		ИначеЕсли Колонка.Имя = "ОбъектППА" Тогда 
			Колонка.Ширина = 40;
		ИначеЕсли Колонка.Имя = "НовыйДокумент" Тогда 
			Колонка.Ширина = 40;
		ИначеЕсли Колонка.Имя = "НомерСтрокиГрафика" Тогда 
			Колонка.Ширина = 10; 
		ИначеЕсли Колонка.Имя = "СтавкаНДС" Тогда 
			Колонка.Ширина = 15;			
			//ИначеЕсли Колонка.Имя = "НомерСтрокиРазбивки" Тогда 
			//	Колонка.Ширина = 10;
		Иначе
			Колонка.Ширина = 20;
		КонецЕсли;
	КонецЦикла;
	

	ЭлементыФормы.СписокДокументов.Колонки["Сумма"].Формат = "ЧДЦ=2";
	ЭлементыФормы.СписокДокументов.Колонки["Всего"].Формат = "ЧДЦ=2";
	ЭлементыФормы.СписокДокументов.Колонки["НДС"].Формат = "ЧДЦ=2";
	ЭлементыФормы.СписокДокументов.Колонки["ВсегоНДС"].Формат = "ЧДЦ=2";
	
	
	ЭлементыФормы.СписокДокументов.Колонки["Контрагент"].ЭлементУправления.КнопкаОткрытия = истина;
	ЭлементыФормы.СписокДокументов.Колонки["Договор"].ЭлементУправления.КнопкаОткрытия = истина;
	ЭлементыФормы.СписокДокументов.Колонки["ОбъектППА"].ЭлементУправления.КнопкаОткрытия = истина;
	ЭлементыФормы.СписокДокументов.Колонки["График"].ЭлементУправления.КнопкаОткрытия = истина;
	ЭлементыФормы.СписокДокументов.Колонки["НовыйДокумент"].ЭлементУправления.КнопкаОткрытия = истина;
	
	СинийЦвет = Новый Цвет(0, 0, 127);
	ЭлементыФормы.СписокДокументов.Колонки["ДатаДокумента"].ЦветТекстаПоля = СинийЦвет;
	
КонецПроцедуры

Процедура ОбработатьДерево(ДЗ) 
	
	Для каждого Строка Из дз.строки Цикл
		
		Строка.Сумма = 0;
		Строка.НДС = 0;
		
		Строка.ДатаДокумента = НачалоДня(КонецПериода);
		//Строка.ДатаС = Дата(1,1,1);
		
		НомерПодстроки = 0;                   
		строка.строки.сортировать("ОбъектППА");
		
		Для каждого подстрока Из строка.строки Цикл
			НомерПодстроки = НомерПодстроки + 1;
			Подстрока.Номер = НомерПодстроки;
			Если НомерПодстроки = 1 Тогда
				Строка.Контрагент = Подстрока.Контрагент;			
				Строка.Договор = Подстрока.Договор;
				Строка.График = Подстрока.График;
				Строка.СтавкаНДС = Подстрока.СтавкаНДС;
			КонецЕсли;
			
			ПодСтрока.Контрагент = Справочники.Контрагенты.ПустаяСсылка();
			ПодСтрока.Договор = Справочники.ДоговорыКонтрагентов.ПустаяСсылка();
			Подстрока.График = Документы._ГрафикДоговораДолгосрочнойАренды.ПустаяСсылка();
			Подстрока.СтавкаНДС = Перечисления.СтавкиНДС.ПустаяСсылка();
			Подстрока.Всего = 0;  
			Подстрока.ВсегоНДС = 0;  
		КонецЦикла;	
		
	КонецЦикла;	
	
	ДЗ.Строки.Сортировать("Контрагент, Договор, ОбъектППА");
	
	НомерДокумента = 0;
	Для каждого Строка Из дз.строки Цикл
		НомерДокумента = НомерДокумента + 1;
		Строка.Номер = НомерДокумента;
		Для каждого ПодСтрока Из Строка.Строки Цикл
			СпособОтраженияРасходов = ПолучитьСпособОтраженияРасходовПоОС(ПодСтрока.ОбъектППА, Строка.ДатаДокумента);
			Если СпособОтраженияРасходов.Проект = null Тогда
			    СтрокаСообщения = СтрШаблон(
					"Не найден проект: Документ [%1], Строка документа [%2], Контрагент [%3], Договор [%4], Объект [%5], сумма [%6]",					
					Строка.Номер,
					ПодСтрока.Номер,
					Строка.Контрагент,
					Строка.Договор,
					Подстрока.ОбъектППА,
					Подстрока.Сумма
					); 
				Сообщить(СтрокаСообщения);
			КонецЕсли;
		КонецЦикла;
	КонецЦикла;	
	
КонецПроцедуры

Процедура СписокДокументовПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	
	Если ДанныеСтроки.Уровень()=1 Тогда
		ЦветПодстроки = Новый Цвет(80, 80, 80);
		ОформлениеСтроки.ЦветТекста = ЦветПодстроки;
		НаклонныйШрифт = новый Шрифт("Arial", 8, Ложь, Истина, Ложь, Ложь); //имя,размер,полужирный,наклонный,подчеркивание,зачеркивание
		ОформлениеСтроки.Шрифт = НаклонныйШрифт ;
	КонецЕсли;
	
КонецПроцедуры

Функция СоздатьДокументПТУПоАренднойПлате(Строка)
	
	НовыйДок = Документы.ПоступлениеТоваровУслуг.СоздатьДокумент();
	НовыйДок.Дата = Строка.ДатаДокумента;
	НовыйДок.ПлатаЗаПравоПользованияПредметамиАренды = Истина;
	НовыйДок.ВидПоступления = перечисления.ВидыПоступленияТоваров.НаСклад;
	НовыйДок.ВидОперации = перечисления.ВидыОперацийПоступлениеТоваровУслуг.ПокупкаКомиссия;
	НовыйДок.Организация = Справочники.Организации.НайтиПоКоду("000000001");
	НовыйДок.Контрагент = Строка.Контрагент;
	НовыйДок.ДоговорКонтрагента = Строка.Договор;
	НовыйДок.ОтражатьВБухгалтерскомУчете = Истина;
	НовыйДок.ОтражатьВНалоговомУчете = Ложь;
	НовыйДок.ОтражатьВУправленческомУчете = Истина;
	НовыйДок.Ответственный = ПараметрыСеанса.ТекущийПользователь;
	НовыйДок.Комментарий = "Начисление арендной платы";
	НовыйДок.СчетУчетаРасчетовСКонтрагентом = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.2");
	НовыйДок.СчетУчетаНДСПоАренднымОбязательствам = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.9");
	НовыйДок.СчетУчетаПроцентовПоАренде = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.5");
	НовыйДок.ВалютаДокумента = Справочники.Валюты.НайтиПоКоду("643");
	НовыйДок.ТипЦен = Справочники.ТипыЦенНоменклатурыКонтрагентов.НайтиПоКоду("00001");
	НовыйДок.КурсВзаиморасчетов = 1;
	НовыйДок.КратностьВзаиморасчетов = 1;
	НовыйДок.Сделка = Строка.График;
	
	мСтавкаНДС = 0;
	
	//Если Строка.СтавкаНДС = Перечисления.СтавкиНДС.БезНДС Тогда
	//	мСтавкаНДС = 0;
	//ИначеЕсли Строка.СтавкаНДС = Перечисления.СтавкиНДС.НДС20 Тогда
	//	мСтавкаНДС = 0.2;
	//ИначеЕсли Строка.СтавкаНДС = Перечисления.СтавкиНДС.НДС5 Тогда
	//	мСтавкаНДС = 0.05;
	//ИначеЕсли Строка.СтавкаНДС = Перечисления.СтавкиНДС.НДС7 Тогда
	//	мСтавкаНДС = 0.07;
	//КонецЕсли;       
	
	мСтавкаНДС = УчетНДС.ПолучитьСтавкуНДС(Строка.СтавкаНДС) / 100;
	
	ВсегоЦена = 0;
	ВсегоСумма = 0; 
	ВсегоСуммаНДС = 0;
	
	Если мСтавкаНДС <> 0 Тогда
		НовыйДок.УчитыватьНДС = Истина;
		НовыйДок.СуммаВключаетНДС = Истина;
	КонецЕсли;
	
	Для каждого СтрокаППА Из Строка.Строки Цикл
		НоваяСтрокаТЧ = Новыйдок.Услуги.Добавить();
		
		НоваяСтрокаТЧ.Номенклатура = Справочники.Номенклатура.НайтиПоКоду("00000007676"); 
		НоваяСтрокаТЧ.Количество = 1;
		
		АренднаяПлатаС_НДС = окр(СтрокаППА.Сумма  + СтрокаППА.НДС ,2);
		АренднаяПлатаБезНДС = СтрокаППА.Сумма;   
		СуммаНДС = окр(СтрокаППА.НДС, 2);
		
		НоваяСтрокаТЧ.Цена = АренднаяПлатаС_НДС;
		НоваяСтрокаТЧ.Сумма = АренднаяПлатаС_НДС;
		
		Если мСтавкаНДС <> 0 Тогда
			НоваяСтрокаТч.СуммаНДС = СуммаНДС;
			Если Строка.График.НалоговыйАгент Тогда
				пСтавкаНДС = перечисления.СтавкиНДС.БезНДС;
				Если Строка.СтавкаНДС = перечисления.СтавкиНДС.НДС20 Тогда
					пСтавкаНДС = перечисления.СтавкиНДС.НДС20_120;
				ИначеЕсли Строка.СтавкаНДС = перечисления.СтавкиНДС.НДС22 Тогда					
					пСтавкаНДС = перечисления.СтавкиНДС.НДС22_122;
				ИначеЕсли Строка.СтавкаНДС = перечисления.СтавкиНДС.НДС5 Тогда					
					пСтавкаНДС = перечисления.СтавкиНДС.НДС5_105;
				ИначеЕсли Строка.СтавкаНДС = перечисления.СтавкиНДС.НДС7 Тогда					
					пСтавкаНДС = перечисления.СтавкиНДС.НДС7_107;
				КонецЕсли;
				НоваяСтрокаТч.СтавкаНДС = пСтавкаНДС;
			Иначе
				НоваяСтрокаТч.СтавкаНДС = Строка.СтавкаНДС;
			КонецЕсли;
			НоваяСтрокаТч.СчетУчетаНДС = ПланыСчетов.Хозрасчетный.НайтиПоКоду("19.04");
		Иначе
			НоваяСтрокаТч.СтавкаНДС = перечисления.СтавкиНДС.БезНДС;
		КонецЕсли;
		
		СтруктураПараметровАмортизации =  ПолучитьСпособОтраженияРасходовПоОС(СтрокаППА.ОбъектППА, КонецМесяца(Строка.ДатаДокумента));
		
		НоваяСтрокаТч.ПодразделениеОрганизации = СтруктураПараметровАмортизации.ПодразделениеОрганизации;
		НоваяСтрокаТч.Подразделение = СтруктураПараметровАмортизации.Подразделение;
		НоваяСтрокаТч.Проект = СтруктураПараметровАмортизации.Проект;
		
		НоваяСтрокаТч.СтатьяЗатрат = Справочники.СтатьиЗатрат.НайтиПоКоду("000000118");
		НоваяСтрокаТч.Содержание = "Начисление арендной платы. Инв№ " + СтрокаППА.ОбъектППА.Код;
		НоваяСтрокаТч.ДатаНач = НачалоПериода;
		НоваяСтрокаТч.ДатаКон = КонецПериода;
		НоваяСтрокаТч.СчетЗатрат = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.1");
		НоваяСтрокаТч.СчетЗатратНУ = ПланыСчетов.Налоговый.НайтиПоКоду("20.01.2");
		НоваяСтрокаТч.Субконто1 = Строка.Контрагент;
		НоваяСтрокаТч.Субконто2 = Строка.Договор;
		НоваяСтрокаТч.ОсновноеСредство = СтрокаППА.ОбъектППА;
		
		ВсегоЦена = ВсегоЦена + НоваяСтрокаТЧ.Цена;
		ВсегоСумма = ВсегоСумма + НоваяСтрокаТЧ.Сумма; 
		ВсегоСуммаНДС = ВсегоСуммаНДС + НоваяСтрокаТч.СуммаНДС;
		
	КонецЦикла;  
	

	ИндексСтроки = Новыйдок.Услуги.Количество() - 1;
	Если ИндексСтроки >= 0 Тогда 
		
		Отклонение = 0 ;
		Если ВсегоЦена <> Окр(Строка.Всего + Строка.ВсегоНДС,2) Тогда
			Отклонение = Окр(Строка.Всего + Строка.ВсегоНДС,2) - ВсегоЦена;
			Новыйдок.Услуги[ИндексСтроки].Цена = 	Новыйдок.Услуги[ИндексСтроки].Цена + Отклонение;
		КонецЕсли; 
		
		Отклонение = 0 ;
		Если ВсегоСумма <> Окр(Строка.Всего + Строка.ВсегоНДС,2) Тогда
			Отклонение = Окр(Строка.Всего + Строка.ВсегоНДС,2) - ВсегоСумма;
			Новыйдок.Услуги[ИндексСтроки].Сумма = Новыйдок.Услуги[ИндексСтроки].Сумма + Отклонение;
		КонецЕсли;
		
		Отклонение = 0 ;
		Если ВсегоСуммаНДС <> Окр(Строка.ВсегоНДС, 2) Тогда
			Отклонение = Окр(Строка.ВсегоНДС,2) - ВсегоСуммаНДС;
			Новыйдок.Услуги[ИндексСтроки].СуммаНДС = Новыйдок.Услуги[ИндексСтроки].СуммаНДС + Отклонение;
		КонецЕсли; 
		
	КонецЕсли;
	
	НовыйДок.ПодразделениеОрганизации = СтруктураПараметровАмортизации.ПодразделениеОрганизации;
	НовыйДок.Подразделение = СтруктураПараметровАмортизации.Подразделение;
	НовыйДок.Проект = СтруктураПараметровАмортизации.Проект;
	
	НовыйДок.Записать(РежимЗаписиДокумента.Запись);
	
	Возврат НовыйДок;	
	
КонецФункции      

Функция ПолучитьСпособОтраженияРасходовПоОС(ОсновноеСредство, Период)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ОсновныеСредства.Ссылка КАК ОсновноеСредство,
	|	ОсновныеСредства.ГруппаОС.Ссылка КАК ГруппаОС,
	|	ОсновныеСредства.ТипОС,
	|	МестонахождениеОСБухгалтерскийУчетСрезПоследних._АдресМестонахождения КАК Адрес,
	|	СпособыОтраженияРасходовПоАмортизацииСпособы.СтатьяЗатрат,
	|	СпособыОтраженияРасходовПоАмортизацииСпособы.НоменклатурнаяГруппа,
	|	СпособыОтраженияРасходовПоАмортизацииСпособы.Подразделение,
	|	СпособыОтраженияРасходовПоАмортизацииСпособы.ПодразделениеОрганизации,
	|	СпособыОтраженияРасходовПоАмортизацииСпособы.СчетЗатрат,
	|	Проекты.Ссылка КАК Проект
	|ИЗ
	|	Справочник.ОсновныеСредства КАК ОсновныеСредства
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.МестонахождениеОСБухгалтерскийУчет.СрезПоследних(&Период, ) КАК МестонахождениеОСБухгалтерскийУчетСрезПоследних
	|		ПО (МестонахождениеОСБухгалтерскийУчетСрезПоследних.ОсновноеСредство = ОсновныеСредства.Ссылка)
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СпособыОтраженияРасходовПоАмортизацииОСБухгалтерскийУчет.СрезПоследних(&Период, ) КАК СпособыОтраженияРасходовПоАмортизацииОСБухгалтерскийУчетСрезПоследних
	|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.СпособыОтраженияРасходовПоАмортизации.Способы КАК СпособыОтраженияРасходовПоАмортизацииСпособы
	|			ПО СпособыОтраженияРасходовПоАмортизацииОСБухгалтерскийУчетСрезПоследних.СпособыОтраженияРасходовПоАмортизации = СпособыОтраженияРасходовПоАмортизацииСпособы.Ссылка
	|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Проекты КАК Проекты
	|			ПО (СпособыОтраженияРасходовПоАмортизацииСпособы.ПодразделениеОрганизации.КодПоОКТМО = Проекты.Код)
	|		ПО (СпособыОтраженияРасходовПоАмортизацииОСБухгалтерскийУчетСрезПоследних.ОсновноеСредство = ОсновныеСредства.Ссылка)
	|ГДЕ
	|	ОсновныеСредства.Ссылка = &ОсновноеСредство";
	
	Запрос.УстановитьПараметр ("ОсновноеСредство", ОсновноеСредство);
	Запрос.УстановитьПараметр ("Период", Период);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		Структура = Новый Структура;
		Структура.Вставить("ОсновноеСредство", ВыборкаДетальныеЗаписи.ОсновноеСредство);
		Структура.Вставить("ГруппаОС", ВыборкаДетальныеЗаписи.ГруппаОС);
		Структура.Вставить("ТипОС", ВыборкаДетальныеЗаписи.ТипОС);
		Структура.Вставить("Адрес", ВыборкаДетальныеЗаписи.Адрес);
		Структура.Вставить("СтатьяЗатрат", ВыборкаДетальныеЗаписи.СтатьяЗатрат);
		Структура.Вставить("НоменклатурнаяГруппа", ВыборкаДетальныеЗаписи.НоменклатурнаяГруппа);
		Структура.Вставить("Подразделение", ВыборкаДетальныеЗаписи.Подразделение);
		Структура.Вставить("ПодразделениеОрганизации", ВыборкаДетальныеЗаписи.ПодразделениеОрганизации);
		Структура.Вставить("Проект", ВыборкаДетальныеЗаписи.Проект);
		Структура.Вставить("СчетЗатрат", ВыборкаДетальныеЗаписи.СчетЗатрат);
	КонецЦикла;
	
	Возврат Структура;
	
КонецФункции // ПолучитьСпособОтраженияРасходовПоОС()

Процедура ПередЗакрытием(Отказ, СтандартнаяОбработка)
	
	Если СписокДокументов.Строки.Количество()>0 и Вопрос("Закрыть обработку?", РежимДиалогаВопрос.ДаНет) = КодВозвратаДиалога.Нет Тогда
		Отказ = Истина;	
	КонецЕсли;	
	
КонецПроцедуры

Функция СоздатьДокументПТУПоПроцентам(Строка)
	
	
	НовыйДок = Документы.ПоступлениеТоваровУслуг.СоздатьДокумент();
	НовыйДок.Дата = Строка.ДатаДокумента;
	
	НовыйДок.ВидПоступления = перечисления.ВидыПоступленияТоваров.НаСклад;
	НовыйДок.ВидОперации = перечисления.ВидыОперацийПоступлениеТоваровУслуг.ПокупкаКомиссия;
	НовыйДок.Организация = Справочники.Организации.НайтиПоКоду("000000001");
	НовыйДок.Контрагент = Строка.Контрагент;
	НовыйДок.ДоговорКонтрагента = Строка.Договор;
	НовыйДок.ОтражатьВБухгалтерскомУчете = Истина;
	НовыйДок.ОтражатьВНалоговомУчете = Истина;
	НовыйДок.ОтражатьВУправленческомУчете = Истина;
	НовыйДок.Ответственный = ПараметрыСеанса.ТекущийПользователь;
	НовыйДок.Комментарий = "Проценты по арендной плате";
	НовыйДок.СчетУчетаРасчетовСКонтрагентом = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.5"); 
	НовыйДок.СчетУчетаРасчетовПоАвансам = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.5");
	НовыйДок.ВалютаДокумента = Справочники.Валюты.НайтиПоКоду("643");
	НовыйДок.ТипЦен = Справочники.ТипыЦенНоменклатурыКонтрагентов.НайтиПоКоду("00001");
	НовыйДок.КурсВзаиморасчетов = 1;
	НовыйДок.КратностьВзаиморасчетов = 1;
	НовыйДок.Сделка = Строка.График;
	
	Для каждого СтрокаППА Из Строка.Строки Цикл
		СтруктураПараметровАмортизации =  ПолучитьСпособОтраженияРасходовПоОС(СтрокаППА.ОбъектППА, КонецМесяца(Строка.ДатаДокумента));
		НоваяСтрокаТЧ = Новыйдок.Услуги.Добавить();
		НоваяСтрокаТЧ.Номенклатура = Справочники.Номенклатура.НайтиПоКоду("00000007676"); 
		НоваяСтрокаТЧ.Количество = 1;
		НоваяСтрокаТЧ.Цена = СтрокаППА.Сумма;
		НоваяСтрокаТЧ.Сумма = СтрокаППА.Сумма;
		НоваяСтрокаТч.Подразделение = СтруктураПараметровАмортизации.Подразделение;
		НоваяСтрокаТч.Проект = СтруктураПараметровАмортизации.Проект;
		НоваяСтрокаТч.СтатьяЗатрат = Справочники.СтатьиЗатрат.НайтиПоКоду("990000024");
		НоваяСтрокаТч.Содержание = "Проценты по аренде. Инв№ " + СтрокаППА.ОбъектППА.Код;
		НоваяСтрокаТч.ДатаНач = НачалоПериода;
		НоваяСтрокаТч.ДатаКон = КонецПериода;
		НоваяСтрокаТч.СчетЗатрат = ПланыСчетов.Хозрасчетный.НайтиПоКоду("91.02.1");
		НоваяСтрокаТч.СчетЗатратНУ = ПланыСчетов.Налоговый.НайтиПоКоду("91.02.7");
		
		ПодразделениеОрганизации91 = Строка.График.СоставППА.Найти(СтрокаППА.ОбъектППА, "ОбъектППА").ПодразделениеОрганизации91;
		СтатьяПрочихДоходовИРасходов = Строка.График.СоставППА.Найти(СтрокаППА.ОбъектППА, "ОбъектППА").СтатьяПрочихДоходовИРасходов;
		
		НоваяСтрокаТч.ПодразделениеОрганизации = ПодразделениеОрганизации91;
		НоваяСтрокаТч.Субконто1 = СтатьяПрочихДоходовИРасходов;
		НоваяСтрокаТч.СубконтоНУ1 = СтатьяПрочихДоходовИРасходов;
		НоваяСтрокаТч.Субконто2 = ПодразделениеОрганизации91;
	КонецЦикла;  
	
	НовыйДок.Записать(РежимЗаписиДокумента.Запись);
	
	Возврат НовыйДок;	
	
КонецФункции      

Процедура ДействияФормыПровестиСозданныеДокументы(Кнопка)
	
	Если СписокДокументов.Строки.Количество() = 0 или Вопрос("Запустить проведение?", РежимДиалогаВопрос.ДаНет) = КодВозвратаДиалога.Нет Тогда 
		Возврат;
		Отказ = Истина;	
	КонецЕсли;
	
	Для каждого Строка Из СписокДокументов.Строки Цикл
		
		ЭлементыФормы.СписокДокументов.ТекущаяСтрока = Строка;
		
		Если НЕ ЗначениеЗаполнено(Строка.новыйДокумент) Тогда
			Продолжить;
		КонецЕсли; 
		
		Если Строка.НовыйДокумент.Проведен Тогда
			Продолжить;
		КонецЕсли; 
		
		Попытка
			Док = Строка.НовыйДокумент.ПолучитьОбъект();
			Док.Записать(РежимЗаписиДокумента.Проведение);
			Строка.Сообщение = "Проведен";
		Исключение
			ТекстСообщения = СтрШаблон("Ошибка проведения документа: строка №%1 от %2, %3, %4." + ОписаниеОшибки(), 
			Строка.Номер, 
			Строка.ДатаДокумента, 
			Строка.Контрагент, 
			Строка.Договор);
			Строка.Сообщение = ТекстСообщения;												
			Сообщить(ТекстСообщения);
		КонецПопытки;		
		ЭтаФорма.Обновить();
		
	КонецЦикла;
	
	Предупреждение("Завершено");
	
КонецПроцедуры
]

Отчет сверка данных
[ВЫБРАТЬ РАЗЛИЧНЫЕ
	_УчетДолгосрочнойАрендыОстатки.Договор,
	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
	ОКР(СУММА(_УчетДолгосрочнойАрендыОстатки.СтоимостьППА), 2) КАК СтоимостьППА
ПОМЕСТИТЬ ВТ_СписокОбъектовППА
ИЗ
	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки
ГДЕ
	_УчетДолгосрочнойАрендыОстатки.Период < КОНЕЦПЕРИОДА(&ДатаОтчета, ДЕНЬ)
	И _УчетДолгосрочнойАрендыОстатки.ПериодГрафика < КОНЕЦПЕРИОДА(&ДатаОтчета, ДЕНЬ)

СГРУППИРОВАТЬ ПО
	_УчетДолгосрочнойАрендыОстатки.Договор,
	_УчетДолгосрочнойАрендыОстатки.ОбъектППА

ИМЕЮЩИЕ
	ОКР(СУММА(_УчетДолгосрочнойАрендыОстатки.СтоимостьППА), 2) <> 0
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	1 КАК Порядок,
	ХозрасчетныйОстатки.Счет КАК ИсточникДанных,
	ХозрасчетныйОстатки.Субконто2 КАК Договор,
	"@Без детализации по ППА" КАК ОбъектППА,
	-ХозрасчетныйОстатки.СуммаОстаток КАК К76071
ПОМЕСТИТЬ ВТ_76071
ИЗ
	РегистрБухгалтерии.Хозрасчетный.Остатки(НАЧАЛОПЕРИОДА(ДОБАВИТЬКДАТЕ(&ДатаОтчета, ДЕНЬ, 1), ДЕНЬ), Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.АрендныеОбязательства), , ) КАК ХозрасчетныйОстатки
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	2 КАК Порядок,
	ХозрасчетныйОстатки.Счет КАК ИсточникДанных,
	ХозрасчетныйОстатки.Субконто2 КАК Договор,
	"@Без детализации по ППА" КАК ОбъектППА,
	ХозрасчетныйОстатки.СуммаОстаток КАК Д76075
ПОМЕСТИТЬ ВТ_76075
ИЗ
	РегистрБухгалтерии.Хозрасчетный.Остатки(НАЧАЛОПЕРИОДА(ДОБАВИТЬКДАТЕ(&ДатаОтчета, ДЕНЬ, 1), ДЕНЬ), Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПроцентыПоАренде), , ) КАК ХозрасчетныйОстатки
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	2 КАК Порядок,
	ХозрасчетныйОстатки.Счет КАК ИсточникДанных,
	ХозрасчетныйОстатки.Субконто2 КАК Договор,
	"@Без детализации по ППА" КАК ОбъектППА,
	ХозрасчетныйОстатки.СуммаОстаток КАК Д76073
ПОМЕСТИТЬ ВТ_76073
ИЗ
	РегистрБухгалтерии.Хозрасчетный.Остатки(НАЧАЛОПЕРИОДА(ДОБАВИТЬКДАТЕ(&ДатаОтчета, ДЕНЬ, 1), ДЕНЬ), Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.АвансыПоАренде), , ) КАК ХозрасчетныйОстатки
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	3 КАК Порядок,
	ХозрасчетныйОстатки.Счет КАК ИсточникДанных,
	ХозрасчетныйОстатки.Субконто2 КАК Договор,
	"@Без детализации по ППА" КАК ОбъектППА,
	ХозрасчетныйОстатки.СуммаОстаток КАК Д76079
ПОМЕСТИТЬ ВТ_76079
ИЗ
	РегистрБухгалтерии.Хозрасчетный.Остатки(НАЧАЛОПЕРИОДА(ДОБАВИТЬКДАТЕ(&ДатаОтчета, ДЕНЬ, 1), ДЕНЬ), Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.НДСпоАренднымОбязательствам), , ) КАК ХозрасчетныйОстатки
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	4 КАК Порядок,
	ХозрасчетныйОстатки.Счет КАК ИсточникДанных,
	ВТ_СписокОбъектовППА.Договор КАК Договор,
	ХозрасчетныйОстатки.Субконто1 КАК ОбъектППА,
	"@Без детализации по графику" КАК График,
	ХозрасчетныйОстатки.СуммаОстаток КАК Д0103
ПОМЕСТИТЬ ВТ_0103
ИЗ
	РегистрБухгалтерии.Хозрасчетный.Остатки(НАЧАЛОПЕРИОДА(ДОБАВИТЬКДАТЕ(&ДатаОтчета, ДЕНЬ, 1), ДЕНЬ), Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.АрендованноеИмущество), , ) КАК ХозрасчетныйОстатки
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СписокОбъектовППА КАК ВТ_СписокОбъектовППА
		ПО (ВТ_СписокОбъектовППА.ОбъектППА = ХозрасчетныйОстатки.Субконто1)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	5 КАК Порядок,
	ХозрасчетныйОстатки.Счет КАК ИсточникДанных,
	ВТ_СписокОбъектовППА.Договор КАК Договор,
	ХозрасчетныйОстатки.Субконто1 КАК ОбъектППА,
	"@Без детализации по графику" КАК График,
	-ХозрасчетныйОстатки.СуммаОстаток КАК К0203
ПОМЕСТИТЬ ВТ_0203
ИЗ
	РегистрБухгалтерии.Хозрасчетный.Остатки(НАЧАЛОПЕРИОДА(ДОБАВИТЬКДАТЕ(&ДатаОтчета, ДЕНЬ, 1), ДЕНЬ), Счет = ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.АмортизацияАрендованногоИмущества), , ) КАК ХозрасчетныйОстатки
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СписокОбъектовППА КАК ВТ_СписокОбъектовППА
		ПО (ВТ_СписокОбъектовППА.ОбъектППА = ХозрасчетныйОстатки.Субконто1)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	6 КАК Порядок,
	_УчетДолгосрочнойАрендыостатки.График КАК ИсточникДанных,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	ОКР(СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство), 2) КАК ДисконтированнокОбязательство
ПОМЕСТИТЬ ВТ_ДискОбязательство
ИЗ
	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
ГДЕ
	_УчетДолгосрочнойАрендыостатки.Период <= КОНЕЦПЕРИОДА(&ДатаОтчета, ДЕНЬ)
	И _УчетДолгосрочнойАрендыостатки.ПериодГрафика <= КОНЕЦПЕРИОДА(&ДатаОтчета, ДЕНЬ)

СГРУППИРОВАТЬ ПО
	_УчетДолгосрочнойАрендыостатки.График,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА

ИМЕЮЩИЕ
	СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) <> 0
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	6 КАК Порядок,
	_УчетДолгосрочнойАрендыостатки.График КАК ИсточникДанных,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) КАК Проценты
ПОМЕСТИТЬ ВТ_Проценты
ИЗ
	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
ГДЕ
	_УчетДолгосрочнойАрендыостатки.Период <= КОНЕЦПЕРИОДА(&ДатаОтчета, ДЕНЬ)
	И _УчетДолгосрочнойАрендыостатки.ПериодГрафика > КОНЕЦПЕРИОДА(&ДатаОтчета, ДЕНЬ)
	И _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)

СГРУППИРОВАТЬ ПО
	_УчетДолгосрочнойАрендыостатки.График,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА

ИМЕЮЩИЕ
	СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) <> 0
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	6 КАК Порядок,
	_УчетДолгосрочнойАрендыостатки.График КАК ИсточникДанных,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	СУММА(_УчетДолгосрочнойАрендыостатки.АвансОбязательство) КАК ОстатокАванса
ПОМЕСТИТЬ ВТ_ОстатокАванса
ИЗ
	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
ГДЕ
	_УчетДолгосрочнойАрендыостатки.Период <= КОНЕЦПЕРИОДА(&ДатаОтчета, ДЕНЬ)
	И _УчетДолгосрочнойАрендыостатки.ПериодГрафика <= КОНЕЦПЕРИОДА(&ДатаОтчета, ДЕНЬ)
	И (_УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ВыдачаАванса)
			ИЛИ _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ЗачетАванса))

СГРУППИРОВАТЬ ПО
	_УчетДолгосрочнойАрендыостатки.График,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА

ИМЕЮЩИЕ
	СУММА(_УчетДолгосрочнойАрендыостатки.АвансОбязательство) <> 0
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	6 КАК Порядок,
	_УчетДолгосрочнойАрендыостатки.График КАК ИсточникДанных,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	СУММА(_УчетДолгосрочнойАрендыостатки.АвансНДС) КАК ОстатокНДС_С_Аванса
ПОМЕСТИТЬ ВТ_ОстатокНДС_С_Аванса
ИЗ
	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
ГДЕ
	_УчетДолгосрочнойАрендыостатки.Период <= КОНЕЦПЕРИОДА(&ДатаОтчета, ДЕНЬ)
	И _УчетДолгосрочнойАрендыостатки.ПериодГрафика <= КОНЕЦПЕРИОДА(&ДатаОтчета, ДЕНЬ)
	И (_УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ВыдачаАванса)
			ИЛИ _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ЗачетАванса))

СГРУППИРОВАТЬ ПО
	_УчетДолгосрочнойАрендыостатки.График,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА

ИМЕЮЩИЕ
	СУММА(_УчетДолгосрочнойАрендыостатки.АвансОбязательство) <> 0
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	6 КАК Порядок,
	_УчетДолгосрочнойАрендыостатки.График КАК ИсточникДанных,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	СУММА(-_УчетДолгосрочнойАрендыостатки.НДС) КАК НДС
ПОМЕСТИТЬ ВТ_НДС
ИЗ
	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
ГДЕ
	_УчетДолгосрочнойАрендыостатки.Период <= КОНЕЦПЕРИОДА(&ДатаОтчета, ДЕНЬ)
	И _УчетДолгосрочнойАрендыостатки.ПериодГрафика > &ДатаОтчета
	И _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)

СГРУППИРОВАТЬ ПО
	_УчетДолгосрочнойАрендыостатки.График,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА

ИМЕЮЩИЕ
	СУММА(-_УчетДолгосрочнойАрендыостатки.НДС) <> 0
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	6 КАК Порядок,
	_УчетДолгосрочнойАрендыостатки.График КАК ИсточникДанных,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	СУММА(_УчетДолгосрочнойАрендыостатки.СтоимостьППА) КАК СтоимостьППА
ПОМЕСТИТЬ ВТ_СтоимостьППА
ИЗ
	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
ГДЕ
	_УчетДолгосрочнойАрендыостатки.Период <= КОНЕЦПЕРИОДА(&ДатаОтчета, ДЕНЬ)
	И _УчетДолгосрочнойАрендыостатки.ПериодГрафика <= КОНЕЦПЕРИОДА(&ДатаОтчета, ДЕНЬ)
	И _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)

СГРУППИРОВАТЬ ПО
	_УчетДолгосрочнойАрендыостатки.График,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА

ИМЕЮЩИЕ
	СУММА(-_УчетДолгосрочнойАрендыостатки.СтоимостьППА) <> 0
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	6 КАК Порядок,
	_УчетДолгосрочнойАрендыостатки.График КАК ИсточникДанных,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	СУММА(-_УчетДолгосрочнойАрендыостатки.СтоимостьППА) КАК НакопленнаяАмортизация
ПОМЕСТИТЬ ВТ_НакопленнаяАмортизация
ИЗ
	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
ГДЕ
	_УчетДолгосрочнойАрендыостатки.Период <= КОНЕЦПЕРИОДА(&ДатаОтчета, ДЕНЬ)
	И _УчетДолгосрочнойАрендыостатки.ПериодГрафика < КОНЕЦПЕРИОДА(&ДатаОтчета, ДЕНЬ)
	И _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.АмортизацияППА)

СГРУППИРОВАТЬ ПО
	_УчетДолгосрочнойАрендыостатки.График,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА

ИМЕЮЩИЕ
	СУММА(-_УчетДолгосрочнойАрендыостатки.СтоимостьППА) <> 0
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_76071.ИсточникДанных КАК ИсточникДанных,
	ВТ_76071.Договор,
	ВТ_76071.ОбъектППА,
	ВТ_76071.К76071,
	0 КАК Д76075,
	0 КАК Д76079,
	0 КАК Д0103,
	0 КАК К0203,
	0 КАК Проценты,
	0 КАК СтоимостьППА,
	0 КАК НакопленнаяАмортизация,
	0 КАК НДС,
	0 КАК ДисконтированнокОбязательство,
	ВТ_76071.Порядок,
	0 КАК ОстатокАванса,
	0 КАК ОстатокНДС_С_Аванса,
	0 КАК Д76073
ПОМЕСТИТЬ ВТ_Общая
ИЗ
	ВТ_76071 КАК ВТ_76071

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_76075.ИсточникДанных,
	ВТ_76075.Договор,
	ВТ_76075.ОбъектППА,
	0,
	ВТ_76075.Д76075,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	ВТ_76075.Порядок,
	0,
	0,
	0
ИЗ
	ВТ_76075 КАК ВТ_76075

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_76079.ИсточникДанных,
	ВТ_76079.Договор,
	ВТ_76079.ОбъектППА,
	0,
	0,
	ВТ_76079.Д76079,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	ВТ_76079.Порядок,
	0,
	0,
	0
ИЗ
	ВТ_76079 КАК ВТ_76079

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_0103.ИсточникДанных,
	ВТ_0103.Договор,
	ВТ_0103.ОбъектППА,
	0,
	0,
	0,
	ВТ_0103.Д0103,
	0,
	0,
	0,
	0,
	0,
	0,
	ВТ_0103.Порядок,
	0,
	0,
	0
ИЗ
	ВТ_0103 КАК ВТ_0103

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_0203.ИсточникДанных,
	ВТ_0203.Договор,
	ВТ_0203.ОбъектППА,
	0,
	0,
	0,
	0,
	ВТ_0203.К0203,
	0,
	0,
	0,
	0,
	0,
	ВТ_0203.Порядок,
	0,
	0,
	0
ИЗ
	ВТ_0203 КАК ВТ_0203

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_Проценты.ИсточникДанных,
	ВТ_Проценты.Договор,
	ВТ_Проценты.ОбъектППА,
	0,
	0,
	0,
	0,
	0,
	ВТ_Проценты.Проценты,
	0,
	0,
	0,
	0,
	ВТ_Проценты.Порядок,
	0,
	0,
	0
ИЗ
	ВТ_Проценты КАК ВТ_Проценты

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_СтоимостьППА.ИсточникДанных,
	ВТ_СтоимостьППА.Договор,
	ВТ_СтоимостьППА.ОбъектППА,
	0,
	0,
	0,
	0,
	0,
	0,
	ВТ_СтоимостьППА.СтоимостьППА,
	0,
	0,
	0,
	ВТ_СтоимостьППА.Порядок,
	0,
	0,
	0
ИЗ
	ВТ_СтоимостьППА КАК ВТ_СтоимостьППА

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_НакопленнаяАмортизация.ИсточникДанных,
	ВТ_НакопленнаяАмортизация.Договор,
	ВТ_НакопленнаяАмортизация.ОбъектППА,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	ВТ_НакопленнаяАмортизация.НакопленнаяАмортизация,
	0,
	0,
	ВТ_НакопленнаяАмортизация.Порядок,
	0,
	0,
	0
ИЗ
	ВТ_НакопленнаяАмортизация КАК ВТ_НакопленнаяАмортизация

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_НДС.ИсточникДанных,
	ВТ_НДС.Договор,
	ВТ_НДС.ОбъектППА,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	ВТ_НДС.НДС,
	0,
	ВТ_НДС.Порядок,
	0,
	0,
	0
ИЗ
	ВТ_НДС КАК ВТ_НДС

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_ДискОбязательство.ИсточникДанных,
	ВТ_ДискОбязательство.Договор,
	ВТ_ДискОбязательство.ОбъектППА,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	ВТ_ДискОбязательство.ДисконтированнокОбязательство,
	ВТ_ДискОбязательство.Порядок,
	0,
	0,
	0
ИЗ
	ВТ_ДискОбязательство КАК ВТ_ДискОбязательство

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_ОстатокАванса.ИсточникДанных,
	ВТ_ОстатокАванса.Договор,
	ВТ_ОстатокАванса.ОбъектППА,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	ВТ_ОстатокАванса.Порядок,
	ВТ_ОстатокАванса.ОстатокАванса,
	0,
	0
ИЗ
	ВТ_ОстатокАванса КАК ВТ_ОстатокАванса

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_ОстатокНДС_С_Аванса.ИсточникДанных,
	ВТ_ОстатокНДС_С_Аванса.Договор,
	ВТ_ОстатокНДС_С_Аванса.ОбъектППА,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	ВТ_ОстатокНДС_С_Аванса.Порядок,
	0,
	ВТ_ОстатокНДС_С_Аванса.ОстатокНДС_С_Аванса,
	0
ИЗ
	ВТ_ОстатокНДС_С_Аванса КАК ВТ_ОстатокНДС_С_Аванса

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_76073.ИсточникДанных,
	ВТ_76073.Договор,
	ВТ_76073.ОбъектППА,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	ВТ_76073.Порядок,
	0,
	0,
	ВТ_76073.Д76073
ИЗ
	ВТ_76073 КАК ВТ_76073
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Общая.ИсточникДанных,
	ВТ_Общая.Договор,
	ВТ_Общая.ОбъектППА,
	ВТ_Общая.К76071,
	ВТ_Общая.Д76075,
	ВТ_Общая.Д76079,
	ВТ_Общая.Д0103,
	ВТ_Общая.К0203,
	ВТ_Общая.Проценты,
	ВТ_Общая.СтоимостьППА,
	ВТ_Общая.НакопленнаяАмортизация,
	ВТ_Общая.НДС,
	ВТ_Общая.ДисконтированнокОбязательство,
	ВТ_Общая.ДисконтированнокОбязательство + ВТ_Общая.НДС + ВТ_Общая.Проценты КАК ПолноеОбязательство,
	ВТ_Общая.Порядок,
	ВТ_Общая.ОстатокАванса,
	ВТ_Общая.ОстатокНДС_С_Аванса,
	ВТ_Общая.Д76073
ПОМЕСТИТЬ ВТ_Итог
ИЗ
	ВТ_Общая КАК ВТ_Общая
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Итог.ИсточникДанных,
	ВТ_Итог.Договор,
	ВТ_Итог.ОбъектППА,
	ВТ_Итог.К76071,
	ВТ_Итог.Д76075,
	ВТ_Итог.Д76079,
	ВТ_Итог.Д0103,
	ВТ_Итог.К0203,
	ВТ_Итог.Проценты,
	ВТ_Итог.СтоимостьППА,
	ВТ_Итог.НакопленнаяАмортизация,
	ВТ_Итог.НДС,
	ВТ_Итог.ДисконтированнокОбязательство,
	ВТ_Итог.ПолноеОбязательство,
	ВТ_Итог.ПолноеОбязательство + ВТ_Итог.ОстатокАванса + ВТ_Итог.ОстатокНДС_С_Аванса - ВТ_Итог.К76071 КАК Откл76071,
	ВТ_Итог.Проценты - ВТ_Итог.Д76075 КАК Откл76075,
	ВТ_Итог.ОстатокАванса - ВТ_Итог.Д76073 КАК Откл76073,
	ВТ_Итог.НДС + ВТ_Итог.ОстатокНДС_С_Аванса - ВТ_Итог.Д76079 КАК Откл76079,
	ВТ_Итог.СтоимостьППА - ВТ_Итог.Д0103 КАК Откл0103,
	ВТ_Итог.НакопленнаяАмортизация - ВТ_Итог.К0203 КАК Откл0203,
	ВТ_Итог.Порядок,
	ВТ_Итог.ОстатокАванса,
	ВТ_Итог.ОстатокНДС_С_Аванса,
	ВТ_Итог.Д76073
ИЗ
	ВТ_Итог КАК ВТ_Итог]

Отчет анализ графика
[ВЫБРАТЬ
	НАЧАЛОПЕРИОДА(_УчетДолгосрочнойАрендыОбороты.Период, ДЕНЬ) КАК ПериодДень,
	_УчетДолгосрочнойАрендыОбороты.Период КАК Период,
	_УчетДолгосрочнойАрендыОбороты.Регистратор,
	_УчетДолгосрочнойАрендыОбороты.График,
	_УчетДолгосрочнойАрендыОбороты.Договор,
	_УчетДолгосрочнойАрендыОбороты.ОбъектППА,
	_УчетДолгосрочнойАрендыОбороты.ВидДвиженияГрафика,
	_УчетДолгосрочнойАрендыОбороты.Показатель,
	ВЫБОР
		КОГДА _УчетДолгосрочнойАрендыОбороты.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
				ИЛИ _УчетДолгосрочнойАрендыОбороты.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
				ИЛИ _УчетДолгосрочнойАрендыОбороты.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.КапитализацияАванса)
			ТОГДА _УчетДолгосрочнойАрендыОбороты.ПериодДисконтирования
		ИНАЧЕ _УчетДолгосрочнойАрендыОбороты.ПериодГрафика
	КОНЕЦ КАК ПериодГрафика,
	ВЫБОР
		КОГДА _УчетДолгосрочнойАрендыОбороты.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
				ИЛИ _УчетДолгосрочнойАрендыОбороты.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
				ИЛИ _УчетДолгосрочнойАрендыОбороты.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.КапитализацияАванса)
			ТОГДА _УчетДолгосрочнойАрендыОбороты.ПериодДисконтирования
		ИНАЧЕ "@"
	КОНЕЦ КАК ПериодДисконтирования,
	СУММА(_УчетДолгосрочнойАрендыОбороты.Обязательство) КАК Обязательство,
	СУММА(_УчетДолгосрочнойАрендыОбороты.СтоимостьППА) КАК СтоимостьППА,
	СУММА(_УчетДолгосрочнойАрендыОбороты.НДС) КАК НДС,
	СУММА(_УчетДолгосрочнойАрендыОбороты.АвансОбязательство) КАК АвансОбязательство,
	СУММА(_УчетДолгосрочнойАрендыОбороты.АвансАктив) КАК АвансАктив,
	СУММА(_УчетДолгосрочнойАрендыОбороты.АвансНДС) КАК АвансНДС
ПОМЕСТИТЬ ВТ_Данные
ИЗ
	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОбороты
ГДЕ
	ВЫБОР
			КОГДА &НачалоПериода <> ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА _УчетДолгосрочнойАрендыОбороты.Период >= НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
			ИНАЧЕ ИСТИНА
		КОНЕЦ
	И ВЫБОР
			КОГДА &КонецПериода <> ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА _УчетДолгосрочнойАрендыОбороты.Период <= КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
			ИНАЧЕ ИСТИНА
		КОНЕЦ
	И ВЫБОР
			КОГДА &ГраницаИтогов <> ДАТАВРЕМЯ(1, 1, 1)
				ТОГДА _УчетДолгосрочнойАрендыОбороты.ПериодГрафика <= КОНЕЦПЕРИОДА(&ГраницаИтогов, ДЕНЬ)
			ИНАЧЕ ИСТИНА
		КОНЕЦ
	И 
	(_УчетДолгосрочнойАрендыОбороты.Обязательство = 0
	ИЛИ _УчетДолгосрочнойАрендыОбороты.СтоимостьППА = 0
	ИЛИ _УчетДолгосрочнойАрендыОбороты.НДС = 0
	ИЛИ _УчетДолгосрочнойАрендыОбороты.АвансОбязательство = 0
	ИЛИ _УчетДолгосрочнойАрендыОбороты.АвансАктив = 0
	ИЛИ _УчетДолгосрочнойАрендыОбороты.АвансНДС = 0)

СГРУППИРОВАТЬ ПО
	_УчетДолгосрочнойАрендыОбороты.ОбъектППА,
	_УчетДолгосрочнойАрендыОбороты.Регистратор,
	НАЧАЛОПЕРИОДА(_УчетДолгосрочнойАрендыОбороты.Период, ДЕНЬ),
	_УчетДолгосрочнойАрендыОбороты.Период,
	_УчетДолгосрочнойАрендыОбороты.Показатель,
	ВЫБОР
		КОГДА _УчетДолгосрочнойАрендыОбороты.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
				ИЛИ _УчетДолгосрочнойАрендыОбороты.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
				ИЛИ _УчетДолгосрочнойАрендыОбороты.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.КапитализацияАванса)
			ТОГДА _УчетДолгосрочнойАрендыОбороты.ПериодДисконтирования
		ИНАЧЕ _УчетДолгосрочнойАрендыОбороты.ПериодГрафика
	КОНЕЦ,
	_УчетДолгосрочнойАрендыОбороты.Договор,
	_УчетДолгосрочнойАрендыОбороты.ВидДвиженияГрафика,
	_УчетДолгосрочнойАрендыОбороты.График,
	ВЫБОР
		КОГДА _УчетДолгосрочнойАрендыОбороты.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
				ИЛИ _УчетДолгосрочнойАрендыОбороты.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
				ИЛИ _УчетДолгосрочнойАрендыОбороты.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.КапитализацияАванса)
			ТОГДА _УчетДолгосрочнойАрендыОбороты.ПериодДисконтирования
		ИНАЧЕ "@"
	КОНЕЦ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Данные.ПериодДень,
	ВТ_Данные.Период,
	ВТ_Данные.Регистратор,
	ВТ_Данные.График,
	ВТ_Данные.Договор,
	ВТ_Данные.ОбъектППА,
	ВТ_Данные.ВидДвиженияГрафика,
	ВТ_Данные.Показатель,
	ВТ_Данные.ПериодГрафика,
	КОНЕЦПЕРИОДА(ВТ_Данные.ПериодГрафика, МЕСЯЦ) КАК ПериодГрафикаМесяц,
	ВТ_Данные.ПериодДисконтирования,
	ВТ_Данные.Обязательство,
	ВТ_Данные.СтоимостьППА,
	ВТ_Данные.НДС,
	ВТ_Данные.АвансОбязательство,
	ВТ_Данные.АвансАктив,
	ВТ_Данные.АвансНДС
ИЗ
	ВТ_Данные КАК ВТ_Данные
]

Классический график
[ВЫБРАТЬ
	ВЫБОР
		КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
				ИЛИ _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
			ТОГДА _УчетДолгосрочнойАрендыОстатки.График.ДатаНачала
		ИНАЧЕ _УчетДолгосрочнойАрендыОстатки.ПериодГрафика
	КОНЕЦ КАК Период,
	СУММА(ВЫБОР
			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
				ТОГДА _УчетДолгосрочнойАрендыОстатки.Обязательство
			ИНАЧЕ 0
		КОНЕЦ) КАК АрендныеПлатежи,
	0 КАК ПриведеннаяСтоимость,
	СУММА(ВЫБОР
			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
				ТОГДА _УчетДолгосрочнойАрендыОстатки.Обязательство
			ИНАЧЕ 0
		КОНЕЦ) КАК ОПС,
	СУММА(ВЫБОР
			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)
				ТОГДА _УчетДолгосрочнойАрендыОстатки.Обязательство
			ИНАЧЕ 0
		КОНЕЦ) КАК Проценты,
	СУММА(ВЫБОР
			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
				ТОГДА _УчетДолгосрочнойАрендыОстатки.СтоимостьППА
			ИНАЧЕ 0
		КОНЕЦ) КАК СтоимостьППА,
	СУММА(ВЫБОР
			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.АмортизацияППА)
				ТОГДА _УчетДолгосрочнойАрендыОстатки.СтоимостьППА
			ИНАЧЕ 0
		КОНЕЦ) КАК Амортизация,
	_УчетДолгосрочнойАрендыОстатки.График,
	_УчетДолгосрочнойАрендыОстатки.Договор,
	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
	_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика,
	_УчетДолгосрочнойАрендыОстатки.Показатель
ПОМЕСТИТЬ ВТ_ИсходныеДанные
ИЗ
	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки

СГРУППИРОВАТЬ ПО
	ВЫБОР
		КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
				ИЛИ _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
			ТОГДА _УчетДолгосрочнойАрендыОстатки.График.ДатаНачала
		ИНАЧЕ _УчетДолгосрочнойАрендыОстатки.ПериодГрафика
	КОНЕЦ,
	_УчетДолгосрочнойАрендыОстатки.График,
	_УчетДолгосрочнойАрендыОстатки.Договор,
	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
	_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика,
	_УчетДолгосрочнойАрендыОстатки.Показатель

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	_УчетДолгосрочнойАрендыОстатки.ПериодДисконтирования,
	0,
	СУММА(ВЫБОР
			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
				ТОГДА _УчетДолгосрочнойАрендыОстатки.Обязательство
			ИНАЧЕ 0
		КОНЕЦ),
	0,
	0,
	0,
	0,
	_УчетДолгосрочнойАрендыОстатки.График,
	_УчетДолгосрочнойАрендыОстатки.Договор,
	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
	_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика,
	_УчетДолгосрочнойАрендыОстатки.Показатель
ИЗ
	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки

СГРУППИРОВАТЬ ПО
	_УчетДолгосрочнойАрендыОстатки.ПериодДисконтирования,
	_УчетДолгосрочнойАрендыОстатки.График,
	_УчетДолгосрочнойАрендыОстатки.Договор,
	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
	_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика,
	_УчетДолгосрочнойАрендыОстатки.Показатель
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_ИсходныеДанныеДляДат.Период,
	ВТ_ИсходныеДанные.График,
	ВТ_ИсходныеДанные.Договор,
	ВТ_ИсходныеДанные.ОбъектППА,
	ВТ_ИсходныеДанные.ВидДвиженияГрафика,
	ВТ_ИсходныеДанные.Показатель
ПОМЕСТИТЬ ВТ_ВсеИзмеренияНаВсеДаты
ИЗ
	ВТ_ИсходныеДанные КАК ВТ_ИсходныеДанные,
	ВТ_ИсходныеДанные КАК ВТ_ИсходныеДанныеДляДат

СГРУППИРОВАТЬ ПО
	ВТ_ИсходныеДанныеДляДат.Период,
	ВТ_ИсходныеДанные.Показатель,
	ВТ_ИсходныеДанные.Договор,
	ВТ_ИсходныеДанные.ОбъектППА,
	ВТ_ИсходныеДанные.ВидДвиженияГрафика,
	ВТ_ИсходныеДанные.График
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_ИсходныеДанные.Период,
	СУММА(ВТ_ИсходныеДанные.АрендныеПлатежи) КАК АрендныеПлатежи,
	СУММА(ВТ_ИсходныеДанные.ПриведеннаяСтоимость) КАК ПриведеннаяСтоимость,
	СУММА(ВТ_ИсходныеДанные.ОПС) КАК ОПС,
	СУММА(ВТ_ИсходныеДанные.Проценты) КАК Проценты,
	СУММА(ВТ_ИсходныеДанные.СтоимостьППА) КАК СтоимостьППА,
	СУММА(ВТ_ИсходныеДанные.Амортизация) КАК Амортизация,
	ВТ_ИсходныеДанные.График,
	ВТ_ИсходныеДанные.Договор,
	ВТ_ИсходныеДанные.ОбъектППА,
	ВТ_ИсходныеДанные.ВидДвиженияГрафика,
	ВТ_ИсходныеДанные.Показатель
ПОМЕСТИТЬ ВТ_Данные
ИЗ
	ВТ_ИсходныеДанные КАК ВТ_ИсходныеДанные

СГРУППИРОВАТЬ ПО
	ВТ_ИсходныеДанные.Период,
	ВТ_ИсходныеДанные.График,
	ВТ_ИсходныеДанные.Договор,
	ВТ_ИсходныеДанные.ОбъектППА,
	ВТ_ИсходныеДанные.ВидДвиженияГрафика,
	ВТ_ИсходныеДанные.Показатель
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Данные.Период,
	ВТ_Данные.АрендныеПлатежи,
	ВТ_Данные.ПриведеннаяСтоимость,
	ВТ_Данные.ОПС,
	ВТ_Данные.Проценты,
	ВТ_Данные.СтоимостьППА,
	ВТ_Данные.Амортизация,
	ВТ_Данные.График,
	ВТ_Данные.Договор,
	ВТ_Данные.ОбъектППА,
	ВТ_Данные.ВидДвиженияГрафика,
	ВТ_Данные.Показатель
ПОМЕСТИТЬ ВТ_Обороты
ИЗ
	ВТ_Данные КАК ВТ_Данные
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Обороты.Период,
	СУММА(ЕСТЬNULL(ВТ_Обороты1.АрендныеПлатежи, 0)) КАК АрендныеПлатежи_НИ,
	СУММА(ЕСТЬNULL(ВТ_Обороты1.ПриведеннаяСтоимость, 0)) КАК ПриведеннаяСтоимость_НИ,
	СУММА(ЕСТЬNULL(ВТ_Обороты1.ОПС, 0)) КАК ОПС_НИ,
	СУММА(ЕСТЬNULL(ВТ_Обороты1.Проценты, 0)) КАК Проценты_НИ,
	СУММА(ЕСТЬNULL(ВТ_Обороты1.СтоимостьППА, 0)) КАК СтоимостьППА_НИ,
	СУММА(ЕСТЬNULL(ВТ_Обороты1.Амортизация, 0)) КАК Амортизация_НИ,
	ВТ_Обороты.График,
	ВТ_Обороты.Договор,
	ВТ_Обороты.ОбъектППА,
	ВТ_Обороты.ВидДвиженияГрафика,
	ВТ_Обороты.Показатель
ПОМЕСТИТЬ ВТ_НарастающийИтог
ИЗ
	ВТ_ВсеИзмеренияНаВсеДаты КАК ВТ_Обороты
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Обороты КАК ВТ_Обороты1
		ПО ВТ_Обороты.Период >= ВТ_Обороты1.Период
			И ВТ_Обороты.График = ВТ_Обороты1.График
			И ВТ_Обороты.Договор = ВТ_Обороты1.Договор
			И ВТ_Обороты.ОбъектППА = ВТ_Обороты1.ОбъектППА
			И ВТ_Обороты.ВидДвиженияГрафика = ВТ_Обороты1.ВидДвиженияГрафика
			И ВТ_Обороты.Показатель = ВТ_Обороты1.Показатель

СГРУППИРОВАТЬ ПО
	ВТ_Обороты.Период,
	ВТ_Обороты.График,
	ВТ_Обороты.Договор,
	ВТ_Обороты.ОбъектППА,
	ВТ_Обороты.ВидДвиженияГрафика,
	ВТ_Обороты.Показатель
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Обороты.Период,
	ВТ_Обороты.АрендныеПлатежи,
	ВТ_Обороты.ПриведеннаяСтоимость,
	ВТ_Обороты.ОПС,
	ВТ_Обороты.Проценты,
	ВТ_Обороты.СтоимостьППА,
	ВТ_Обороты.Амортизация,
	0 КАК АрендныеПлатежи_НИ,
	0 КАК ПриведеннаяСтоимость_НИ,
	0 КАК ОПС_НИ,
	0 КАК Проценты_НИ,
	0 КАК СтоимостьППА_НИ,
	0 КАК Амортизация_НИ,
	ВТ_Обороты.График,
	ВТ_Обороты.Договор,
	ВТ_Обороты.ОбъектППА,
	ВТ_Обороты.ВидДвиженияГрафика,
	ВТ_Обороты.Показатель
ПОМЕСТИТЬ ВТ_Общая
ИЗ
	ВТ_Обороты КАК ВТ_Обороты

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_НарастающийИтог.Период,
	0,
	0,
	0,
	0,
	0,
	0,
	ВТ_НарастающийИтог.АрендныеПлатежи_НИ,
	ВТ_НарастающийИтог.ПриведеннаяСтоимость_НИ,
	ВТ_НарастающийИтог.ОПС_НИ,
	ВТ_НарастающийИтог.Проценты_НИ,
	ВТ_НарастающийИтог.СтоимостьППА_НИ,
	ВТ_НарастающийИтог.Амортизация_НИ,
	ВТ_НарастающийИтог.График,
	ВТ_НарастающийИтог.Договор,
	ВТ_НарастающийИтог.ОбъектППА,
	ВТ_НарастающийИтог.ВидДвиженияГрафика,
	ВТ_НарастающийИтог.Показатель
ИЗ
	ВТ_НарастающийИтог КАК ВТ_НарастающийИтог
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Общая.Период,
	СУММА(ВТ_Общая.АрендныеПлатежи) КАК АрендныеПлатежи,
	СУММА(ВТ_Общая.ПриведеннаяСтоимость) КАК ПриведеннаяСтоимость,
	СУММА(ВТ_Общая.ОПС) КАК ОПС,
	СУММА(ВТ_Общая.Проценты) КАК Проценты,
	СУММА(ВТ_Общая.СтоимостьППА) КАК СтоимостьППА,
	СУММА(ВТ_Общая.Амортизация) КАК Амортизация,
	СУММА(ВТ_Общая.АрендныеПлатежи_НИ) КАК АрендныеПлатежи_НИ,
	СУММА(ВТ_Общая.ПриведеннаяСтоимость_НИ) КАК ПриведеннаяСтоимость_НИ,
	СУММА(ВТ_Общая.ОПС_НИ) КАК ОПС_НИ,
	СУММА(ВТ_Общая.Проценты_НИ) КАК Проценты_НИ,
	СУММА(ВТ_Общая.СтоимостьППА_НИ) КАК СтоимостьППА_НИ,
	СУММА(ВТ_Общая.Амортизация_НИ) КАК Амортизация_НИ,
	ВТ_Общая.График,
	ВТ_Общая.Договор,
	ВТ_Общая.ОбъектППА,
	ВТ_Общая.ВидДвиженияГрафика,
	ВТ_Общая.Показатель
ПОМЕСТИТЬ ВТ_Расчет
ИЗ
	ВТ_Общая КАК ВТ_Общая

СГРУППИРОВАТЬ ПО
	ВТ_Общая.Период,
	ВТ_Общая.График,
	ВТ_Общая.Договор,
	ВТ_Общая.ОбъектППА,
	ВТ_Общая.ВидДвиженияГрафика,
	ВТ_Общая.Показатель
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Расчет.Период,
	ВТ_Расчет.АрендныеПлатежи,
	ВТ_Расчет.ПриведеннаяСтоимость,
	ВТ_Расчет.Проценты,
	ВТ_Расчет.ОПС_НИ + ВТ_Расчет.АрендныеПлатежи_НИ + ВТ_Расчет.Проценты_НИ - (ВТ_Расчет.АрендныеПлатежи + ВТ_Расчет.Проценты) КАК ОбязательствоНаНачало,
	ВТ_Расчет.АрендныеПлатежи + ВТ_Расчет.Проценты КАК ИзменениеОбязательства,
	ВТ_Расчет.ОПС_НИ + ВТ_Расчет.АрендныеПлатежи_НИ + ВТ_Расчет.Проценты_НИ КАК ОбязательствоНаКонец,
	ВТ_Расчет.СтоимостьППА_НИ,
	ВТ_Расчет.Амортизация,
	ВТ_Расчет.Амортизация_НИ,
	ВТ_Расчет.СтоимостьППА_НИ + ВТ_Расчет.Амортизация_НИ КАК БалансоваяСтоимость,
	ВТ_Расчет.График,
	ВТ_Расчет.Договор,
	ВТ_Расчет.ОбъектППА,
	ВТ_Расчет.ВидДвиженияГрафика,
	ВТ_Расчет.Показатель
ПОМЕСТИТЬ ВТ_Расчет1
ИЗ
	ВТ_Расчет КАК ВТ_Расчет
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Расчет1.Период,
	СУММА(-Расчет2.ИзменениеОбязательства) КАК ККЗ,
	ВТ_Расчет1.График,
	ВТ_Расчет1.Договор,
	ВТ_Расчет1.ОбъектППА,
	ВТ_Расчет1.ВидДвиженияГрафика,
	ВТ_Расчет1.Показатель
ПОМЕСТИТЬ ВТ_РасчетКЧ
ИЗ
	ВТ_Расчет1 КАК ВТ_Расчет1
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Расчет1 КАК Расчет2
		ПО (Расчет2.Период МЕЖДУ ДОБАВИТЬКДАТЕ(ВТ_Расчет1.Период, СЕКУНДА, 1) И ДОБАВИТЬКДАТЕ(ВТ_Расчет1.Период, ГОД, 1))
			И ВТ_Расчет1.График = Расчет2.График
			И ВТ_Расчет1.Договор = Расчет2.Договор
			И ВТ_Расчет1.ОбъектППА = Расчет2.ОбъектППА
			И ВТ_Расчет1.ВидДвиженияГрафика = Расчет2.ВидДвиженияГрафика
			И ВТ_Расчет1.Показатель = Расчет2.Показатель

СГРУППИРОВАТЬ ПО
	ВТ_Расчет1.Период,
	ВТ_Расчет1.График,
	ВТ_Расчет1.Договор,
	ВТ_Расчет1.ОбъектППА,
	ВТ_Расчет1.ВидДвиженияГрафика,
	ВТ_Расчет1.Показатель
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Расчет1.Период,
	ВТ_Расчет1.АрендныеПлатежи,
	ВТ_Расчет1.ПриведеннаяСтоимость,
	ВТ_Расчет1.Проценты,
	ВТ_Расчет1.ОбязательствоНаНачало,
	ВТ_Расчет1.ИзменениеОбязательства,
	ВТ_Расчет1.ОбязательствоНаКонец,
	ВТ_Расчет1.СтоимостьППА_НИ,
	ВТ_Расчет1.Амортизация,
	ВТ_Расчет1.Амортизация_НИ,
	ВТ_Расчет1.БалансоваяСтоимость,
	0 КАК ККЗ,
	ВТ_Расчет1.График,
	ВТ_Расчет1.Договор,
	ВТ_Расчет1.ОбъектППА,
	ВТ_Расчет1.ВидДвиженияГрафика,
	ВТ_Расчет1.Показатель
ПОМЕСТИТЬ ВТ_Расчет2
ИЗ
	ВТ_Расчет1 КАК ВТ_Расчет1

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_РасчетКЧ.Период,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	ВТ_РасчетКЧ.ККЗ,
	ВТ_РасчетКЧ.График,
	ВТ_РасчетКЧ.Договор,
	ВТ_РасчетКЧ.ОбъектППА,
	ВТ_РасчетКЧ.ВидДвиженияГрафика,
	ВТ_РасчетКЧ.Показатель
ИЗ
	ВТ_РасчетКЧ КАК ВТ_РасчетКЧ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Расчет2.Период,
	СУММА(ВТ_Расчет2.АрендныеПлатежи) КАК АрендныеПлатежи,
	СУММА(ВТ_Расчет2.ПриведеннаяСтоимость) КАК ПриведеннаяСтоимость,
	СУММА(ВТ_Расчет2.Проценты) КАК Проценты,
	СУММА(ВТ_Расчет2.ОбязательствоНаНачало) КАК ОбязательствоНаНачало,
	СУММА(ВТ_Расчет2.ИзменениеОбязательства) КАК ИзменениеОбязательства,
	СУММА(ВТ_Расчет2.ОбязательствоНаКонец) КАК ОбязательствоНаКонец,
	СУММА(ВТ_Расчет2.СтоимостьППА_НИ) КАК СтоимостьППА_НИ,
	СУММА(ВТ_Расчет2.Амортизация) КАК Амортизация,
	СУММА(ВТ_Расчет2.Амортизация_НИ) КАК Амортизация_НИ,
	СУММА(ВТ_Расчет2.БалансоваяСтоимость) КАК БалансоваяСтоимость,
	СУММА(ВТ_Расчет2.ККЗ) КАК ККЗ,
	ВТ_Расчет2.График,
	ВТ_Расчет2.Договор,
	ВТ_Расчет2.ОбъектППА,
	ВТ_Расчет2.ВидДвиженияГрафика,
	ВТ_Расчет2.Показатель
ПОМЕСТИТЬ ВТ_Расчет3
ИЗ
	ВТ_Расчет2 КАК ВТ_Расчет2

СГРУППИРОВАТЬ ПО
	ВТ_Расчет2.Период,
	ВТ_Расчет2.График,
	ВТ_Расчет2.Договор,
	ВТ_Расчет2.ОбъектППА,
	ВТ_Расчет2.ВидДвиженияГрафика,
	ВТ_Расчет2.Показатель
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_расчет3.Период,
	ВТ_расчет3.АрендныеПлатежи,
	ВТ_расчет3.ПриведеннаяСтоимость,
	ВТ_расчет3.Проценты,
	ВТ_расчет3.ОбязательствоНаНачало,
	ВТ_расчет3.ОбязательствоНаКонец,
	ВТ_расчет3.ИзменениеОбязательства,
	ВТ_расчет3.ОбязательствоНаКонец - ВТ_расчет3.ККЗ КАК ДолгосрочнаяЧасть,
	ВТ_расчет3.ККЗ КАК КраткосрочнаяЧасть,
	ВТ_расчет3.СтоимостьППА_НИ КАК СтоимостьАктива,
	ВТ_расчет3.Амортизация,
	ВТ_расчет3.Амортизация_НИ КАК АмортизацияНакопленная,
	ВТ_расчет3.БалансоваяСтоимость,
	ВТ_расчет3.График,
	ВТ_расчет3.Договор,
	ВТ_расчет3.ОбъектППА,
	ВТ_расчет3.ВидДвиженияГрафика,
	ВТ_расчет3.Показатель
ИЗ
	ВТ_Расчет3 КАК ВТ_расчет3
ГДЕ 
//Период >= График.ДатаНачала
//и 
	(ВТ_расчет3.АрендныеПлатежи <> 0
			ИЛИ ВТ_расчет3.ПриведеннаяСтоимость <> 0
			ИЛИ ВТ_расчет3.Проценты <> 0
			ИЛИ ВТ_расчет3.ОбязательствоНаНачало <> 0
			ИЛИ ВТ_расчет3.ИзменениеОбязательства <> 0
			ИЛИ ВТ_расчет3.ОбязательствоНаКонец <> 0
			ИЛИ ВТ_расчет3.СтоимостьППА_НИ <> 0
			ИЛИ ВТ_расчет3.Амортизация <> 0
			ИЛИ ВТ_расчет3.Амортизация_НИ <> 0
			ИЛИ ВТ_расчет3.БалансоваяСтоимость <> 0
			ИЛИ ВТ_расчет3.ККЗ <> 0)]

Кредиторская задолженность по срокам погашения
[ВЫБРАТЬ
	_УчетДолгосрочнойАрендыОстатки.Договор,
	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
	_УчетДолгосрочнойАрендыОстатки.Показатель,
	_УчетДолгосрочнойАрендыОстатки.ПериодГрафика,
	СУММА(-_УчетДолгосрочнойАрендыОстатки.Обязательство) КАК КЗ
ПОМЕСТИТЬ ВТ_Данные
ИЗ
	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки
ГДЕ
	_УчетДолгосрочнойАрендыОстатки.Период <= КОНЕЦПЕРИОДА(&Период, ДЕНЬ)
	И _УчетДолгосрочнойАрендыОстатки.ПериодГрафика > КОНЕЦПЕРИОДА(&Период, ДЕНЬ)

СГРУППИРОВАТЬ ПО
	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
	_УчетДолгосрочнойАрендыОстатки.ПериодГрафика,
	_УчетДолгосрочнойАрендыОстатки.Договор,
	_УчетДолгосрочнойАрендыОстатки.Показатель   
Имеющие СУММА(ОКР(-_УчетДолгосрочнойАрендыОстатки.Обязательство, 2)) <> 0	
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Данные.Договор,
	ВТ_Данные.ОбъектППА,
	ВТ_Данные.Показатель,
	ВТ_Данные.ПериодГрафика,
	ВТ_Данные.КЗ КАК ОбязательствоНаКонец,
	ВЫБОР
		КОГДА ВТ_Данные.ПериодГрафика <= ДОБАВИТЬКДАТЕ(КОНЕЦПЕРИОДА(&Период, ДЕНЬ), ГОД, 1)
			ТОГДА ВТ_Данные.КЗ
		ИНАЧЕ 0
	КОНЕЦ КАК КраткосрочнаяЧасть,
	ВЫБОР
		КОГДА ВТ_Данные.ПериодГрафика > ДОБАВИТЬКДАТЕ(КОНЕЦПЕРИОДА(&Период, ДЕНЬ), ГОД, 1)
			ТОГДА ВТ_Данные.КЗ
		ИНАЧЕ 0
	КОНЕЦ КАК ДолгосрочнаяЧасть
ИЗ
	ВТ_Данные КАК ВТ_Данные]

сверка 01к
[ВЫБРАТЬ
	_УчетДолгосрочнойАрендыостатки.График,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	_УчетДолгосрочнойАрендыостатки.Показатель,
	СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) КАК ДисконтированнокОбязательство
ПОМЕСТИТЬ ВТ_ДискОбязательство
ИЗ
	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
ГДЕ
	_УчетДолгосрочнойАрендыостатки.Период <= КОНЕЦПЕРИОДА(&ОтчетнаяДата, ДЕНЬ)
	И _УчетДолгосрочнойАрендыостатки.ПериодГрафика <= НАЧАЛОПЕРИОДА(&ОтчетнаяДата, ДЕНЬ)

СГРУППИРОВАТЬ ПО
	_УчетДолгосрочнойАрендыостатки.График,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	_УчетДолгосрочнойАрендыостатки.Показатель
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	_УчетДолгосрочнойАрендыОстатки.Договор,
	_УчетДолгосрочнойАрендыОстатки.ОбъектППА
ПОМЕСТИТЬ ВТ_СписокППА
ИЗ
	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки
ГДЕ
	_УчетДолгосрочнойАрендыОстатки.Период < КОНЕЦПЕРИОДА(&ОтчетнаяДата, ДЕНЬ)
	И _УчетДолгосрочнойАрендыОстатки.ПериодГрафика < КОНЕЦПЕРИОДА(&ОтчетнаяДата, ДЕНЬ)

СГРУППИРОВАТЬ ПО
	_УчетДолгосрочнойАрендыОстатки.Договор,
	_УчетДолгосрочнойАрендыОстатки.ОбъектППА

ИМЕЮЩИЕ
	ОКР(СУММА(_УчетДолгосрочнойАрендыОстатки.СтоимостьППА), 2) <> 0
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	_УчетДолгосрочнойАрендыостатки.График,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	_УчетДолгосрочнойАрендыостатки.Показатель,
	СУММА(_УчетДолгосрочнойАрендыостатки.Обязательство) КАК Проценты
ПОМЕСТИТЬ ВТ_Проценты
ИЗ
	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
ГДЕ
	_УчетДолгосрочнойАрендыостатки.Период <= КОНЕЦПЕРИОДА(&ОтчетнаяДата, ДЕНЬ)
	И _УчетДолгосрочнойАрендыостатки.ПериодГрафика > КОНЕЦПЕРИОДА(&ОтчетнаяДата, ДЕНЬ)
	И _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)

СГРУППИРОВАТЬ ПО
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	_УчетДолгосрочнойАрендыостатки.Показатель,
	_УчетДолгосрочнойАрендыостатки.График
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	_УчетДолгосрочнойАрендыостатки.График,
	_УчетДолгосрочнойАрендыостатки.Договор,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	_УчетДолгосрочнойАрендыостатки.Показатель,
	СУММА(-_УчетДолгосрочнойАрендыостатки.НДС) КАК НДС
ПОМЕСТИТЬ ВТ_НДС
ИЗ
	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыостатки
ГДЕ
	_УчетДолгосрочнойАрендыостатки.Период <= КОНЕЦПЕРИОДА(&ОтчетнаяДата, ДЕНЬ)
	И _УчетДолгосрочнойАрендыостатки.ПериодГрафика > &ОтчетнаяДата
	И _УчетДолгосрочнойАрендыостатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)

СГРУППИРОВАТЬ ПО
	_УчетДолгосрочнойАрендыостатки.График,
	_УчетДолгосрочнойАрендыостатки.Показатель,
	_УчетДолгосрочнойАрендыостатки.ОбъектППА,
	_УчетДолгосрочнойАрендыостатки.Договор
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	НалоговыйОстатки.Счет,
	НалоговыйОстатки.Субконто1 КАК ОбъектППА,
	ВТ_СписокППА.Договор,
	НалоговыйОстатки.ВидУчета,
	НалоговыйОстатки.СуммаОстаток КАК Сальдо01К_НУ
ПОМЕСТИТЬ ОстаткиПоНУ
ИЗ
	РегистрБухгалтерии.Налоговый.Остатки(КОНЕЦПЕРИОДА(&ОтчетнаяДата, ДЕНЬ), Счет В ИЕРАРХИИ (&Счет01К), &СписокСубконто, ВидУчета = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаПоПБУ18.НУ)) КАК НалоговыйОстатки
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СписокППА КАК ВТ_СписокППА
		ПО (ВТ_СписокППА.ОбъектППА = НалоговыйОстатки.Субконто1)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	НалоговыйОстатки.Счет,
	НалоговыйОстатки.Субконто1 КАК ОбъектППА,
	ВТ_СписокППА.Договор,
	НалоговыйОстатки.ВидУчета,
	НалоговыйОстатки.СуммаОстаток КАК Сальдо01К_ВР
ПОМЕСТИТЬ ОстаткиПоВР
ИЗ
	РегистрБухгалтерии.Налоговый.Остатки(КОНЕЦПЕРИОДА(&ОтчетнаяДата, ДЕНЬ), Счет В ИЕРАРХИИ (&Счет01К), &СписокСубконто, ВидУчета = ЗНАЧЕНИЕ(Перечисление.ВидыУчетаПоПБУ18.ВР)) КАК НалоговыйОстатки
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СписокППА КАК ВТ_СписокППА
		ПО (ВТ_СписокППА.ОбъектППА = НалоговыйОстатки.Субконто1)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_ДискОбязательство.Договор,
	ВТ_ДискОбязательство.ОбъектППА,
	ВТ_ДискОбязательство.ДисконтированнокОбязательство,
	0 КАК НДС,
	0 КАК Проценты,
	0 КАК Сальдо01К_НУ,
	0 КАК Сальдо01К_ВР
ПОМЕСТИТЬ ВТ_Общая
ИЗ
	ВТ_ДискОбязательство КАК ВТ_ДискОбязательство

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_Проценты.Договор,
	ВТ_Проценты.ОбъектППА,
	0,
	0,
	ВТ_Проценты.Проценты,
	0,
	0
ИЗ
	ВТ_Проценты КАК ВТ_Проценты

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_НДС.Договор,
	ВТ_НДС.ОбъектППА,
	0,
	ВТ_НДС.НДС,
	0,
	0,
	0
ИЗ
	ВТ_НДС КАК ВТ_НДС

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ОстаткиПоНУ.Договор,
	ОстаткиПоНУ.ОбъектППА,
	0,
	0,
	0,
	ОстаткиПоНУ.Сальдо01К_НУ,
	0
ИЗ
	ОстаткиПоНУ КАК ОстаткиПоНУ

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ОстаткиПоВР.Договор,
	ОстаткиПоВР.ОбъектППА,
	0,
	0,
	0,
	0,
	ОстаткиПоВР.Сальдо01К_ВР
ИЗ
	ОстаткиПоВР КАК ОстаткиПоВР
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_общая.Договор,
	ВТ_общая.ОбъектППА,
	ВТ_общая.ДисконтированнокОбязательство,
	ВТ_общая.ДисконтированнокОбязательство + ВТ_общая.НДС + ВТ_общая.Проценты КАК ПолноеОбязательство,
	ВТ_общая.НДС,
	ВТ_общая.Проценты,
	ВТ_общая.Сальдо01К_НУ,
	ВТ_общая.ДисконтированнокОбязательство + ВТ_общая.Проценты - ВТ_общая.Сальдо01К_НУ КАК ОтклонениеПоНУ,
	ВТ_общая.Сальдо01К_ВР,
	-(ВТ_общая.ДисконтированнокОбязательство + ВТ_общая.Проценты + ВТ_общая.Сальдо01К_ВР) КАК ОтклонениеПоВР
ПОМЕСТИТЬ ВТ_Расчет
ИЗ
	ВТ_Общая КАК ВТ_общая
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Расчет.Договор,
	ВТ_Расчет.ОбъектППА,
	ВТ_Расчет.ДисконтированнокОбязательство,
	ВТ_Расчет.ПолноеОбязательство,
	ВТ_Расчет.НДС,
	ВТ_Расчет.Проценты,
	ВТ_Расчет.Сальдо01К_НУ,
	ВТ_Расчет.ОтклонениеПоНУ,
	ВТ_Расчет.Сальдо01К_ВР,
	ВТ_Расчет.ОтклонениеПоВР
ИЗ
	ВТ_Расчет КАК ВТ_Расчет
ГДЕ
	(ВТ_Расчет.ДисконтированнокОбязательство <> 0
			ИЛИ ВТ_Расчет.ПолноеОбязательство <> 0
			ИЛИ ВТ_Расчет.НДС <> 0
			ИЛИ ВТ_Расчет.Проценты <> 0
			ИЛИ ВТ_Расчет.Сальдо01К_НУ <> 0
			ИЛИ ВТ_Расчет.ОтклонениеПоНУ <> 0
			ИЛИ ВТ_Расчет.Сальдо01К_ВР <> 0
			ИЛИ ВТ_Расчет.ОтклонениеПоВР <> 0)]

Ведомость

[ВЫБРАТЬ
	_УчетДолгосрочнойАренды.Период,
	_УчетДолгосрочнойАренды.Регистратор,
	_УчетДолгосрочнойАренды.НомерСтроки,
	_УчетДолгосрочнойАренды.Активность,
	_УчетДолгосрочнойАренды.ИДСтроки,
	_УчетДолгосрочнойАренды.График,
	_УчетДолгосрочнойАренды.Договор,
	_УчетДолгосрочнойАренды.ОбъектППА,
	_УчетДолгосрочнойАренды.ВидДвиженияГрафика,
	_УчетДолгосрочнойАренды.Показатель,
	_УчетДолгосрочнойАренды.ПериодГрафика,
	_УчетДолгосрочнойАренды.ПериодДисконтирования,
	_УчетДолгосрочнойАренды.ВидОС,
	_УчетДолгосрочнойАренды.Обязательство,
	_УчетДолгосрочнойАренды.СтоимостьППА,
	_УчетДолгосрочнойАренды.НДС,
	_УчетДолгосрочнойАренды.СтавкаНДС,
	_УчетДолгосрочнойАренды.ДатаСобытия
ПОМЕСТИТЬ ВТ_ИсходныеДанные
ИЗ
	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАренды
//ГДЕ
//	_УчетДолгосрочнойАренды.Период <= КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
	//И _УчетДолгосрочнойАренды.Договор = &Договор
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	0 КАК Порядок,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
				ИЛИ ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
			ТОГДА ИсходныеДанные.ПериодДисконтирования
		ИНАЧЕ ИсходныеДанные.ПериодГрафика
	КОНЕЦ КАК Период,
	ИсходныеДанные.Договор,
	ИсходныеДанные.ОбъектППА,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
			ТОГДА ИсходныеДанные.СтоимостьППА
		ИНАЧЕ 0
	КОНЕЦ КАК СтоимостьППАНаНачало,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АмортизацияППА)
				И ИсходныеДанные.ПериодГрафика < НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.СтоимостьППА
		ИНАЧЕ 0
	КОНЕЦ КАК АмортизацияНакопленнаяНаНачало,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)
				И ИсходныеДанные.ПериодГрафика >= НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
			ТОГДА ИсходныеДанные.Обязательство
		ИНАЧЕ 0
	КОНЕЦ КАК ПроцентыОстатокНаНачало,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
				И ИсходныеДанные.ПериодГрафика >= НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.Обязательство
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)
				И ИсходныеДанные.ПериодГрафика >= НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.Обязательство
		ИНАЧЕ 0
	КОНЕЦ КАК ОбязательствоДисконтированноеНаНачало,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
				И ИсходныеДанные.ПериодГрафика >= НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.Обязательство - ИсходныеДанные.НДС
		ИНАЧЕ 0
	КОНЕЦ КАК ОбязательствоПолноеНаНачало,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
				И ИсходныеДанные.ПериодГрафика >= НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.НДС
		ИНАЧЕ 0
	КОНЕЦ КАК НДСНаНачало
ПОМЕСТИТЬ ВТ_НаНачало
ИЗ
	ВТ_ИсходныеДанные КАК ИсходныеДанные
ГДЕ
	ИсходныеДанные.Период < НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	0 КАК Порядок,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
				ИЛИ ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
			ТОГДА ИсходныеДанные.ПериодДисконтирования
		ИНАЧЕ ИсходныеДанные.ПериодГрафика
	КОНЕЦ КАК Период,
	ИсходныеДанные.Договор,
	ИсходныеДанные.ОбъектППА,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
			ТОГДА ИсходныеДанные.СтоимостьППА
		ИНАЧЕ 0
	КОНЕЦ КАК СтоимостьППАНаКонец,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АмортизацияППА)
				И ИсходныеДанные.ПериодГрафика < КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.СтоимостьППА
		ИНАЧЕ 0
	КОНЕЦ КАК АмортизацияНакопленнаяНаКонец,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)
				И ИсходныеДанные.ПериодГрафика >= КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
			ТОГДА ИсходныеДанные.Обязательство
		ИНАЧЕ 0
	КОНЕЦ КАК ПроцентыОстатокНаКонец,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
				И ИсходныеДанные.ПериодГрафика >= КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.Обязательство
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)
				И ИсходныеДанные.ПериодГрафика >= КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.Обязательство
		ИНАЧЕ 0
	КОНЕЦ КАК ОбязательствоДисконтированноеНаКонец,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
				И ИсходныеДанные.ПериодГрафика >= КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.Обязательство - ИсходныеДанные.НДС
		ИНАЧЕ 0
	КОНЕЦ КАК ОбязательствоПолноеНаКонец,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
				И ИсходныеДанные.ПериодГрафика >= КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.НДС
		ИНАЧЕ 0
	КОНЕЦ КАК НДСНаКонец
ПОМЕСТИТЬ ВТ_НаКонец
ИЗ
	ВТ_ИсходныеДанные КАК ИсходныеДанные
ГДЕ
	ИсходныеДанные.Период <= КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	0 КАК Порядок,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
				ИЛИ ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
			ТОГДА ИсходныеДанные.ПериодДисконтирования
		ИНАЧЕ ИсходныеДанные.ПериодГрафика
	КОНЕЦ КАК Период,
	ИсходныеДанные.Договор,
	ИсходныеДанные.ОбъектППА,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АмортизацияППА)
			ТОГДА -ИсходныеДанные.СтоимостьППА
		ИНАЧЕ 0
	КОНЕЦ КАК АмортизацияЗаПериод,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)
			ТОГДА ИсходныеДанные.Обязательство
		ИНАЧЕ 0
	КОНЕЦ КАК ПроцентыЗаПериод,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
			ТОГДА -ИсходныеДанные.Обязательство
		ИНАЧЕ 0
	КОНЕЦ КАК АрендныеПлатежиЗаПериод,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
			ТОГДА -ИсходныеДанные.НДС
		ИНАЧЕ 0
	КОНЕЦ КАК НДСЗаПериод
ПОМЕСТИТЬ ВТ_НачисленияЗаПериод
ИЗ
	ВТ_ИсходныеДанные КАК ИсходныеДанные
ГДЕ
	(ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
			ИЛИ ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АмортизацияППА)
			ИЛИ ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты))
	И ИсходныеДанные.ПериодГрафика МЕЖДУ НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ) И КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
	И ИсходныеДанные.Период <= КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
	И НЕ(ИсходныеДанные.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Выбытие)
				И ИсходныеДанные.ДатаСобытия >= ИсходныеДанные.ПериодГрафика)   

//Итоги сумма(АмортизацияЗаПериод), сумма(ПроцентыЗаПериод), сумма (АрендныеПлатежиЗаПериод) по ОбъектППА				
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	0 КАК Порядок,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
				ИЛИ ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
			ТОГДА ИсходныеДанные.ПериодДисконтирования
		ИНАЧЕ ИсходныеДанные.ПериодГрафика
	КОНЕЦ КАК Период,
	ИсходныеДанные.Договор,
	ИсходныеДанные.ОбъектППА,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
			ТОГДА ИсходныеДанные.СтоимостьППА
		ИНАЧЕ 0
	КОНЕЦ КАК СтоимостьППАИзменение,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АмортизацияППА)
				И ИсходныеДанные.ПериодГрафика <= КОНЕЦПЕРИОДА(ИсходныеДанные.Регистратор.Дата, ДЕНЬ)
			ТОГДА -ИсходныеДанные.СтоимостьППА
		ИНАЧЕ 0
	КОНЕЦ КАК АмортизацияНакопленнаяИзменение,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
				И ИсходныеДанные.ПериодГрафика >= НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.Обязательство
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)
				И ИсходныеДанные.ПериодГрафика >= НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.Обязательство
		ИНАЧЕ 0
	КОНЕЦ КАК ОбщаяПриведеннаяСтоимостьИзменение,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
				И ИсходныеДанные.ПериодГрафика >= НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.Обязательство - ИсходныеДанные.НДС
		ИНАЧЕ 0
	КОНЕЦ КАК ОбязательствоПолноеИзменение,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)
				И ИсходныеДанные.ПериодГрафика >= НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
			ТОГДА ИсходныеДанные.Обязательство
		ИНАЧЕ 0
	КОНЕЦ КАК ПроцентыИзменение,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
				И ИсходныеДанные.ПериодГрафика >= НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.НДС
		ИНАЧЕ 0
	КОНЕЦ КАК НДСИзменение
ПОМЕСТИТЬ ВТ_ИзмененияДоговоровЗаПериод
ИЗ
	ВТ_ИсходныеДанные КАК ИсходныеДанные
ГДЕ
	ИсходныеДанные.Период МЕЖДУ НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ) И КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
	И (ИсходныеДанные.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Начисление)
			ИЛИ ИсходныеДанные.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Сторно)
			ИЛИ ИсходныеДанные.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Корректировка))
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	0 КАК Порядок,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
				ИЛИ ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
			ТОГДА ИсходныеДанные.ПериодДисконтирования
		ИНАЧЕ ИсходныеДанные.ПериодГрафика
	КОНЕЦ КАК Период,
	ИсходныеДанные.Договор,
	ИсходныеДанные.ОбъектППА,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
			ТОГДА ИсходныеДанные.СтоимостьППА
		ИНАЧЕ 0
	КОНЕЦ КАК СтоимостьППАПоступление,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АмортизацияППА)
				И ИсходныеДанные.ПериодГрафика <= КОНЕЦПЕРИОДА(ИсходныеДанные.Регистратор.Дата, ДЕНЬ)
			ТОГДА -ИсходныеДанные.СтоимостьППА
		ИНАЧЕ 0
	КОНЕЦ КАК АмортизацияНакопленнаяПоступление,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
				И ИсходныеДанные.ПериодГрафика >= НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.Обязательство
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)
				И ИсходныеДанные.ПериодГрафика >= НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.Обязательство
		ИНАЧЕ 0
	КОНЕЦ КАК ОбщаяПриведеннаяСтоимостьПоступление,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
				И ИсходныеДанные.ПериодГрафика >= НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.Обязательство - ИсходныеДанные.НДС
		ИНАЧЕ 0
	КОНЕЦ КАК ОбязательствоПолноеПоступление,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)
				И ИсходныеДанные.ПериодГрафика >= НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
			ТОГДА ИсходныеДанные.Обязательство
		ИНАЧЕ 0
	КОНЕЦ КАК ПроцентыПоступление,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
				И ИсходныеДанные.ПериодГрафика >= НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ)
			ТОГДА -ИсходныеДанные.НДС
		ИНАЧЕ 0
	КОНЕЦ КАК НДСПоступление
ПОМЕСТИТЬ ВТ_ПоступлениеЗаПериод
ИЗ
	ВТ_ИсходныеДанные КАК ИсходныеДанные
ГДЕ
	ИсходныеДанные.Период МЕЖДУ НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ) И КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
	И ИсходныеДанные.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Поступление)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	0 КАК Порядок,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
				ИЛИ ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.ПриведеннаяСтоимость)
			ТОГДА ИсходныеДанные.ПериодДисконтирования
		ИНАЧЕ ИсходныеДанные.ПериодГрафика
	КОНЕЦ КАК Период,
	ИсходныеДанные.Договор,
	ИсходныеДанные.ОбъектППА,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.СтоимостьППА)
			ТОГДА ИсходныеДанные.СтоимостьППА
		ИНАЧЕ 0
	КОНЕЦ КАК СтоимостьППАВыбытие,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АмортизацияППА)
				И ИсходныеДанные.ПериодГрафика <= ИсходныеДанные.ДатаСобытия
			ТОГДА -ИсходныеДанные.СтоимостьППА
		ИНАЧЕ 0
	КОНЕЦ КАК АмортизацияНакопленнаяВыбытие,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
				И ИсходныеДанные.ПериодГрафика >= ИсходныеДанные.ДатаСобытия
			ТОГДА -ИсходныеДанные.Обязательство
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)
				И ИсходныеДанные.ПериодГрафика >= ИсходныеДанные.ДатаСобытия
			ТОГДА -ИсходныеДанные.Обязательство
		ИНАЧЕ 0
	КОНЕЦ КАК ОбщаяПриведеннаяСтоимостьВыбытие,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
				И ИсходныеДанные.ПериодГрафика >= ИсходныеДанные.ДатаСобытия
			ТОГДА -ИсходныеДанные.Обязательство - ИсходныеДанные.НДС
		ИНАЧЕ 0
	КОНЕЦ КАК ОбязательствоПолноеВыбытие,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)
				И ИсходныеДанные.ПериодГрафика >= ИсходныеДанные.ДатаСобытия
			ТОГДА ИсходныеДанные.Обязательство
		ИНАЧЕ 0
	КОНЕЦ КАК ПроцентыВыбытие,
	ВЫБОР
		КОГДА ИсходныеДанные.Показатель = ЗНАЧЕНИЕ(перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
				И ИсходныеДанные.ПериодГрафика >= ИсходныеДанные.ДатаСобытия
			ТОГДА -ИсходныеДанные.НДС
		ИНАЧЕ 0
	КОНЕЦ КАК НДСВыбытие
ПОМЕСТИТЬ ВТ_ВыбытиеЗаПериод
ИЗ
	ВТ_ИсходныеДанные КАК ИсходныеДанные
ГДЕ
	ИсходныеДанные.Период МЕЖДУ НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ) И КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
	И ИсходныеДанные.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Выбытие)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_НаНачало.Порядок,
	ВТ_НаНачало.Период,
	ВТ_НаНачало.Договор,
	ВТ_НаНачало.ОбъектППА,
	ВТ_НаНачало.СтоимостьППАНаНачало,
	ВТ_НаНачало.АмортизацияНакопленнаяНаНачало,
	ВТ_НаНачало.ПроцентыОстатокНаНачало,
	ВТ_НаНачало.ОбязательствоДисконтированноеНаНачало,
	ВТ_НаНачало.ОбязательствоПолноеНаНачало,
	ВТ_НаНачало.НДСНаНачало,
	0 КАК СтоимостьППАНаКонец,
	0 КАК АмортизацияНакопленнаяНаКонец,
	0 КАК ПроцентыОстатокНаКонец,
	0 КАК ОбязательствоДисконтированноеНаКонец,
	0 КАК ОбязательствоПолноеНаКонец,
	0 КАК НДСНаКонец,
	0 КАК АмортизацияЗаПериод,
	0 КАК ПроцентыЗаПериод,
	0 КАК АрендныеПлатежиЗаПериод,
	0 КАК НДСЗаПериод,
	0 КАК СтоимостьППАИзменение,
	0 КАК АмортизацияНакопленнаяИзменение,
	0 КАК ОбщаяПриведеннаяСтоимостьИзменение,
	0 КАК ОбязательствоПолноеИзменение,
	0 КАК ПроцентыИзменение,
	0 КАК НДСИзменение,
	0 КАК СтоимостьППАПоступление,
	0 КАК АмортизацияНакопленнаяПоступление,
	0 КАК ОбщаяПриведеннаяСтоимостьПоступление,
	0 КАК ОбязательствоПолноеПоступление,
	0 КАК ПроцентыПоступление,
	0 КАК НДСПоступление,
	0 КАК СтоимостьППАВыбытие,
	0 КАК АмортизацияНакопленнаяВыбытие,
	0 КАК ОбщаяПриведеннаяСтоимостьВыбытие,
	0 КАК ОбязательствоПолноеВыбытие,
	0 КАК ПроцентыВыбытие,
	0 КАК НДСВыбытие
ПОМЕСТИТЬ ВТ_Общая
ИЗ
	ВТ_НаНачало КАК ВТ_НаНачало

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_НаКонец.Порядок,
	ВТ_НаКонец.Период,
	ВТ_НаКонец.Договор,
	ВТ_НаКонец.ОбъектППА,
	0,
	0,
	0,
	0,
	0,
	0,
	ВТ_НаКонец.СтоимостьППАНаКонец,
	ВТ_НаКонец.АмортизацияНакопленнаяНаКонец,
	ВТ_НаКонец.ПроцентыОстатокНаКонец,
	ВТ_НаКонец.ОбязательствоДисконтированноеНаКонец,
	ВТ_НаКонец.ОбязательствоПолноеНаКонец,
	ВТ_НаКонец.НДСНаКонец,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0
ИЗ
	ВТ_НаКонец КАК ВТ_НаКонец

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_НачисленияЗаПериод.Порядок,
	ВТ_НачисленияЗаПериод.Период,
	ВТ_НачисленияЗаПериод.Договор,
	ВТ_НачисленияЗаПериод.ОбъектППА,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	ВТ_НачисленияЗаПериод.АмортизацияЗаПериод,
	ВТ_НачисленияЗаПериод.ПроцентыЗаПериод,
	ВТ_НачисленияЗаПериод.АрендныеПлатежиЗаПериод,
	ВТ_НачисленияЗаПериод.НДСЗаПериод,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0
ИЗ
	ВТ_НачисленияЗаПериод КАК ВТ_НачисленияЗаПериод

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_ИзмененияДоговоровЗаПериод.Порядок,
	ВТ_ИзмененияДоговоровЗаПериод.Период,
	ВТ_ИзмененияДоговоровЗаПериод.Договор,
	ВТ_ИзмененияДоговоровЗаПериод.ОбъектППА,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	ВТ_ИзмененияДоговоровЗаПериод.СтоимостьППАИзменение,
	ВТ_ИзмененияДоговоровЗаПериод.АмортизацияНакопленнаяИзменение,
	ВТ_ИзмененияДоговоровЗаПериод.ОбщаяПриведеннаяСтоимостьИзменение,
	ВТ_ИзмененияДоговоровЗаПериод.ОбязательствоПолноеИзменение,
	ВТ_ИзмененияДоговоровЗаПериод.ПроцентыИзменение,
	ВТ_ИзмененияДоговоровЗаПериод.НДСИзменение,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0
ИЗ
	ВТ_ИзмененияДоговоровЗаПериод КАК ВТ_ИзмененияДоговоровЗаПериод

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_ПоступлениеЗаПериод.Порядок,
	ВТ_ПоступлениеЗаПериод.Период,
	ВТ_ПоступлениеЗаПериод.Договор,
	ВТ_ПоступлениеЗаПериод.ОбъектППА,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	ВТ_ПоступлениеЗаПериод.СтоимостьППАПоступление,
	ВТ_ПоступлениеЗаПериод.АмортизацияНакопленнаяПоступление,
	ВТ_ПоступлениеЗаПериод.ОбщаяПриведеннаяСтоимостьПоступление,
	ВТ_ПоступлениеЗаПериод.ОбязательствоПолноеПоступление,
	ВТ_ПоступлениеЗаПериод.ПроцентыПоступление,
	ВТ_ПоступлениеЗаПериод.НДСПоступление,
	0,
	0,
	0,
	0,
	0,
	0
ИЗ
	ВТ_ПоступлениеЗаПериод КАК ВТ_ПоступлениеЗаПериод

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВТ_ВыбытиеЗаПериод.Порядок,
	ВТ_ВыбытиеЗаПериод.Период,
	ВТ_ВыбытиеЗаПериод.Договор,
	ВТ_ВыбытиеЗаПериод.ОбъектППА,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	0,
	ВТ_ВыбытиеЗаПериод.СтоимостьППАВыбытие,
	ВТ_ВыбытиеЗаПериод.АмортизацияНакопленнаяВыбытие,
	ВТ_ВыбытиеЗаПериод.ОбщаяПриведеннаяСтоимостьВыбытие,
	ВТ_ВыбытиеЗаПериод.ОбязательствоПолноеВыбытие,
	ВТ_ВыбытиеЗаПериод.ПроцентыВыбытие,
	ВТ_ВыбытиеЗаПериод.НДСВыбытие
ИЗ
	ВТ_ВыбытиеЗаПериод КАК ВТ_ВыбытиеЗаПериод
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Общая.Порядок,
	ВТ_Общая.Период,
	ВТ_Общая.Договор,
	ВТ_Общая.ОбъектППА,
	СУММА(ВТ_Общая.СтоимостьППАНаНачало) КАК СтоимостьППАНаНачало,
	СУММА(ВТ_Общая.АмортизацияНакопленнаяНаНачало) КАК АмортизацияНакопленнаяНаНачало,
	СУММА(ВТ_Общая.ПроцентыОстатокНаНачало) КАК ПроцентыОстатокНаНачало,
	СУММА(ВТ_Общая.ОбязательствоДисконтированноеНаНачало) КАК ОбязательствоДисконтированноеНаНачало,
	СУММА(ВТ_Общая.ОбязательствоПолноеНаНачало) КАК ОбязательствоПолноеНаНачало,
	СУММА(ВТ_Общая.НДСНаНачало) КАК НДСНаНачало,
	СУММА(ВТ_Общая.СтоимостьППАНаКонец) КАК СтоимостьППАНаКонец,
	СУММА(ВТ_Общая.АмортизацияНакопленнаяНаКонец) КАК АмортизацияНакопленнаяНаКонец,
	СУММА(ВТ_Общая.ПроцентыОстатокНаКонец) КАК ПроцентыОстатокНаКонец,
	СУММА(ВТ_Общая.ОбязательствоДисконтированноеНаКонец) КАК ОбязательствоДисконтированноеНаКонец,
	СУММА(ВТ_Общая.ОбязательствоПолноеНаКонец) КАК ОбязательствоПолноеНаКонец,
	СУММА(ВТ_Общая.НДСНаКонец) КАК НДСНаКонец,
	СУММА(ВТ_Общая.АмортизацияЗаПериод) КАК АмортизацияЗаПериод,
	СУММА(ВТ_Общая.ПроцентыЗаПериод) КАК ПроцентыЗаПериод,
	СУММА(ВТ_Общая.АрендныеПлатежиЗаПериод) КАК АрендныеПлатежиЗаПериод,
	СУММА(ВТ_Общая.НДСЗаПериод) КАК НДСЗаПериод,
	СУММА(ВТ_Общая.СтоимостьППАИзменение) КАК СтоимостьППАИзменение,
	СУММА(ВТ_Общая.АмортизацияНакопленнаяИзменение) КАК АмортизацияНакопленнаяИзменение,
	СУММА(ВТ_Общая.ОбщаяПриведеннаяСтоимостьИзменение) КАК ОбщаяПриведеннаяСтоимостьИзменение,
	СУММА(ВТ_Общая.ОбязательствоПолноеИзменение) КАК ОбязательствоПолноеИзменение,
	СУММА(ВТ_Общая.ПроцентыИзменение) КАК ПроцентыИзменение,
	СУММА(ВТ_Общая.НДСИзменение) КАК НДСИзменение,
	СУММА(ВТ_Общая.СтоимостьППАПоступление) КАК СтоимостьППАПоступление,
	СУММА(ВТ_Общая.АмортизацияНакопленнаяПоступление) КАК АмортизацияНакопленнаяПоступление,
	СУММА(ВТ_Общая.ОбщаяПриведеннаяСтоимостьПоступление) КАК ОбщаяПриведеннаяСтоимостьПоступление,
	СУММА(ВТ_Общая.ОбязательствоПолноеПоступление) КАК ОбязательствоПолноеПоступление,
	СУММА(ВТ_Общая.ПроцентыПоступление) КАК ПроцентыПоступление,
	СУММА(ВТ_Общая.НДСПоступление) КАК НДСПоступление,
	СУММА(ВТ_Общая.СтоимостьППАВыбытие) КАК СтоимостьППАВыбытие,
	СУММА(ВТ_Общая.АмортизацияНакопленнаяВыбытие) КАК АмортизацияНакопленнаяВыбытие,
	СУММА(ВТ_Общая.ОбщаяПриведеннаяСтоимостьВыбытие) КАК ОбщаяПриведеннаяСтоимостьВыбытие,
	СУММА(ВТ_Общая.ОбязательствоПолноеВыбытие) КАК ОбязательствоПолноеВыбытие,
	СУММА(ВТ_Общая.ПроцентыВыбытие) КАК ПроцентыВыбытие,
	СУММА(ВТ_Общая.НДСВыбытие) КАК НДСВыбытие
ПОМЕСТИТЬ ВТ_Группировка
ИЗ
	ВТ_Общая КАК ВТ_Общая

СГРУППИРОВАТЬ ПО
	ВТ_Общая.ОбъектППА,
	ВТ_Общая.Период,
	ВТ_Общая.Договор,
	ВТ_Общая.Порядок
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Группировка.Порядок,
	ВТ_Группировка.Период, 
	НачалоПериода(ВТ_Группировка.Период, Месяц) как Месяц, 
	ВТ_Группировка.Договор,
	ВТ_Группировка.ОбъектППА,
	ВТ_Группировка.СтоимостьППАНаНачало,
	ВТ_Группировка.АмортизацияНакопленнаяНаНачало,
	ВТ_Группировка.ПроцентыОстатокНаНачало,
	ВТ_Группировка.ОбязательствоДисконтированноеНаНачало,
	ВТ_Группировка.ОбязательствоПолноеНаНачало,
	ВТ_Группировка.НДСНаНачало,
	ВТ_Группировка.СтоимостьППАНаКонец,
	ВТ_Группировка.АмортизацияНакопленнаяНаКонец,
	ВТ_Группировка.ПроцентыОстатокНаКонец,
	ВТ_Группировка.ОбязательствоДисконтированноеНаКонец,
	ВТ_Группировка.ОбязательствоПолноеНаКонец,
	ВТ_Группировка.НДСНаКонец,
	ВТ_Группировка.АмортизацияЗаПериод,
	ВТ_Группировка.ПроцентыЗаПериод,
	ВТ_Группировка.АрендныеПлатежиЗаПериод,
	ВТ_Группировка.НДСЗаПериод,
	ВТ_Группировка.СтоимостьППАИзменение,
	ВТ_Группировка.АмортизацияНакопленнаяИзменение,
	ВТ_Группировка.ОбщаяПриведеннаяСтоимостьИзменение,
	ВТ_Группировка.ОбязательствоПолноеИзменение,
	ВТ_Группировка.ПроцентыИзменение,
	ВТ_Группировка.НДСИзменение,
	ВТ_Группировка.СтоимостьППАПоступление,
	ВТ_Группировка.АмортизацияНакопленнаяПоступление,
	ВТ_Группировка.ОбщаяПриведеннаяСтоимостьПоступление,
	ВТ_Группировка.ОбязательствоПолноеПоступление,
	ВТ_Группировка.ПроцентыПоступление,
	ВТ_Группировка.НДСПоступление,
	ВТ_Группировка.СтоимостьППАВыбытие,
	ВТ_Группировка.АмортизацияНакопленнаяВыбытие,
	ВТ_Группировка.ОбщаяПриведеннаяСтоимостьВыбытие,
	ВТ_Группировка.ОбязательствоПолноеВыбытие,
	ВТ_Группировка.ПроцентыВыбытие,
	ВТ_Группировка.НДСВыбытие
ИЗ
	ВТ_Группировка КАК ВТ_Группировка
ГДЕ
	(ВТ_Группировка.СтоимостьППАНаНачало <> 0
			ИЛИ ВТ_Группировка.АмортизацияНакопленнаяНаНачало <> 0
			ИЛИ ВТ_Группировка.ПроцентыОстатокНаНачало <> 0
			ИЛИ ВТ_Группировка.ОбязательствоДисконтированноеНаНачало <> 0
			ИЛИ ВТ_Группировка.ОбязательствоПолноеНаНачало <> 0
			ИЛИ ВТ_Группировка.НДСНаНачало <> 0
			ИЛИ ВТ_Группировка.СтоимостьППАНаКонец <> 0
			ИЛИ ВТ_Группировка.АмортизацияНакопленнаяНаКонец <> 0
			ИЛИ ВТ_Группировка.ПроцентыОстатокНаКонец <> 0
			ИЛИ ВТ_Группировка.ОбязательствоДисконтированноеНаКонец <> 0
			ИЛИ ВТ_Группировка.ОбязательствоПолноеНаКонец <> 0
			ИЛИ ВТ_Группировка.НДСНаКонец <> 0
			ИЛИ ВТ_Группировка.АмортизацияЗаПериод <> 0
			ИЛИ ВТ_Группировка.ПроцентыЗаПериод <> 0
			ИЛИ ВТ_Группировка.АрендныеПлатежиЗаПериод <> 0
			ИЛИ ВТ_Группировка.НДСЗаПериод <> 0
			ИЛИ ВТ_Группировка.СтоимостьППАИзменение <> 0
			ИЛИ ВТ_Группировка.АмортизацияНакопленнаяИзменение <> 0
			ИЛИ ВТ_Группировка.ОбщаяПриведеннаяСтоимостьИзменение <> 0
			ИЛИ ВТ_Группировка.ОбязательствоПолноеИзменение <> 0
			ИЛИ ВТ_Группировка.ПроцентыИзменение <> 0
			ИЛИ ВТ_Группировка.НДСИзменение <> 0
			ИЛИ ВТ_Группировка.СтоимостьППАПоступление <> 0
			ИЛИ ВТ_Группировка.АмортизацияНакопленнаяПоступление <> 0
			ИЛИ ВТ_Группировка.ОбщаяПриведеннаяСтоимостьПоступление <> 0
			ИЛИ ВТ_Группировка.ОбязательствоПолноеПоступление <> 0
			ИЛИ ВТ_Группировка.ПроцентыПоступление <> 0
			ИЛИ ВТ_Группировка.НДСПоступление <> 0
			ИЛИ ВТ_Группировка.СтоимостьППАВыбытие <> 0
			ИЛИ ВТ_Группировка.АмортизацияНакопленнаяВыбытие <> 0
			ИЛИ ВТ_Группировка.ОбщаяПриведеннаяСтоимостьВыбытие <> 0
			ИЛИ ВТ_Группировка.ОбязательствоПолноеВыбытие <> 0
			ИЛИ ВТ_Группировка.ПроцентыВыбытие <> 0
			ИЛИ ВТ_Группировка.НДСВыбытие <> 0)]


